var bn=Object.defineProperty;var En=(e,t,i)=>t in e?bn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i;var R=(e,t,i)=>En(e,typeof t!="symbol"?t+"":t,i);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const d of a)if(d.type==="childList")for(const u of d.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&n(u)}).observe(document,{childList:!0,subtree:!0});function i(a){const d={};return a.integrity&&(d.integrity=a.integrity),a.referrerPolicy&&(d.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?d.credentials="include":a.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function n(a){if(a.ep)return;a.ep=!0;const d=i(a);fetch(a.href,d)}})();var Vn=Object.defineProperty,l=(e,t)=>Vn(e,"name",{value:t,configurable:!0}),Sn=(()=>{for(var e=new Uint8Array(128),t=0;t<64;t++)e[t<26?t+65:t<52?t+71:t<62?t-4:t*4-205]=t;return i=>{for(var n=i.length,a=new Uint8Array((n-(i[n-1]=="=")-(i[n-2]=="="))*3/4|0),d=0,u=0;d<n;){var w=e[i.charCodeAt(d++)],A=e[i.charCodeAt(d++)],m=e[i.charCodeAt(d++)],G=e[i.charCodeAt(d++)];a[u++]=w<<2|A>>4,a[u++]=A<<4|m>>2,a[u++]=m<<6|G}return a}})();function yt(e){return e*Math.PI/180}l(yt,"deg2rad");function vs(e){return e*180/Math.PI}l(vs,"rad2deg");function bt(e,t,i){return t>i?bt(e,i,t):Math.min(Math.max(e,t),i)}l(bt,"clamp");function Et(e,t,i){if(typeof e=="number"&&typeof t=="number")return e+(t-e)*i;if(e instanceof C&&t instanceof C||e instanceof Fe&&t instanceof Fe)return e.lerp(t,i);throw new Error(`Bad value for lerp(): ${e}, ${t}. Only number, Vec2 and Color is supported.`)}l(Et,"lerp");function Nt(e,t,i,n,a){return n+(e-t)/(i-t)*(a-n)}l(Nt,"map");function Ro(e,t,i,n,a){return bt(Nt(e,t,i,n,a),n,a)}l(Ro,"mapc");var Ce,C=(Ce=class{constructor(t=0,i=t){R(this,"x",0);R(this,"y",0);this.x=t,this.y=i}static fromAngle(t){let i=yt(t);return new Ce(Math.cos(i),Math.sin(i))}clone(){return new Ce(this.x,this.y)}add(...t){let i=U(...t);return new Ce(this.x+i.x,this.y+i.y)}sub(...t){let i=U(...t);return new Ce(this.x-i.x,this.y-i.y)}scale(...t){let i=U(...t);return new Ce(this.x*i.x,this.y*i.y)}dist(...t){let i=U(...t);return this.sub(i).len()}sdist(...t){let i=U(...t);return this.sub(i).slen()}len(){return Math.sqrt(this.dot(this))}slen(){return this.dot(this)}unit(){let t=this.len();return t===0?new Ce(0):this.scale(1/t)}normal(){return new Ce(this.y,-this.x)}reflect(t){return this.sub(t.scale(2*this.dot(t)))}project(t){return t.scale(t.dot(this)/t.len())}reject(t){return this.sub(this.project(t))}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}angle(...t){let i=U(...t);return vs(Math.atan2(this.y-i.y,this.x-i.x))}angleBetween(...t){let i=U(...t);return vs(Math.atan2(this.cross(i),this.dot(i)))}lerp(t,i){return new Ce(Et(this.x,t.x,i),Et(this.y,t.y,i))}slerp(t,i){let n=this.dot(t),a=this.cross(t),d=Math.atan2(a,n);return this.scale(Math.sin((1-i)*d)).add(t.scale(Math.sin(i*d))).scale(1/a)}isZero(){return this.x===0&&this.y===0}toFixed(t){return new Ce(Number(this.x.toFixed(t)),Number(this.y.toFixed(t)))}transform(t){return t.multVec2(this)}eq(t){return this.x===t.x&&this.y===t.y}bbox(){return new _e(this,0,0)}toString(){return`vec2(${this.x.toFixed(2)}, ${this.y.toFixed(2)})`}},l(Ce,"Vec2"),R(Ce,"LEFT",new Ce(-1,0)),R(Ce,"RIGHT",new Ce(1,0)),R(Ce,"UP",new Ce(0,-1)),R(Ce,"DOWN",new Ce(0,1)),Ce);function U(...e){if(e.length===1){if(e[0]instanceof C)return new C(e[0].x,e[0].y);if(Array.isArray(e[0])&&e[0].length===2)return new C(...e[0])}return new C(...e)}l(U,"vec2");var xe,Fe=(xe=class{constructor(t,i,n){R(this,"r",255);R(this,"g",255);R(this,"b",255);this.r=bt(t,0,255),this.g=bt(i,0,255),this.b=bt(n,0,255)}static fromArray(t){return new xe(t[0],t[1],t[2])}static fromHex(t){if(typeof t=="number")return new xe(t>>16&255,t>>8&255,t>>0&255);if(typeof t=="string"){let i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return new xe(parseInt(i[1],16),parseInt(i[2],16),parseInt(i[3],16))}else throw new Error("Invalid hex color format")}static fromHSL(t,i,n){if(i==0)return new xe(255*n,255*n,255*n);let a=l((G,v,L)=>(L<0&&(L+=1),L>1&&(L-=1),L<1/6?G+(v-G)*6*L:L<1/2?v:L<2/3?G+(v-G)*(2/3-L)*6:G),"hue2rgb"),d=n<.5?n*(1+i):n+i-n*i,u=2*n-d,w=a(u,d,t+1/3),A=a(u,d,t),m=a(u,d,t-1/3);return new xe(Math.round(w*255),Math.round(A*255),Math.round(m*255))}clone(){return new xe(this.r,this.g,this.b)}lighten(t){return new xe(this.r+t,this.g+t,this.b+t)}darken(t){return this.lighten(-t)}invert(){return new xe(255-this.r,255-this.g,255-this.b)}mult(t){return new xe(this.r*t.r/255,this.g*t.g/255,this.b*t.b/255)}lerp(t,i){return new xe(Et(this.r,t.r,i),Et(this.g,t.g,i),Et(this.b,t.b,i))}toHSL(){let t=this.r/255,i=this.g/255,n=this.b/255,a=Math.max(t,i,n),d=Math.min(t,i,n),u=(a+d)/2,w=u,A=u;if(a==d)u=w=0;else{let m=a-d;switch(w=A>.5?m/(2-a-d):m/(a+d),a){case t:u=(i-n)/m+(i<n?6:0);break;case i:u=(n-t)/m+2;break;case n:u=(t-i)/m+4;break}u/=6}return[u,w,A]}eq(t){return this.r===t.r&&this.g===t.g&&this.b===t.b}toString(){return`rgb(${this.r}, ${this.g}, ${this.b})`}toHex(){return"#"+((1<<24)+(this.r<<16)+(this.g<<8)+this.b).toString(16).slice(1)}},l(xe,"Color"),R(xe,"RED",new xe(255,0,0)),R(xe,"GREEN",new xe(0,255,0)),R(xe,"BLUE",new xe(0,0,255)),R(xe,"YELLOW",new xe(255,255,0)),R(xe,"MAGENTA",new xe(255,0,255)),R(xe,"CYAN",new xe(0,255,255)),R(xe,"WHITE",new xe(255,255,255)),R(xe,"BLACK",new xe(0,0,0)),xe);function Me(...e){if(e.length===0)return new Fe(255,255,255);if(e.length===1){if(e[0]instanceof Fe)return e[0].clone();if(typeof e[0]=="string")return Fe.fromHex(e[0]);if(Array.isArray(e[0])&&e[0].length===3)return Fe.fromArray(e[0])}return new Fe(...e)}l(Me,"rgb");var Mn=l((e,t,i)=>Fe.fromHSL(e,t,i),"hsl2rgb"),Ut,Qe=(Ut=class{constructor(t,i,n,a){R(this,"x",0);R(this,"y",0);R(this,"w",1);R(this,"h",1);this.x=t,this.y=i,this.w=n,this.h=a}scale(t){return new Ut(this.x+this.w*t.x,this.y+this.h*t.y,this.w*t.w,this.h*t.h)}pos(){return new C(this.x,this.y)}clone(){return new Ut(this.x,this.y,this.w,this.h)}eq(t){return this.x===t.x&&this.y===t.y&&this.w===t.w&&this.h===t.h}toString(){return`quad(${this.x}, ${this.y}, ${this.w}, ${this.h})`}},l(Ut,"Quad"),Ut);function Ue(e,t,i,n){return new Qe(e,t,i,n)}l(Ue,"quad");var ke,wt=(ke=class{constructor(t){R(this,"m",[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);t&&(this.m=t)}static translate(t){return new ke([1,0,0,0,0,1,0,0,0,0,1,0,t.x,t.y,0,1])}static scale(t){return new ke([t.x,0,0,0,0,t.y,0,0,0,0,1,0,0,0,0,1])}static rotateX(t){t=yt(-t);let i=Math.cos(t),n=Math.sin(t);return new ke([1,0,0,0,0,i,-n,0,0,n,i,0,0,0,0,1])}static rotateY(t){t=yt(-t);let i=Math.cos(t),n=Math.sin(t);return new ke([i,0,n,0,0,1,0,0,-n,0,i,0,0,0,0,1])}static rotateZ(t){t=yt(-t);let i=Math.cos(t),n=Math.sin(t);return new ke([i,-n,0,0,n,i,0,0,0,0,1,0,0,0,0,1])}translate(t){return this.m[12]+=this.m[0]*t.x+this.m[4]*t.y,this.m[13]+=this.m[1]*t.x+this.m[5]*t.y,this.m[14]+=this.m[2]*t.x+this.m[6]*t.y,this.m[15]+=this.m[3]*t.x+this.m[7]*t.y,this}scale(t){return this.m[0]*=t.x,this.m[4]*=t.y,this.m[1]*=t.x,this.m[5]*=t.y,this.m[2]*=t.x,this.m[6]*=t.y,this.m[3]*=t.x,this.m[7]*=t.y,this}rotate(t){t=yt(-t);let i=Math.cos(t),n=Math.sin(t),a=this.m[0],d=this.m[1],u=this.m[4],w=this.m[5];return this.m[0]=a*i+d*n,this.m[1]=-a*n+d*i,this.m[4]=u*i+w*n,this.m[5]=-u*n+w*i,this}mult(t){let i=[];for(let n=0;n<4;n++)for(let a=0;a<4;a++)i[n*4+a]=this.m[0*4+a]*t.m[n*4+0]+this.m[1*4+a]*t.m[n*4+1]+this.m[2*4+a]*t.m[n*4+2]+this.m[3*4+a]*t.m[n*4+3];return new ke(i)}multVec2(t){return new C(t.x*this.m[0]+t.y*this.m[4]+this.m[12],t.x*this.m[1]+t.y*this.m[5]+this.m[13])}getTranslation(){return new C(this.m[12],this.m[13])}getScale(){if(this.m[0]!=0||this.m[1]!=0){let t=this.m[0]*this.m[5]-this.m[1]*this.m[4],i=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return new C(i,t/i)}else if(this.m[4]!=0||this.m[5]!=0){let t=this.m[0]*this.m[5]-this.m[1]*this.m[4],i=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return new C(t/i,i)}else return new C(0,0)}getRotation(){if(this.m[0]!=0||this.m[1]!=0){let t=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return vs(this.m[1]>0?Math.acos(this.m[0]/t):-Math.acos(this.m[0]/t))}else if(this.m[4]!=0||this.m[5]!=0){let t=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return vs(Math.PI/2-(this.m[5]>0?Math.acos(-this.m[4]/t):-Math.acos(this.m[4]/t)))}else return 0}getSkew(){if(this.m[0]!=0||this.m[1]!=0){let t=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return new C(Math.atan(this.m[0]*this.m[4]+this.m[1]*this.m[5])/(t*t),0)}else if(this.m[4]!=0||this.m[5]!=0){let t=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return new C(0,Math.atan(this.m[0]*this.m[4]+this.m[1]*this.m[5])/(t*t))}else return new C(0,0)}invert(){let t=[],i=this.m[10]*this.m[15]-this.m[14]*this.m[11],n=this.m[9]*this.m[15]-this.m[13]*this.m[11],a=this.m[9]*this.m[14]-this.m[13]*this.m[10],d=this.m[8]*this.m[15]-this.m[12]*this.m[11],u=this.m[8]*this.m[14]-this.m[12]*this.m[10],w=this.m[8]*this.m[13]-this.m[12]*this.m[9],A=this.m[6]*this.m[15]-this.m[14]*this.m[7],m=this.m[5]*this.m[15]-this.m[13]*this.m[7],G=this.m[5]*this.m[14]-this.m[13]*this.m[6],v=this.m[4]*this.m[15]-this.m[12]*this.m[7],L=this.m[4]*this.m[14]-this.m[12]*this.m[6],E=this.m[5]*this.m[15]-this.m[13]*this.m[7],j=this.m[4]*this.m[13]-this.m[12]*this.m[5],I=this.m[6]*this.m[11]-this.m[10]*this.m[7],H=this.m[5]*this.m[11]-this.m[9]*this.m[7],B=this.m[5]*this.m[10]-this.m[9]*this.m[6],X=this.m[4]*this.m[11]-this.m[8]*this.m[7],S=this.m[4]*this.m[10]-this.m[8]*this.m[6],de=this.m[4]*this.m[9]-this.m[8]*this.m[5];t[0]=this.m[5]*i-this.m[6]*n+this.m[7]*a,t[4]=-(this.m[4]*i-this.m[6]*d+this.m[7]*u),t[8]=this.m[4]*n-this.m[5]*d+this.m[7]*w,t[12]=-(this.m[4]*a-this.m[5]*u+this.m[6]*w),t[1]=-(this.m[1]*i-this.m[2]*n+this.m[3]*a),t[5]=this.m[0]*i-this.m[2]*d+this.m[3]*u,t[9]=-(this.m[0]*n-this.m[1]*d+this.m[3]*w),t[13]=this.m[0]*a-this.m[1]*u+this.m[2]*w,t[2]=this.m[1]*A-this.m[2]*m+this.m[3]*G,t[6]=-(this.m[0]*A-this.m[2]*v+this.m[3]*L),t[10]=this.m[0]*E-this.m[1]*v+this.m[3]*j,t[14]=-(this.m[0]*G-this.m[1]*L+this.m[2]*j),t[3]=-(this.m[1]*I-this.m[2]*H+this.m[3]*B),t[7]=this.m[0]*I-this.m[2]*X+this.m[3]*S,t[11]=-(this.m[0]*H-this.m[1]*X+this.m[3]*de),t[15]=this.m[0]*B-this.m[1]*S+this.m[2]*de;let W=this.m[0]*t[0]+this.m[1]*t[4]+this.m[2]*t[8]+this.m[3]*t[12];for(let Z=0;Z<4;Z++)for(let ue=0;ue<4;ue++)t[Z*4+ue]*=1/W;return new ke(t)}clone(){return new ke([...this.m])}toString(){return this.m.toString()}},l(ke,"Mat4"),ke);function Gi(e,t,i,n=a=>-Math.cos(a)){return e+(n(i)+1)/2*(t-e)}l(Gi,"wave");var Pn=1103515245,Tn=12345,ho=2147483648,ls,Do=(ls=class{constructor(t){R(this,"seed");this.seed=t}gen(){return this.seed=(Pn*this.seed+Tn)%ho,this.seed/ho}genNumber(t,i){return t+this.gen()*(i-t)}genVec2(t,i){return new C(this.genNumber(t.x,i.x),this.genNumber(t.y,i.y))}genColor(t,i){return new Fe(this.genNumber(t.r,i.r),this.genNumber(t.g,i.g),this.genNumber(t.b,i.b))}genAny(...t){if(t.length===0)return this.gen();if(t.length===1){if(typeof t[0]=="number")return this.genNumber(0,t[0]);if(t[0]instanceof C)return this.genVec2(U(0,0),t[0]);if(t[0]instanceof Fe)return this.genColor(Me(0,0,0),t[0])}else if(t.length===2){if(typeof t[0]=="number"&&typeof t[1]=="number")return this.genNumber(t[0],t[1]);if(t[0]instanceof C&&t[1]instanceof C)return this.genVec2(t[0],t[1]);if(t[0]instanceof Fe&&t[1]instanceof Fe)return this.genColor(t[0],t[1])}}},l(ls,"RNG"),ls),Ki=new Do(Date.now());function Io(e){return e!=null&&(Ki.seed=e),Ki.seed}l(Io,"randSeed");function Ns(...e){return Ki.genAny(...e)}l(Ns,"rand");function Xi(...e){return Math.floor(Ns(...e))}l(Xi,"randi");function Co(e){return Ns()<=e}l(Co,"chance");function zo(e){return e[Xi(e.length)]}l(zo,"choose");function Bo(e,t){return e.pos.x+e.width>t.pos.x&&e.pos.x<t.pos.x+t.width&&e.pos.y+e.height>t.pos.y&&e.pos.y<t.pos.y+t.height}l(Bo,"testRectRect");function Lo(e,t){if(e.p1.x===e.p2.x&&e.p1.y===e.p2.y||t.p1.x===t.p2.x&&t.p1.y===t.p2.y)return null;let i=(t.p2.y-t.p1.y)*(e.p2.x-e.p1.x)-(t.p2.x-t.p1.x)*(e.p2.y-e.p1.y);if(i===0)return null;let n=((t.p2.x-t.p1.x)*(e.p1.y-t.p1.y)-(t.p2.y-t.p1.y)*(e.p1.x-t.p1.x))/i,a=((e.p2.x-e.p1.x)*(e.p1.y-t.p1.y)-(e.p2.y-e.p1.y)*(e.p1.x-t.p1.x))/i;return n<0||n>1||a<0||a>1?null:n}l(Lo,"testLineLineT");function ns(e,t){let i=Lo(e,t);return i?U(e.p1.x+i*(e.p2.x-e.p1.x),e.p1.y+i*(e.p2.y-e.p1.y)):null}l(ns,"testLineLine");function No(e,t){if(Us(e,t.p1)||Us(e,t.p2))return!0;let i=e.points();return!!ns(t,new as(i[0],i[1]))||!!ns(t,new as(i[1],i[2]))||!!ns(t,new as(i[2],i[3]))||!!ns(t,new as(i[3],i[0]))}l(No,"testRectLine");function Us(e,t){return t.x>e.pos.x&&t.x<e.pos.x+e.width&&t.y>e.pos.y&&t.y<e.pos.y+e.height}l(Us,"testRectPoint");function Uo(e,t){let i=t.sub(e.p1),n=e.p2.sub(e.p1);if(Math.abs(i.cross(n))>Number.EPSILON)return!1;let a=i.dot(n)/n.dot(n);return a>=0&&a<=1}l(Uo,"testLinePoint");function Wi(e,t){let i=e.p2.sub(e.p1),n=i.dot(i),a=e.p1.sub(t.center),d=2*i.dot(a),u=a.dot(a)-t.radius*t.radius,w=d*d-4*n*u;if(n<=Number.EPSILON||w<0)return!1;if(w==0){let A=-d/(2*n);if(A>=0&&A<=1)return!0}else{let A=(-d+Math.sqrt(w))/(2*n),m=(-d-Math.sqrt(w))/(2*n);if(A>=0&&A<=1||m>=0&&m<=1)return!0}return Ji(t,e.p1)}l(Wi,"testLineCircle");function Ji(e,t){return e.center.sdist(t)<e.radius*e.radius}l(Ji,"testCirclePoint");function Oo(e,t){let i=t.pts[t.pts.length-1];for(let n of t.pts){if(Wi(new as(i,n),e))return!0;i=n}return Ji(e,t.pts[0])?!0:ji(t,e.center)}l(Oo,"testCirclePolygon");function ji(e,t){let i=!1,n=e.pts;for(let a=0,d=n.length-1;a<n.length;d=a++)n[a].y>t.y!=n[d].y>t.y&&t.x<(n[d].x-n[a].x)*(t.y-n[a].y)/(n[d].y-n[a].y)+n[a].x&&(i=!i);return i}l(ji,"testPolygonPoint");var Ot,as=(Ot=class{constructor(t,i){R(this,"p1");R(this,"p2");this.p1=t.clone(),this.p2=i.clone()}transform(t){return new Ot(t.multVec2(this.p1),t.multVec2(this.p2))}bbox(){return _e.fromPoints(this.p1,this.p2)}area(){return this.p1.dist(this.p2)}clone(){return new Ot(this.p1,this.p2)}},l(Ot,"Line"),Ot),Gt,_e=(Gt=class{constructor(t,i,n){R(this,"pos");R(this,"width");R(this,"height");this.pos=t.clone(),this.width=i,this.height=n}static fromPoints(t,i){return new Gt(t.clone(),i.x-t.x,i.y-t.y)}center(){return new C(this.pos.x+this.width/2,this.pos.y+this.height/2)}points(){return[this.pos,this.pos.add(this.width,0),this.pos.add(this.width,this.height),this.pos.add(0,this.height)]}transform(t){return new Is(this.points().map(i=>t.multVec2(i)))}bbox(){return this.clone()}area(){return this.width*this.height}clone(){return new Gt(this.pos.clone(),this.width,this.height)}distToPoint(t){return Math.sqrt(this.sdistToPoint(t))}sdistToPoint(t){let i=this.pos,n=this.pos.add(this.width,this.height),a=Math.max(i.x-t.x,0,t.x-n.x),d=Math.max(i.y-t.y,0,t.y-n.y);return a*a+d*d}},l(Gt,"Rect"),Gt),Zt,uo=(Zt=class{constructor(t,i){R(this,"center");R(this,"radius");this.center=t.clone(),this.radius=i}transform(t){return new Fn(this.center,this.radius,this.radius).transform(t)}bbox(){return _e.fromPoints(this.center.sub(U(this.radius)),this.center.add(U(this.radius)))}area(){return this.radius*this.radius*Math.PI}clone(){return new Zt(this.center,this.radius)}},l(Zt,"Circle"),Zt),Kt,Fn=(Kt=class{constructor(t,i,n){R(this,"center");R(this,"radiusX");R(this,"radiusY");this.center=t.clone(),this.radiusX=i,this.radiusY=n}transform(t){return new Kt(t.multVec2(this.center),t.m[0]*this.radiusX,t.m[5]*this.radiusY)}bbox(){return _e.fromPoints(this.center.sub(U(this.radiusX,this.radiusY)),this.center.add(U(this.radiusX,this.radiusY)))}area(){return this.radiusX*this.radiusY*Math.PI}clone(){return new Kt(this.center,this.radiusX,this.radiusY)}},l(Kt,"Ellipse"),Kt),Ht,Is=(Ht=class{constructor(t){R(this,"pts");if(t.length<3)throw new Error("Polygons should have at least 3 vertices");this.pts=t}transform(t){return new Ht(this.pts.map(i=>t.multVec2(i)))}bbox(){let t=U(Number.MAX_VALUE),i=U(-Number.MAX_VALUE);for(let n of this.pts)t.x=Math.min(t.x,n.x),i.x=Math.max(i.x,n.x),t.y=Math.min(t.y,n.y),i.y=Math.max(i.y,n.y);return _e.fromPoints(t,i)}area(){let t=0,i=this.pts.length;for(let n=0;n<i;n++){let a=this.pts[n],d=this.pts[(n+1)%i];t+=a.x*d.y*.5,t-=d.x*a.y*.5}return Math.abs(t)}clone(){return new Ht(this.pts.map(t=>t.clone()))}},l(Ht,"Polygon"),Ht);function Go(e,t){let i=Number.MAX_VALUE,n=U(0);for(let a of[e,t])for(let d=0;d<a.pts.length;d++){let u=a.pts[d],w=a.pts[(d+1)%a.pts.length].sub(u).normal().unit(),A=Number.MAX_VALUE,m=-Number.MAX_VALUE;for(let E=0;E<e.pts.length;E++){let j=e.pts[E].dot(w);A=Math.min(A,j),m=Math.max(m,j)}let G=Number.MAX_VALUE,v=-Number.MAX_VALUE;for(let E=0;E<t.pts.length;E++){let j=t.pts[E].dot(w);G=Math.min(G,j),v=Math.max(v,j)}let L=Math.min(m,v)-Math.max(A,G);if(L<0)return null;if(L<Math.abs(i)){let E=v-A,j=G-m;i=Math.abs(E)<Math.abs(j)?E:j,n=w.scale(i)}}return n}l(Go,"sat");var cs,Ko=(cs=class extends Map{constructor(...i){super(...i);R(this,"lastID");this.lastID=0}push(i){let n=this.lastID;return this.set(n,i),this.lastID++,n}pushd(i){let n=this.push(i);return()=>this.delete(n)}},l(cs,"Registry"),cs),_t,os=(_t=class{constructor(t){R(this,"paused",!1);R(this,"cancel");this.cancel=t}static join(t){let i=new _t(()=>t.forEach(n=>n.cancel()));return Object.defineProperty(i,"paused",{get:()=>t[0].paused,set:n=>t.forEach(a=>a.paused=n)}),i.paused=!1,i}},l(_t,"EventController"),_t),hs,dt=(hs=class{constructor(){R(this,"handlers",new Ko)}add(t){let i=this.handlers.pushd((...a)=>{n.paused||t(...a)}),n=new os(i);return n}addOnce(t){let i=this.add((...n)=>{i.cancel(),t(...n)});return i}next(){return new Promise(t=>this.addOnce(t))}trigger(...t){this.handlers.forEach(i=>i(...t))}numListeners(){return this.handlers.size}clear(){this.handlers.clear()}},l(hs,"Event"),hs),ds,Cs=(ds=class{constructor(){R(this,"handlers",{})}on(t,i){return this.handlers[t]||(this.handlers[t]=new dt),this.handlers[t].add(i)}onOnce(t,i){let n=this.on(t,(...a)=>{n.cancel(),i(...a)});return n}next(t){return new Promise(i=>{this.onOnce(t,(...n)=>i(n[0]))})}trigger(t,...i){this.handlers[t]&&this.handlers[t].trigger(...i)}remove(t){delete this.handlers[t]}clear(){this.handlers={}}numListeners(t){var i;return((i=this.handlers[t])==null?void 0:i.numListeners())??0}},l(ds,"EventHandler"),ds);function ci(e,t){if(e===t)return!0;let i=typeof e,n=typeof t;if(i!==n)return!1;if(i==="object"&&n==="object"&&e!==null&&t!==null){if(Array.isArray(e)!==Array.isArray(t))return!1;let a=Object.keys(e),d=Object.keys(t);if(a.length!==d.length)return!1;for(let u of a){let w=e[u],A=t[u];if(!ci(w,A))return!1}return!0}return!1}l(ci,"deepEq");function Ho(e){let t=window.atob(e),i=t.length,n=new Uint8Array(i);for(let a=0;a<i;a++)n[a]=t.charCodeAt(a);return n.buffer}l(Ho,"base64ToArrayBuffer");function Yo(e){return Ho(e.split(",")[1])}l(Yo,"dataURLToArrayBuffer");function hi(e,t){let i=document.createElement("a");i.href=t,i.download=e,i.click()}l(hi,"download");function Zi(e,t){hi(e,"data:text/plain;charset=utf-8,"+t)}l(Zi,"downloadText");function qo(e,t){Zi(e,JSON.stringify(t))}l(qo,"downloadJSON");function Hi(e,t){let i=URL.createObjectURL(t);hi(e,i),URL.revokeObjectURL(i)}l(Hi,"downloadBlob");var po=l(e=>e.match(/^data:\w+\/\w+;base64,.+/),"isDataURL"),Rn=l(e=>e.split(".").slice(0,-1).join("."),"getFileName");function it(e,t){return(...i)=>{let n=i.length;if(n===e.length)return e(...i);if(n===t.length)return t(...i)}}l(it,"overload2");var Dn=(()=>{let e=0;return()=>e++})(),In=l(e=>e instanceof Error?e.message:String(e),"getErrorMessage"),us,Cn=(us=class{constructor(t=(i,n)=>i<n){R(this,"_items");R(this,"_compareFn");this._compareFn=t,this._items=[]}insert(t){this._items.push(t),this.moveUp(this._items.length-1)}remove(){if(this._items.length===0)return null;let t=this._items[0],i=this._items.pop();return this._items.length!==0&&(this._items[0]=i,this.moveDown(0)),t}clear(){this._items.splice(0,this._items.length)}moveUp(t){for(;t>0;){let i=Math.floor((t-1)/2);if(!this._compareFn(this._items[t],this._items[i])&&this._items[t]>=this._items[i])break;this.swap(t,i),t=i}}moveDown(t){for(;t<Math.floor(this._items.length/2);){let i=2*t+1;if(i<this._items.length-1&&!this._compareFn(this._items[i],this._items[i+1])&&++i,this._compareFn(this._items[t],this._items[i]))break;this.swap(t,i),t=i}}swap(t,i){[this._items[t],this._items[i]]=[this._items[i],this._items[t]]}get length(){return this._items.length}},l(us,"BinaryHeap"),us),zn=Object.freeze([776,2359,2367,2984,3007,3021,3633,3635,3648,3657,4352,4449,4520]);function Qo(e){if(typeof e!="string")throw new TypeError("string cannot be undefined or null");let t=[],i=0,n=0;for(;i<e.length;){if(n+=Xo(i+n,e),ko(e[i+n])&&n++,Zo(e[i+n])&&n++,_o(e[i+n])&&n++,en(e[i+n])){n++;continue}t.push(e.substring(i,i+n)),i+=n,n=0}return t}l(Qo,"runes");function Xo(e,t){let i=t[e];if(!Wo(i)||e===t.length-1)return 1;let n=i+t[e+1],a=t.substring(e+2,e+5);return Yi(n)&&Yi(a)?4:Jo(n)&&$o(a)?t.slice(e).indexOf(String.fromCodePoint(917631))+2:jo(a)?4:2}l(Xo,"nextUnits");function Wo(e){return e&&Yt(e[0].charCodeAt(0),55296,56319)}l(Wo,"isFirstOfSurrogatePair");function Yi(e){return Yt(di(e),127462,127487)}l(Yi,"isRegionalIndicator");function Jo(e){return Yt(di(e),127988,127988)}l(Jo,"isSubdivisionFlag");function jo(e){return Yt(di(e),127995,127999)}l(jo,"isFitzpatrickModifier");function Zo(e){return typeof e=="string"&&Yt(e.charCodeAt(0),65024,65039)}l(Zo,"isVariationSelector");function _o(e){return typeof e=="string"&&Yt(e.charCodeAt(0),8400,8447)}l(_o,"isDiacriticalMark");function $o(e){let t=e.codePointAt(0);return typeof e=="string"&&typeof t=="number"&&Yt(t,917504,917631)}l($o,"isSupplementarySpecialpurposePlane");function ko(e){return typeof e=="string"&&zn.includes(e.charCodeAt(0))}l(ko,"isGrapheme");function en(e){return typeof e=="string"&&e.charCodeAt(0)===8205}l(en,"isZeroWidthJoiner");function di(e){let t=e.charCodeAt(0)-55296,i=e.charCodeAt(1)-56320;return(t<<10)+i+65536}l(di,"codePointFromSurrogatePair");function Yt(e,t,i){return e>=t&&e<=i}l(Yt,"betweenInclusive");var fo={"Joy-Con L+R (STANDARD GAMEPAD Vendor: 057e Product: 200e)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",6:"ltrigger",7:"rtrigger",8:"select",9:"start",10:"lstick",11:"rstick",12:"dpad-up",13:"dpad-down",14:"dpad-left",15:"dpad-right",16:"home",17:"capture"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}},"Joy-Con (L) (STANDARD GAMEPAD Vendor: 057e Product: 2006)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",9:"select",10:"lstick",16:"start"},sticks:{left:{x:0,y:1}}},"Joy-Con (R) (STANDARD GAMEPAD Vendor: 057e Product: 2007)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",9:"start",10:"lstick",16:"select"},sticks:{left:{x:0,y:1}}},"Pro Controller (STANDARD GAMEPAD Vendor: 057e Product: 2009)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",6:"ltrigger",7:"rtrigger",8:"select",9:"start",10:"lstick",11:"rstick",12:"dpad-up",13:"dpad-down",14:"dpad-left",15:"dpad-right",16:"home",17:"capture"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}},default:{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",6:"ltrigger",7:"rtrigger",8:"select",9:"start",10:"lstick",11:"rstick",12:"dpad-up",13:"dpad-down",14:"dpad-left",15:"dpad-right",16:"home"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}}},ps,ai=(ps=class{constructor(){R(this,"pressed",new Set([]));R(this,"pressedRepeat",new Set([]));R(this,"released",new Set([]));R(this,"down",new Set([]))}update(){this.pressed.clear(),this.released.clear(),this.pressedRepeat.clear()}press(t){this.pressed.add(t),this.pressedRepeat.add(t),this.down.add(t)}pressRepeat(t){this.pressedRepeat.add(t)}release(t){this.down.delete(t),this.pressed.delete(t),this.released.add(t)}},l(ps,"ButtonState"),ps),fs,Bn=(fs=class{constructor(){R(this,"buttonState",new ai);R(this,"stickState",new Map)}},l(fs,"GamepadState"),fs),gs,Ln=(gs=class{constructor(){R(this,"dts",[]);R(this,"timer",0);R(this,"fps",0)}tick(t){this.dts.push(t),this.timer+=t,this.timer>=1&&(this.timer=0,this.fps=Math.round(1/(this.dts.reduce((i,n)=>i+n)/this.dts.length)),this.dts=[])}},l(gs,"FPSCounter"),gs),Nn=l(e=>{if(!e.canvas)throw new Error("Please provide a canvas");let t={canvas:e.canvas,loopID:null,stopped:!1,dt:0,time:0,realTime:0,fpsCounter:new Ln,timeScale:1,skipTime:!1,numFrames:0,mousePos:new C(0),mouseDeltaPos:new C(0),keyState:new ai,mouseState:new ai,mergedGamepadState:new Bn,gamepadStates:new Map,gamepads:[],charInputted:[],isMouseMoved:!1,lastWidth:e.canvas.offsetWidth,lastHeight:e.canvas.offsetHeight,events:new Cs};function i(){return t.dt*t.timeScale}l(i,"dt");function n(){return t.time}l(n,"time");function a(){return t.fpsCounter.fps}l(a,"fps");function d(){return t.numFrames}l(d,"numFrames");function u(){return t.canvas.toDataURL()}l(u,"screenshot");function w(g){t.canvas.style.cursor=g}l(w,"setCursor");function A(){return t.canvas.style.cursor}l(A,"getCursor");function m(g){if(g)try{let D=t.canvas.requestPointerLock();D.catch&&D.catch(N=>console.error(N))}catch(D){console.error(D)}else document.exitPointerLock()}l(m,"setCursorLocked");function G(){return!!document.pointerLockElement}l(G,"isCursorLocked");function v(g){g.requestFullscreen?g.requestFullscreen():g.webkitRequestFullscreen&&g.webkitRequestFullscreen()}l(v,"enterFullscreen");function L(){document.exitFullscreen?document.exitFullscreen():document.webkitExitFullScreen&&document.webkitExitFullScreen()}l(L,"exitFullscreen");function E(){return document.fullscreenElement||document.webkitFullscreenElement}l(E,"getFullscreenElement");function j(g=!0){g?v(t.canvas):L()}l(j,"setFullscreen");function I(){return!!E()}l(I,"isFullscreen");function H(){t.stopped=!0;for(let g in De)t.canvas.removeEventListener(g,De[g]);for(let g in Oe)document.removeEventListener(g,Oe[g]);for(let g in Le)window.removeEventListener(g,Le[g]);Xe.disconnect()}l(H,"quit");function B(g){t.loopID!==null&&cancelAnimationFrame(t.loopID);let D=0,N=l(le=>{if(t.stopped)return;if(document.visibilityState!=="visible"){t.loopID=requestAnimationFrame(N);return}let Ae=le/1e3,Ke=Ae-t.realTime,et=e.maxFPS?1/e.maxFPS:0;t.realTime=Ae,D+=Ke,D>et&&(t.skipTime||(t.dt=D,t.time+=i(),t.fpsCounter.tick(t.dt)),D=0,t.skipTime=!1,t.numFrames++,Ve(),g(),$e()),t.loopID=requestAnimationFrame(N)},"frame");N(0)}l(B,"run");function X(){return"ontouchstart"in window||navigator.maxTouchPoints>0}l(X,"isTouchscreen");function S(){return t.mousePos.clone()}l(S,"mousePos");function de(){return t.mouseDeltaPos.clone()}l(de,"mouseDeltaPos");function W(g="left"){return t.mouseState.pressed.has(g)}l(W,"isMousePressed");function Z(g="left"){return t.mouseState.down.has(g)}l(Z,"isMouseDown");function ue(g="left"){return t.mouseState.released.has(g)}l(ue,"isMouseReleased");function pe(){return t.isMouseMoved}l(pe,"isMouseMoved");function ie(g){return g===void 0?t.keyState.pressed.size>0:t.keyState.pressed.has(g)}l(ie,"isKeyPressed");function te(g){return g===void 0?t.keyState.pressedRepeat.size>0:t.keyState.pressedRepeat.has(g)}l(te,"isKeyPressedRepeat");function oe(g){return g===void 0?t.keyState.down.size>0:t.keyState.down.has(g)}l(oe,"isKeyDown");function O(g){return g===void 0?t.keyState.released.size>0:t.keyState.released.has(g)}l(O,"isKeyReleased");function k(g){return g===void 0?t.mergedGamepadState.buttonState.pressed.size>0:t.mergedGamepadState.buttonState.pressed.has(g)}l(k,"isGamepadButtonPressed");function se(g){return g===void 0?t.mergedGamepadState.buttonState.down.size>0:t.mergedGamepadState.buttonState.down.has(g)}l(se,"isGamepadButtonDown");function Se(g){return g===void 0?t.mergedGamepadState.buttonState.released.size>0:t.mergedGamepadState.buttonState.released.has(g)}l(Se,"isGamepadButtonReleased");function Ee(g){return t.events.on("resize",g)}l(Ee,"onResize");let Mt=it(g=>t.events.on("keyDown",g),(g,D)=>t.events.on("keyDown",N=>N===g&&D(g))),at=it(g=>t.events.on("keyPress",g),(g,D)=>t.events.on("keyPress",N=>N===g&&D(g))),ut=it(g=>t.events.on("keyPressRepeat",g),(g,D)=>t.events.on("keyPressRepeat",N=>N===g&&D(g))),ye=it(g=>t.events.on("keyRelease",g),(g,D)=>t.events.on("keyRelease",N=>N===g&&D(g))),be=it(g=>t.events.on("mouseDown",D=>g(D)),(g,D)=>t.events.on("mouseDown",N=>N===g&&D(N))),he=it(g=>t.events.on("mousePress",D=>g(D)),(g,D)=>t.events.on("mousePress",N=>N===g&&D(N))),re=it(g=>t.events.on("mouseRelease",D=>g(D)),(g,D)=>t.events.on("mouseRelease",N=>N===g&&D(N)));function ve(g){return t.events.on("mouseMove",()=>g(S(),de()))}l(ve,"onMouseMove");function Ne(g){return t.events.on("charInput",g)}l(Ne,"onCharInput");function Be(g){return t.events.on("touchStart",g)}l(Be,"onTouchStart");function Je(g){return t.events.on("touchMove",g)}l(Je,"onTouchMove");function pt(g){return t.events.on("touchEnd",g)}l(pt,"onTouchEnd");function lt(g){return t.events.on("scroll",g)}l(lt,"onScroll");function Pt(g){return t.events.on("hide",g)}l(Pt,"onHide");function Tt(g){return t.events.on("show",g)}l(Tt,"onShow");function Ft(g,D){if(typeof g=="function")return t.events.on("gamepadButtonDown",g);if(typeof g=="string"&&typeof D=="function")return t.events.on("gamepadButtonDown",N=>N===g&&D(g))}l(Ft,"onGamepadButtonDown");function Rt(g,D){if(typeof g=="function")return t.events.on("gamepadButtonPress",g);if(typeof g=="string"&&typeof D=="function")return t.events.on("gamepadButtonPress",N=>N===g&&D(g))}l(Rt,"onGamepadButtonPress");function ft(g,D){if(typeof g=="function")return t.events.on("gamepadButtonRelease",g);if(typeof g=="string"&&typeof D=="function")return t.events.on("gamepadButtonRelease",N=>N===g&&D(g))}l(ft,"onGamepadButtonRelease");function rt(g,D){return t.events.on("gamepadStick",(N,le)=>N===g&&D(le))}l(rt,"onGamepadStick");function F(g){t.events.on("gamepadConnect",g)}l(F,"onGamepadConnect");function z(g){t.events.on("gamepadDisconnect",g)}l(z,"onGamepadDisconnect");function _(g){return t.mergedGamepadState.stickState.get(g)||new C(0)}l(_,"getGamepadStick");function ge(){return[...t.charInputted]}l(ge,"charInputted");function je(){return[...t.gamepads]}l(je,"getGamepads");function Ve(){t.events.trigger("input"),t.keyState.down.forEach(g=>t.events.trigger("keyDown",g)),t.mouseState.down.forEach(g=>t.events.trigger("mouseDown",g)),gt()}l(Ve,"processInput");function $e(){t.keyState.update(),t.mouseState.update(),t.mergedGamepadState.buttonState.update(),t.mergedGamepadState.stickState.forEach((g,D)=>{t.mergedGamepadState.stickState.set(D,new C(0))}),t.charInputted=[],t.isMouseMoved=!1,t.gamepadStates.forEach(g=>{g.buttonState.update(),g.stickState.forEach((D,N)=>{g.stickState.set(N,new C(0))})})}l($e,"resetInput");function es(g){let D={index:g.index,isPressed:N=>t.gamepadStates.get(g.index).buttonState.pressed.has(N),isDown:N=>t.gamepadStates.get(g.index).buttonState.down.has(N),isReleased:N=>t.gamepadStates.get(g.index).buttonState.released.has(N),getStick:N=>t.gamepadStates.get(g.index).stickState.get(N)};return t.gamepads.push(D),t.gamepadStates.set(g.index,{buttonState:new ai,stickState:new Map([["left",new C(0)],["right",new C(0)]])}),D}l(es,"registerGamepad");function Pe(g){t.gamepads=t.gamepads.filter(D=>D.index!==g.index),t.gamepadStates.delete(g.index)}l(Pe,"removeGamepad");function gt(){for(let g of navigator.getGamepads())g&&!t.gamepadStates.has(g.index)&&es(g);for(let g of t.gamepads){let D=navigator.getGamepads()[g.index],N=(e.gamepads??{})[D.id]??fo[D.id]??fo.default,le=t.gamepadStates.get(g.index);for(let Ae=0;Ae<D.buttons.length;Ae++)D.buttons[Ae].pressed?(le.buttonState.down.has(N.buttons[Ae])||(t.mergedGamepadState.buttonState.press(N.buttons[Ae]),le.buttonState.press(N.buttons[Ae]),t.events.trigger("gamepadButtonPress",N.buttons[Ae])),t.events.trigger("gamepadButtonDown",N.buttons[Ae])):le.buttonState.down.has(N.buttons[Ae])&&(t.mergedGamepadState.buttonState.release(N.buttons[Ae]),le.buttonState.release(N.buttons[Ae]),t.events.trigger("gamepadButtonRelease",N.buttons[Ae]));for(let Ae in N.sticks){let Ke=N.sticks[Ae],et=new C(D.axes[Ke.x],D.axes[Ke.y]);le.stickState.set(Ae,et),t.mergedGamepadState.stickState.set(Ae,et),t.events.trigger("gamepadStick",Ae,et)}}}l(gt,"processGamepad");let De={},Oe={},Le={},mt=e.pixelDensity||window.devicePixelRatio||1;De.mousemove=g=>{let D=new C(g.offsetX,g.offsetY),N=new C(g.movementX,g.movementY);if(I()){let le=t.canvas.width/mt,Ae=t.canvas.height/mt,Ke=window.innerWidth,et=window.innerHeight,bs=Ke/et,Es=le/Ae;if(bs>Es){let ct=et/Ae,tt=(Ke-le*ct)/2;D.x=Nt(g.offsetX-tt,0,le*ct,0,le),D.y=Nt(g.offsetY,0,Ae*ct,0,Ae)}else{let ct=Ke/le,tt=(et-Ae*ct)/2;D.x=Nt(g.offsetX,0,le*ct,0,le),D.y=Nt(g.offsetY-tt,0,Ae*ct,0,Ae)}}t.events.onOnce("input",()=>{t.isMouseMoved=!0,t.mousePos=D,t.mouseDeltaPos=N,t.events.trigger("mouseMove")})};let Dt=["left","middle","right","back","forward"];De.mousedown=g=>{t.events.onOnce("input",()=>{let D=Dt[g.button];D&&(t.mouseState.press(D),t.events.trigger("mousePress",D))})},De.mouseup=g=>{t.events.onOnce("input",()=>{let D=Dt[g.button];D&&(t.mouseState.release(D),t.events.trigger("mouseRelease",D))})};let Qs=new Set([" ","ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Tab"]),At={ArrowLeft:"left",ArrowRight:"right",ArrowUp:"up",ArrowDown:"down"," ":"space"};De.keydown=g=>{Qs.has(g.key)&&g.preventDefault(),t.events.onOnce("input",()=>{let D=At[g.key]||g.key.toLowerCase();D.length===1?(t.events.trigger("charInput",D),t.charInputted.push(D)):D==="space"&&(t.events.trigger("charInput"," "),t.charInputted.push(" ")),g.repeat?(t.keyState.pressRepeat(D),t.events.trigger("keyPressRepeat",D)):(t.keyState.press(D),t.events.trigger("keyPressRepeat",D),t.events.trigger("keyPress",D))})},De.keyup=g=>{t.events.onOnce("input",()=>{let D=At[g.key]||g.key.toLowerCase();t.keyState.release(D),t.events.trigger("keyRelease",D)})},De.touchstart=g=>{g.preventDefault(),t.events.onOnce("input",()=>{let D=[...g.changedTouches],N=t.canvas.getBoundingClientRect();e.touchToMouse!==!1&&(t.mousePos=new C(D[0].clientX-N.x,D[0].clientY-N.y),t.mouseState.press("left"),t.events.trigger("mousePress","left")),D.forEach(le=>{t.events.trigger("touchStart",new C(le.clientX-N.x,le.clientY-N.y),le)})})},De.touchmove=g=>{g.preventDefault(),t.events.onOnce("input",()=>{let D=[...g.changedTouches],N=t.canvas.getBoundingClientRect();e.touchToMouse!==!1&&(t.mousePos=new C(D[0].clientX-N.x,D[0].clientY-N.y),t.events.trigger("mouseMove")),D.forEach(le=>{t.events.trigger("touchMove",new C(le.clientX-N.x,le.clientY-N.y),le)})})},De.touchend=g=>{t.events.onOnce("input",()=>{let D=[...g.changedTouches],N=t.canvas.getBoundingClientRect();e.touchToMouse!==!1&&(t.mousePos=new C(D[0].clientX-N.x,D[0].clientY-N.y),t.mouseState.release("left"),t.events.trigger("mouseRelease","left")),D.forEach(le=>{t.events.trigger("touchEnd",new C(le.clientX-N.x,le.clientY-N.y),le)})})},De.touchcancel=g=>{t.events.onOnce("input",()=>{let D=[...g.changedTouches],N=t.canvas.getBoundingClientRect();e.touchToMouse!==!1&&(t.mousePos=new C(D[0].clientX-N.x,D[0].clientY-N.y),t.mouseState.release("left"),t.events.trigger("mouseRelease","left")),D.forEach(le=>{t.events.trigger("touchEnd",new C(le.clientX-N.x,le.clientY-N.y),le)})})},De.wheel=g=>{g.preventDefault(),t.events.onOnce("input",()=>{t.events.trigger("scroll",new C(g.deltaX,g.deltaY))})},De.contextmenu=g=>g.preventDefault(),Oe.visibilitychange=()=>{document.visibilityState==="visible"?(t.skipTime=!0,t.events.trigger("show")):t.events.trigger("hide")},Le.gamepadconnected=g=>{let D=es(g.gamepad);t.events.onOnce("input",()=>{t.events.trigger("gamepadConnect",D)})},Le.gamepaddisconnected=g=>{let D=je().filter(N=>N.index===g.gamepad.index)[0];Pe(g.gamepad),t.events.onOnce("input",()=>{t.events.trigger("gamepadDisconnect",D)})};for(let g in De)t.canvas.addEventListener(g,De[g]);for(let g in Oe)document.addEventListener(g,Oe[g]);for(let g in Le)window.addEventListener(g,Le[g]);let Xe=new ResizeObserver(g=>{for(let D of g)if(D.target===t.canvas){if(t.lastWidth===t.canvas.offsetWidth&&t.lastHeight===t.canvas.offsetHeight)return;t.lastWidth=t.canvas.offsetWidth,t.lastHeight=t.canvas.offsetHeight,t.events.onOnce("input",()=>{t.events.trigger("resize")})}});return Xe.observe(t.canvas),{dt:i,time:n,run:B,canvas:t.canvas,fps:a,numFrames:d,quit:H,setFullscreen:j,isFullscreen:I,setCursor:w,screenshot:u,getGamepads:je,getCursor:A,setCursorLocked:m,isCursorLocked:G,isTouchscreen:X,mousePos:S,mouseDeltaPos:de,isKeyDown:oe,isKeyPressed:ie,isKeyPressedRepeat:te,isKeyReleased:O,isMouseDown:Z,isMousePressed:W,isMouseReleased:ue,isMouseMoved:pe,isGamepadButtonPressed:k,isGamepadButtonDown:se,isGamepadButtonReleased:Se,getGamepadStick:_,charInputted:ge,onResize:Ee,onKeyDown:Mt,onKeyPress:at,onKeyPressRepeat:ut,onKeyRelease:ye,onMouseDown:be,onMousePress:he,onMouseRelease:re,onMouseMove:ve,onCharInput:Ne,onTouchStart:Be,onTouchMove:Je,onTouchEnd:pt,onScroll:lt,onHide:Pt,onShow:Tt,onGamepadButtonDown:Ft,onGamepadButtonPress:Rt,onGamepadButtonRelease:ft,onGamepadStick:rt,onGamepadConnect:F,onGamepadDisconnect:z,events:t.events}},"default"),$t,jt=($t=class{constructor(t,i,n,a={}){R(this,"ctx");R(this,"src",null);R(this,"glTex");R(this,"width");R(this,"height");this.ctx=t;let d=t.gl;this.glTex=t.gl.createTexture(),t.onDestroy(()=>this.free()),this.width=i,this.height=n;let u={linear:d.LINEAR,nearest:d.NEAREST}[a.filter??t.opts.texFilter]??d.NEAREST,w={repeat:d.REPEAT,clampToEadge:d.CLAMP_TO_EDGE}[a.wrap]??d.CLAMP_TO_EDGE;this.bind(),i&&n&&d.texImage2D(d.TEXTURE_2D,0,d.RGBA,i,n,0,d.RGBA,d.UNSIGNED_BYTE,null),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,u),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,u),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,w),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,w),this.unbind()}static fromImage(t,i,n={}){let a=new $t(t,i.width,i.height,n);return a.update(i),a.src=i,a}update(t,i=0,n=0){let a=this.ctx.gl;this.bind(),a.texSubImage2D(a.TEXTURE_2D,0,i,n,a.RGBA,a.UNSIGNED_BYTE,t),this.unbind()}bind(){this.ctx.pushTexture2D(this.glTex)}unbind(){this.ctx.popTexture2D()}free(){this.ctx.gl.deleteTexture(this.glTex)}},l($t,"Texture"),$t),ms,ks=(ms=class{constructor(t,i,n,a={}){R(this,"ctx");R(this,"tex");R(this,"glFramebuffer");R(this,"glRenderbuffer");this.ctx=t;let d=t.gl;t.onDestroy(()=>this.free()),this.tex=new jt(t,i,n,a),this.glFramebuffer=d.createFramebuffer(),this.glRenderbuffer=d.createRenderbuffer(),this.bind(),d.renderbufferStorage(d.RENDERBUFFER,d.DEPTH_STENCIL,i,n),d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,this.tex.glTex,0),d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_STENCIL_ATTACHMENT,d.RENDERBUFFER,this.glRenderbuffer),this.unbind()}get width(){return this.tex.width}get height(){return this.tex.height}toImageData(){let t=this.ctx.gl,i=new Uint8ClampedArray(this.width*this.height*4);this.bind(),t.readPixels(0,0,this.width,this.height,t.RGBA,t.UNSIGNED_BYTE,i),this.unbind();let n=this.width*4,a=new Uint8Array(n);for(let d=0;d<(this.height/2|0);d++){let u=d*n,w=(this.height-d-1)*n;a.set(i.subarray(u,u+n)),i.copyWithin(u,w,w+n),i.set(a,w)}return new ImageData(i,this.width,this.height)}toDataURL(){let t=document.createElement("canvas"),i=t.getContext("2d");return t.width=this.width,t.height=this.height,i.putImageData(this.toImageData(),0,0),t.toDataURL()}draw(t){this.bind(),t(),this.unbind()}bind(){this.ctx.pushFramebuffer(this.glFramebuffer),this.ctx.pushRenderbuffer(this.glRenderbuffer),this.ctx.pushViewport({x:0,y:0,w:this.width,h:this.height})}unbind(){this.ctx.popFramebuffer(),this.ctx.popRenderbuffer(),this.ctx.popViewport()}free(){let t=this.ctx.gl;t.deleteFramebuffer(this.glFramebuffer),t.deleteRenderbuffer(this.glRenderbuffer),this.tex.free()}},l(ms,"FrameBuffer"),ms),ws,Un=(ws=class{constructor(t,i,n,a){R(this,"ctx");R(this,"glProgram");this.ctx=t,t.onDestroy(()=>this.free());let d=t.gl,u=d.createShader(d.VERTEX_SHADER),w=d.createShader(d.FRAGMENT_SHADER);d.shaderSource(u,i),d.shaderSource(w,n),d.compileShader(u),d.compileShader(w);let A=d.createProgram();if(this.glProgram=A,d.attachShader(A,u),d.attachShader(A,w),a.forEach((m,G)=>d.bindAttribLocation(A,G,m)),d.linkProgram(A),!d.getProgramParameter(A,d.LINK_STATUS)){let m=d.getShaderInfoLog(u);if(m)throw new Error("VERTEX SHADER "+m);let G=d.getShaderInfoLog(w);if(G)throw new Error("FRAGMENT SHADER "+G)}d.deleteShader(u),d.deleteShader(w)}bind(){this.ctx.pushProgram(this.glProgram)}unbind(){this.ctx.popProgram()}send(t){let i=this.ctx.gl;for(let n in t){let a=t[n],d=i.getUniformLocation(this.glProgram,n);typeof a=="number"?i.uniform1f(d,a):a instanceof wt?i.uniformMatrix4fv(d,!1,new Float32Array(a.m)):a instanceof Fe?i.uniform3f(d,a.r,a.g,a.b):a instanceof C&&i.uniform2f(d,a.x,a.y)}}free(){this.ctx.gl.deleteProgram(this.glProgram)}},l(ws,"Shader"),ws),ys,On=(ys=class{constructor(t,i,n,a){R(this,"ctx");R(this,"glVBuf");R(this,"glIBuf");R(this,"vqueue",[]);R(this,"iqueue",[]);R(this,"stride");R(this,"maxVertices");R(this,"maxIndices");R(this,"vertexFormat");R(this,"numDraws",0);R(this,"curPrimitive",null);R(this,"curTex",null);R(this,"curShader",null);R(this,"curUniform",{});let d=t.gl;this.vertexFormat=i,this.ctx=t,this.stride=i.reduce((u,w)=>u+w.size,0),this.maxVertices=n,this.maxIndices=a,this.glVBuf=d.createBuffer(),t.pushArrayBuffer(this.glVBuf),d.bufferData(d.ARRAY_BUFFER,n*4,d.DYNAMIC_DRAW),t.popArrayBuffer(),this.glIBuf=d.createBuffer(),t.pushElementArrayBuffer(this.glIBuf),d.bufferData(d.ELEMENT_ARRAY_BUFFER,a*4,d.DYNAMIC_DRAW),t.popElementArrayBuffer()}push(t,i,n,a,d=null,u={}){(t!==this.curPrimitive||d!==this.curTex||a!==this.curShader||!ci(this.curUniform,u)||this.vqueue.length+i.length*this.stride>this.maxVertices||this.iqueue.length+n.length>this.maxIndices)&&this.flush();let w=this.vqueue.length/this.stride;for(let A of i)this.vqueue.push(A);for(let A of n)this.iqueue.push(A+w);this.curPrimitive=t,this.curShader=a,this.curTex=d,this.curUniform=u}flush(){var i,n;if(!this.curPrimitive||!this.curShader||this.vqueue.length===0||this.iqueue.length===0)return;let t=this.ctx.gl;this.ctx.pushArrayBuffer(this.glVBuf),t.bufferSubData(t.ARRAY_BUFFER,0,new Float32Array(this.vqueue)),this.ctx.pushElementArrayBuffer(this.glIBuf),t.bufferSubData(t.ELEMENT_ARRAY_BUFFER,0,new Uint16Array(this.iqueue)),this.ctx.setVertexFormat(this.vertexFormat),this.curShader.bind(),this.curShader.send(this.curUniform),(i=this.curTex)==null||i.bind(),t.drawElements(this.curPrimitive,this.iqueue.length,t.UNSIGNED_SHORT,0),(n=this.curTex)==null||n.unbind(),this.curShader.unbind(),this.ctx.popArrayBuffer(),this.ctx.popElementArrayBuffer(),this.vqueue=[],this.iqueue=[],this.numDraws++}free(){let t=this.ctx.gl;t.deleteBuffer(this.glVBuf),t.deleteBuffer(this.glIBuf)}},l(ys,"BatchRenderer"),ys);function Bt(e){let t=[],i=l(d=>{t.push(d),e(d)},"push"),n=l(()=>{t.pop(),e(a()??null)},"pop"),a=l(()=>t[t.length-1],"cur");return[i,n,a]}l(Bt,"genStack");function tn(e,t={}){let i=[];function n(W){i.push(W)}l(n,"onDestroy");function a(){i.forEach(W=>W()),e.getExtension("WEBGL_lose_context").loseContext()}l(a,"destroy");let d=null;function u(W){if(ci(W,d))return;d=W;let Z=W.reduce((ue,pe)=>ue+pe.size,0);W.reduce((ue,pe,ie)=>(e.vertexAttribPointer(ie,pe.size,e.FLOAT,!1,Z*4,ue),e.enableVertexAttribArray(ie),ue+pe.size*4),0)}l(u,"setVertexFormat");let[w,A]=Bt(W=>e.bindTexture(e.TEXTURE_2D,W)),[m,G]=Bt(W=>e.bindBuffer(e.ARRAY_BUFFER,W)),[v,L]=Bt(W=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,W)),[E,j]=Bt(W=>e.bindFramebuffer(e.FRAMEBUFFER,W)),[I,H]=Bt(W=>e.bindRenderbuffer(e.RENDERBUFFER,W)),[B,X]=Bt(({x:W,y:Z,w:ue,h:pe})=>{e.viewport(W,Z,ue,pe)}),[S,de]=Bt(W=>e.useProgram(W));return B({x:0,y:0,w:e.drawingBufferWidth,h:e.drawingBufferHeight}),{gl:e,opts:t,onDestroy:n,destroy:a,pushTexture2D:w,popTexture2D:A,pushArrayBuffer:m,popArrayBuffer:G,pushElementArrayBuffer:v,popElementArrayBuffer:L,pushFramebuffer:E,popFramebuffer:j,pushRenderbuffer:I,popRenderbuffer:H,pushViewport:B,popViewport:X,pushProgram:S,popProgram:de,setVertexFormat:u}}l(tn,"initGfx");var kt,ot=(kt=class{constructor(t){R(this,"loaded",!1);R(this,"data",null);R(this,"error",null);R(this,"onLoadEvents",new dt);R(this,"onErrorEvents",new dt);R(this,"onFinishEvents",new dt);t.then(i=>{this.data=i,this.onLoadEvents.trigger(i)}).catch(i=>{if(this.error=i,this.onErrorEvents.numListeners()>0)this.onErrorEvents.trigger(i);else throw i}).finally(()=>{this.onFinishEvents.trigger(),this.loaded=!0})}static loaded(t){let i=new kt(Promise.resolve(t));return i.data=t,i.loaded=!0,i}onLoad(t){return this.loaded&&this.data?t(this.data):this.onLoadEvents.add(t),this}onError(t){return this.loaded&&this.error?t(this.error):this.onErrorEvents.add(t),this}onFinish(t){return this.loaded?t():this.onFinishEvents.add(t),this}then(t){return this.onLoad(t)}catch(t){return this.onError(t)}finally(t){return this.onFinish(t)}},l(kt,"Asset"),kt),As,rs=(As=class{constructor(){R(this,"assets",new Map);R(this,"lastUID",0)}add(t,i){let n=t??this.lastUID+++"",a=new ot(i);return this.assets.set(n,a),a}addLoaded(t,i){let n=t??this.lastUID+++"",a=ot.loaded(i);return this.assets.set(n,a),a}get(t){return this.assets.get(t)}progress(){if(this.assets.size===0)return 1;let t=0;return this.assets.forEach(i=>{i.loaded&&t++}),t/this.assets.size}},l(As,"AssetBucket"),As);function ui(e){return fetch(e).then(t=>{if(!t.ok)throw new Error(`Failed to fetch "${e}"`);return t})}l(ui,"fetchURL");function zs(e){return ui(e).then(t=>t.json())}l(zs,"fetchJSON");function sn(e){return ui(e).then(t=>t.text())}l(sn,"fetchText");function rn(e){return ui(e).then(t=>t.arrayBuffer())}l(rn,"fetchArrayBuffer");function Bs(e){let t=new Image;return t.crossOrigin="anonymous",t.src=e,new Promise((i,n)=>{t.onload=()=>i(t),t.onerror=()=>n(new Error(`Failed to load image from "${e}"`))})}l(Bs,"loadImg");var ei=2.5949095,go=1.70158+1,mo=2*Math.PI/3,wo=2*Math.PI/4.5,li={linear:e=>e,easeInSine:e=>1-Math.cos(e*Math.PI/2),easeOutSine:e=>Math.sin(e*Math.PI/2),easeInOutSine:e=>-(Math.cos(Math.PI*e)-1)/2,easeInQuad:e=>e*e,easeOutQuad:e=>1-(1-e)*(1-e),easeInOutQuad:e=>e<.5?2*e*e:1-Math.pow(-2*e+2,2)/2,easeInCubic:e=>e*e*e,easeOutCubic:e=>1-Math.pow(1-e,3),easeInOutCubic:e=>e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2,easeInQuart:e=>e*e*e*e,easeOutQuart:e=>1-Math.pow(1-e,4),easeInOutQuart:e=>e<.5?8*e*e*e*e:1-Math.pow(-2*e+2,4)/2,easeInQuint:e=>e*e*e*e*e,easeOutQuint:e=>1-Math.pow(1-e,5),easeInOutQuint:e=>e<.5?16*e*e*e*e*e:1-Math.pow(-2*e+2,5)/2,easeInExpo:e=>e===0?0:Math.pow(2,10*e-10),easeOutExpo:e=>e===1?1:1-Math.pow(2,-10*e),easeInOutExpo:e=>e===0?0:e===1?1:e<.5?Math.pow(2,20*e-10)/2:(2-Math.pow(2,-20*e+10))/2,easeInCirc:e=>1-Math.sqrt(1-Math.pow(e,2)),easeOutCirc:e=>Math.sqrt(1-Math.pow(e-1,2)),easeInOutCirc:e=>e<.5?(1-Math.sqrt(1-Math.pow(2*e,2)))/2:(Math.sqrt(1-Math.pow(-2*e+2,2))+1)/2,easeInBack:e=>go*e*e*e-1.70158*e*e,easeOutBack:e=>1+go*Math.pow(e-1,3)+1.70158*Math.pow(e-1,2),easeInOutBack:e=>e<.5?Math.pow(2*e,2)*((ei+1)*2*e-ei)/2:(Math.pow(2*e-2,2)*((ei+1)*(e*2-2)+ei)+2)/2,easeInElastic:e=>e===0?0:e===1?1:-Math.pow(2,10*e-10)*Math.sin((e*10-10.75)*mo),easeOutElastic:e=>e===0?0:e===1?1:Math.pow(2,-10*e)*Math.sin((e*10-.75)*mo)+1,easeInOutElastic:e=>e===0?0:e===1?1:e<.5?-(Math.pow(2,20*e-10)*Math.sin((20*e-11.125)*wo))/2:Math.pow(2,-20*e+10)*Math.sin((20*e-11.125)*wo)/2+1,easeInBounce:e=>1-li.easeOutBounce(1-e),easeOutBounce:e=>e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375,easeInOutBounce:e=>e<.5?(1-li.easeOutBounce(1-2*e))/2:(1+li.easeOutBounce(2*e-1))/2},ti=li,xs,Gn=(xs=class{constructor(t,i,n){R(this,"textures",[]);R(this,"canvas");R(this,"c2d");R(this,"x",0);R(this,"y",0);R(this,"curHeight",0);R(this,"gfx");this.gfx=t,this.canvas=document.createElement("canvas"),this.canvas.width=i,this.canvas.height=n,this.textures=[jt.fromImage(t,this.canvas)],this.c2d=this.canvas.getContext("2d")}add(t){if(t.width>this.canvas.width||t.height>this.canvas.height)throw new Error(`Texture size (${t.width} x ${t.height}) exceeds limit (${this.canvas.width} x ${this.canvas.height})`);this.x+t.width>this.canvas.width&&(this.x=0,this.y+=this.curHeight,this.curHeight=0),this.y+t.height>this.canvas.height&&(this.c2d.clearRect(0,0,this.canvas.width,this.canvas.height),this.textures.push(jt.fromImage(this.gfx,this.canvas)),this.x=0,this.y=0,this.curHeight=0);let i=this.textures[this.textures.length-1],n=new C(this.x,this.y);return this.x+=t.width,t.height>this.curHeight&&(this.curHeight=t.height),t instanceof ImageData?this.c2d.putImageData(t,n.x,n.y):this.c2d.drawImage(t,n.x,n.y),i.update(this.canvas),[i,new Qe(n.x/this.canvas.width,n.y/this.canvas.height,t.width/this.canvas.width,t.height/this.canvas.height)]}free(){for(let t of this.textures)t.free()}},l(xs,"TexPacker"),xs),Kn="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD0AAAA1CAYAAADyMeOEAAAAAXNSR0IArs4c6QAAAoVJREFUaIHdm7txwkAQhheGAqACiCHzOKQDQrqgILpwSAeEDBnEUAF0gCMxZ7G72qce/mec2Lpf9+3unaS78wgSNZ8uX5729+d1FNWXUuGmXlBOUUEIMckEpeQJgBu6C+BSFngztBR2vd+ovY+7g+p6LbgaWgJrAeUkDYIUXgXdBBwNi6kpABJwMTQH3AZsXRR8GHTfgEth8E3gjdAUcNewpbTgY85sCMCUuOokozE0YM0YRzM9NGAAXd8+omAF5h4lnmBRvpSnZHyLoLEbaN+aKB9KWv/KWw0tAbbANnlG+UvB2dm77NxxdwgBpjrF/d7rW9cbmpvio2A5z8iAYpVU8pGZlo6/2+MSco2lHfd3rv9jAP038e1xef9o2mjvYb2OqpqKE81028/jeietlSEVO5FRWsxWsJit1G3aFpW8iWe5RwpiCZAk25QvV6nz6fIlynRGuTd5WqpJ4guAlDfVKBK87hXljflgv1ON6fV+4+5gVlA17SfeG0heKqQd4l4jI/wrmaA9N9R4ar+wpHJDZyrrfcH0nB66PqAzPi76pn+faSyJk/vzOorYhGurQrzj/P68jtBMawHaHBIR9xoD5O34dy0qQOSYHvqExq2TpT2nf76+w7y251OYF0CRaU+J920TwLUa6inx6OxE6g80lu2ux7Y2eJLF/rCXE6zEPdnenk9o+4ih9AEdnW2q81HXl5LuU6OTl2fXUhqganbXAGq3g6jJOWV/OnoesO6YqqEB/GdNsjf7uHtwj2DzmRNpp7iOZfm6D9oAxB6Yi1gC4oIYeo4MIPdopEQRB+cAko5J1tW386HpB2Kz1eop4Epdwls/kgZ1sh8gZsEjdcWkr//D8Qu3Z3l5Nl1NtAAAAABJRU5ErkJggg==",Hn=Sn("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L5QNSqT5iiySS9Ja2SV//5ME0ak//+4KgAAABgQBAADAMDgYCAEgCteQ0fZH6+ICXA357+MPfhR/+ywRf/U///LVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5JknQAFoWhGLm5gBClBmT3GiAAAAAGkHAAAIAAANIOAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV"),Yn="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOcAAACDCAYAAAB2kQxsAAAAAXNSR0IArs4c6QAABdRJREFUeJzt3d3N3TYMgGG16ADdoAhyl7UyV9bqXRB0g2zQXgRGDcOWSIoUaX3vAwQBknMk/4gWLcnHrQEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACDEb9kb8FH99eeXf6Wf/efn35ynDyj1pEsb6G6NUxOYZ7sdB/QtPdnWRnn29gbKMYDUspPs0SgPb22cHANo/JG9AZF6wWBp3JLgeir36bvff3x9LOvzp2/dbSFA97bk5I4a9VMD7TXOUcP0uJ+d6emu5d6V1QvMs5nj8FZPx37X/b2TFpzShtnafeP0DipJMFnLnN3/w1OQ7tZgP+pA4VVKcHo0TG36KNULKGt5XsHZmi1APS5WM2Vqg0i7vbsG6YcIznN9vRTxXHavgdxtv6Tc3vc1pAHqdaG6ipwKYprpf1sFp6aH0gRTrxxLubPB2avHu+c/l3mICvqnsr//+Cq+qGrK1Xw/wzbBaRkNvSv3yew9cq+cu89L6nu6F/cMzCgzF1ftANlbe+Otp1IkDVxyVfbo6Z481f3507dhvXfbrk3HpdtjKTNqKuio8678c7mzF6ns6arfMyrVNoA75wMfNU2hKSeCx3Fq7dc+SPfDc39H9Vqn2CT//4bsYeT1PecOJyGSJdh6PZOlbElPZz2PHtlD1cUeS4LT4z5IOihwfNaD5ERm9qxH/dZ7Vmt9M999CtCZbdLUP/p3r2zFQ0paG8lr4Eb6+ZWBcSeq/qhyK6bXUfXOSgtO7/tOb9eT1NveqKttpYbiyXu/euV51JV16/T6e86zyF5TUp731V5Sp+Z7M71h9QvFNWWuvr0Sy4LzLfNvrel6zRX1e+hN2VzrnNlfaYD0xhCs++851lDh3vNV95xe6YvHgb8bwbNcuc+f09wbaUj2dzYgjz93//5kh94t0quCM8OKK6glKKuM0EYHfhUZWd8WwenZa0rLsp6s2YY66o0k9WUvS4NManBaGuo1eDIHgUZ1ePdkntsfFaCz5VZJdStsxyt7ziMNXHEAK5yk1mqmhrMPf1fcp57Vqe3SqZTMEduZhqAZyaywFne0DVHngHTZ11bznE88l/1lBZ9meP8851plWkBCO7drmQvWnL/sY/fKtFaqN3iy6iofsQxNktJnTMgfPXJUz3w3VaP5vOQ7Iyszvy2DczSi+aYFET2jINUEqFcAS4+rV480WlwRWXe07dLa0YGvfl9kmbTvPZJ1TXGvn4t4yuRp+2aMgk27wkm63DIztU3vOVfueC8wK4zKWtK0M+nvJXmOdlt65MgFFCva06qsKz044SvjIiN5TjLaaHxhtNyyouXBGZ1WSn66Ivt+M7pRZAWoZsDq+t2emeM1am/WtHxFG9runrO1/n1CxLK7CilxJM/H4bwuTJJBvWtgvm0gcNu01uvpd8la1soLE7xkpYDea4Ot6W3GOSzRc3o/qHw2M9qmXWA+uw+jbd0hyO9Yz0+vJ9QGcO/8ZV2YUqYVPN8dImXp3aJ/w1XTGGYfKZN+P7IXiXqO1uINLzFOm/Pz+BV4C03PNEqpZl//ELXP1ro8nhLyKLPHMyAiXyvh4cMFZ2uyAJXc62gzgJl1nhrSLMEzcLx+5qQnIhgqv6qhTHC2Zmus1tUuowCVDkRU6j0jgiJqhLPSSq2q7wMtMSBkdbcQWjNCq2nMlRrTnajAPP/t+c5Sj3K8VNueQ+pGzaa2MyOb2sZseW2dpL6ZnjMzfeQFt/Fe3XP2WIfGvRY6a569jCJ9TaIlcCS9KQE5p1TP2VrMbwLNDlZEvpE5AkGxh9f2nLO/QOetytIwAnMf6SfS2ns+jaZ6B4i2sWvSvF0HWOAj/aRGNFAaPXbw2rS2Rzr0T/ChshKNM3qd4135BCaqK9VAKy+lAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/4DBC0k0jFtF9wAAAAASUVORK5CYII=",qn="data:image/png;base64,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",Qn="3000.1.17",yo=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~",si="topleft",Ao=64,Xn="monospace",ii="monospace",Wn=36,ri=64,oi=256,xo=2048,vo=2048,bo=2048,Eo=2048,Vo=.1,Jn=64,Bi="linear",jn=8,Zn=4,qi=[{name:"a_pos",size:2},{name:"a_uv",size:2},{name:"a_color",size:4}],_n=qi.reduce((e,t)=>e+t.size,0),on=2048,$n=on*4*_n,kn=on*6,ea=`
attribute vec2 a_pos;
attribute vec2 a_uv;
attribute vec4 a_color;

varying vec2 v_pos;
varying vec2 v_uv;
varying vec4 v_color;

vec4 def_vert() {
	return vec4(a_pos, 0.0, 1.0);
}

{{user}}

void main() {
	vec4 pos = vert(a_pos, a_uv, a_color);
	v_pos = a_pos;
	v_uv = a_uv;
	v_color = a_color;
	gl_Position = pos;
}
`,ta=`
precision mediump float;

varying vec2 v_pos;
varying vec2 v_uv;
varying vec4 v_color;

uniform sampler2D u_tex;

vec4 def_frag() {
	return v_color * texture2D(u_tex, v_uv);
}

{{user}}

void main() {
	gl_FragColor = frag(v_pos, v_uv, v_color, u_tex);
	if (gl_FragColor.a == 0.0) {
		discard;
	}
}
`,Li=`
vec4 vert(vec2 pos, vec2 uv, vec4 color) {
	return def_vert();
}
`,Ni=`
vec4 frag(vec2 pos, vec2 uv, vec4 color, sampler2D tex) {
	return def_frag();
}
`,sa=new Set(["id","require"]),ia=new Set(["add","update","draw","destroy","inspect","drawInspect"]);function Jt(e){switch(e){case"topleft":return new C(-1,-1);case"top":return new C(0,-1);case"topright":return new C(1,-1);case"left":return new C(-1,0);case"center":return new C(0,0);case"right":return new C(1,0);case"botleft":return new C(-1,1);case"bot":return new C(0,1);case"botright":return new C(1,1);default:return e}}l(Jt,"anchorPt");function nn(e){switch(e){case"left":return 0;case"center":return .5;case"right":return 1;default:return 0}}l(nn,"alignPt");function an(e){return e.createBuffer(1,1,44100)}l(an,"createEmptyAudioBuffer");var ra=l((e={})=>{let t=e.root??document.body;t===document.body&&(document.body.style.width="100%",document.body.style.height="100%",document.body.style.margin="0px",document.documentElement.style.width="100%",document.documentElement.style.height="100%");let i=e.canvas??(()=>{let s=document.createElement("canvas");return t.appendChild(s),s})(),n=e.scale??1,a=e.width&&e.height&&!e.stretch&&!e.letterbox;a?(i.width=e.width*n,i.height=e.height*n):(i.width=i.parentElement.offsetWidth,i.height=i.parentElement.offsetHeight);let d=["outline: none","cursor: default"];if(a){let s=i.width,r=i.height;d.push(`width: ${s}px`),d.push(`height: ${r}px`)}else d.push("width: 100%"),d.push("height: 100%");e.crisp&&(d.push("image-rendering: pixelated"),d.push("image-rendering: crisp-edges")),i.style.cssText=d.join(";");let u=e.pixelDensity||window.devicePixelRatio;i.width*=u,i.height*=u,i.tabIndex=0;let w=document.createElement("canvas");w.width=oi,w.height=oi;let A=w.getContext("2d",{willReadFrequently:!0}),m=Nn({canvas:i,touchToMouse:e.touchToMouse,gamepads:e.gamepads,pixelDensity:e.pixelDensity,maxFPS:e.maxFPS}),G=[],v=m.canvas.getContext("webgl",{antialias:!0,depth:!0,stencil:!0,alpha:!0,preserveDrawingBuffer:!0}),L=tn(v,{texFilter:e.texFilter}),E=(()=>{let s=rt(Li,Ni),r=jt.fromImage(L,new ImageData(new Uint8ClampedArray([255,255,255,255]),1,1)),o=e.width&&e.height?new ks(L,e.width*u*n,e.height*u*n):new ks(L,v.drawingBufferWidth,v.drawingBufferHeight),c=null,h=1;e.background&&(c=Me(e.background),h=Array.isArray(e.background)?e.background[3]:1,v.clearColor(c.r/255,c.g/255,c.b/255,h??1)),v.enable(v.BLEND),v.blendFuncSeparate(v.SRC_ALPHA,v.ONE_MINUS_SRC_ALPHA,v.ONE,v.ONE_MINUS_SRC_ALPHA);let p=new On(L,qi,$n,kn),b=jt.fromImage(L,new ImageData(new Uint8ClampedArray([128,128,128,255,190,190,190,255,190,190,190,255,128,128,128,255]),2,2),{wrap:"repeat",filter:"nearest"});return{lastDrawCalls:0,defShader:s,defTex:r,frameBuffer:o,postShader:null,postShaderUniform:null,renderer:p,transform:new wt,transformStack:[],bgTex:b,bgColor:c,bgAlpha:h,width:e.width??v.drawingBufferWidth/u/n,height:e.height??v.drawingBufferHeight/u/n,viewport:{x:0,y:0,width:v.drawingBufferWidth,height:v.drawingBufferHeight},fixed:!1}})();const Qt=class Qt{constructor(r,o,c={},h=null){R(this,"tex");R(this,"frames",[new Qe(0,0,1,1)]);R(this,"anims",{});R(this,"slice9",null);this.tex=r,o&&(this.frames=o),this.anims=c,this.slice9=h}get width(){return this.tex.width*this.frames[0].w}get height(){return this.tex.height*this.frames[0].h}static from(r,o={}){return typeof r=="string"?Qt.fromURL(r,o):Promise.resolve(Qt.fromImage(r,o))}static fromImage(r,o={}){let[c,h]=B.packer.add(r),p=o.frames?o.frames.map(b=>new Qe(h.x+b.x*h.w,h.y+b.y*h.h,b.w*h.w,b.h*h.h)):oe(o.sliceX||1,o.sliceY||1,h.x,h.y,h.w,h.h);return new Qt(c,p,o.anims,o.slice9)}static fromURL(r,o={}){return Bs(r).then(c=>Qt.fromImage(c,o))}};l(Qt,"SpriteData");let j=Qt;const is=class is{constructor(r){R(this,"buf");this.buf=r}static fromArrayBuffer(r){return new Promise((o,c)=>H.ctx.decodeAudioData(r,o,c)).then(o=>new is(o))}static fromURL(r){return po(r)?is.fromArrayBuffer(Yo(r)):rn(r).then(o=>is.fromArrayBuffer(o))}};l(is,"SoundData");let I=is,H=(()=>{let s=new(window.AudioContext||window.webkitAudioContext),r=s.createGain();r.connect(s.destination);let o=new I(an(s));return s.decodeAudioData(Hn.buffer.slice(0)).then(c=>{o.buf=c}).catch(c=>{console.error("Failed to load burp: ",c)}),{ctx:s,masterNode:r,burpSnd:o}})(),B={urlPrefix:"",sprites:new rs,fonts:new rs,bitmapFonts:new rs,sounds:new rs,shaders:new rs,custom:new rs,packer:new Gn(L,bo,Eo),loaded:!1};function X(s){return typeof s!="string"||po(s)?s:B.urlPrefix+s}l(X,"fixURL");let S={events:new Cs,objEvents:new Cs,root:Xs([]),gravity:0,scenes:{},logs:[],cam:{pos:null,scale:new C(1),angle:0,shake:0,transform:new wt}};S.root.use(js());function de(s){return B.custom.add(null,s)}l(de,"load");function W(){let s=[B.sprites,B.sounds,B.shaders,B.fonts,B.bitmapFonts,B.custom];return s.reduce((r,o)=>r+o.progress(),0)/s.length}l(W,"loadProgress");function Z(s){return s!==void 0&&(B.urlPrefix=s),B.urlPrefix}l(Z,"loadRoot");function ue(s,r){return B.custom.add(s,zs(r))}l(ue,"loadJSON");const Di=class Di{constructor(r,o={}){R(this,"fontface");R(this,"filter",Bi);R(this,"outline",null);R(this,"size",ri);if(this.fontface=r,this.filter=o.filter??Bi,this.size=o.size??ri,this.size>oi)throw new Error(`Max font size: ${oi}`);o.outline&&(this.outline={width:1,color:Me(0,0,0)},typeof o.outline=="number"?this.outline.width=o.outline:typeof o.outline=="object"&&(o.outline.width&&(this.outline.width=o.outline.width),o.outline.color&&(this.outline.color=o.outline.color)))}};l(Di,"FontData");let pe=Di;function ie(s,r,o={}){let c=new FontFace(s,typeof r=="string"?`url(${r})`:r);return document.fonts.add(c),B.fonts.add(s,c.load().catch(h=>{throw new Error(`Failed to load font from "${r}": ${h}`)}).then(h=>new pe(h,o)))}l(ie,"loadFont");function te(s,r,o,c,h={}){return B.bitmapFonts.add(s,Bs(r).then(p=>F(jt.fromImage(L,p,h),o,c,h.chars??yo)))}l(te,"loadBitmapFont");function oe(s=1,r=1,o=0,c=0,h=1,p=1){let b=[],T=h/s,V=p/r;for(let f=0;f<r;f++)for(let M=0;M<s;M++)b.push(new Qe(o+M*T,c+f*V,T,V));return b}l(oe,"slice");function O(s,r){return s=X(s),de(typeof r=="string"?new Promise((o,c)=>{zs(r).then(h=>{O(s,h).then(o).catch(c)})}):j.from(s).then(o=>{let c={};for(let h in r){let p=r[h],b=o.frames[0],T=bo*b.w,V=Eo*b.h,f=p.frames?p.frames.map(K=>new Qe(b.x+(p.x+K.x)/T*b.w,b.y+(p.y+K.y)/V*b.h,K.w/T*b.w,K.h/V*b.h)):oe(p.sliceX||1,p.sliceY||1,b.x+p.x/T*b.w,b.y+p.y/V*b.h,p.width/T*b.w,p.height/V*b.h),M=new j(o.tex,f,p.anims);B.sprites.addLoaded(h,M),c[h]=M}return c}))}l(O,"loadSpriteAtlas");function k(s,r={}){let o=document.createElement("canvas"),c=s[0].width,h=s[0].height;o.width=c*s.length,o.height=h;let p=o.getContext("2d");s.forEach((T,V)=>{T instanceof ImageData?p.putImageData(T,V*c,0):p.drawImage(T,V*c,0)});let b=p.getImageData(0,0,s.length*c,h);return j.fromImage(b,{...r,sliceX:s.length,sliceY:1})}l(k,"createSpriteSheet");function se(s,r,o={sliceX:1,sliceY:1,anims:{}}){return r=X(r),Array.isArray(r)?r.some(c=>typeof c=="string")?B.sprites.add(s,Promise.all(r.map(c=>typeof c=="string"?Bs(c):Promise.resolve(c))).then(c=>k(c,o))):B.sprites.addLoaded(s,k(r,o)):typeof r=="string"?B.sprites.add(s,j.from(r,o)):B.sprites.addLoaded(s,j.fromImage(r,o))}l(se,"loadSprite");function Se(s,r){return r=X(r),B.sprites.add(s,new Promise(async o=>{let c=typeof r=="string"?await zs(r):r,h=await Promise.all(c.frames.map(Bs)),p=document.createElement("canvas");p.width=c.width,p.height=c.height*c.frames.length;let b=p.getContext("2d");h.forEach((V,f)=>{b.drawImage(V,0,f*c.height)});let T=await se(null,p,{sliceY:c.frames.length,anims:c.anims});o(T)}))}l(Se,"loadPedit");function Ee(s,r,o){r=X(r),o=X(o),typeof r=="string"&&!o&&(o=Rn(r)+".json");let c=typeof o=="string"?zs(o):Promise.resolve(o);return B.sprites.add(s,c.then(h=>{let p=h.meta.size,b=h.frames.map(V=>new Qe(V.frame.x/p.w,V.frame.y/p.h,V.frame.w/p.w,V.frame.h/p.h)),T={};for(let V of h.meta.frameTags)V.from===V.to?T[V.name]=V.from:T[V.name]={from:V.from,to:V.to,speed:10,loop:!0,pingpong:V.direction==="pingpong"};return j.from(r,{frames:b,anims:T})}))}l(Ee,"loadAseprite");function Mt(s,r,o){return B.shaders.addLoaded(s,rt(r,o))}l(Mt,"loadShader");function at(s,r,o){r=X(r),o=X(o);let c=l(p=>p?sn(p):Promise.resolve(null),"resolveUrl"),h=Promise.all([c(r),c(o)]).then(([p,b])=>rt(p,b));return B.shaders.add(s,h)}l(at,"loadShaderURL");function ut(s,r){return r=X(r),B.sounds.add(s,typeof r=="string"?I.fromURL(r):I.fromArrayBuffer(r))}l(ut,"loadSound");function ye(s="bean"){return se(s,Kn)}l(ye,"loadBean");function be(s){return B.sprites.get(s)}l(be,"getSprite");function he(s){return B.sounds.get(s)}l(he,"getSound");function re(s){return B.fonts.get(s)}l(re,"getFont");function ve(s){return B.bitmapFonts.get(s)}l(ve,"getBitmapFont");function Ne(s){return B.shaders.get(s)}l(Ne,"getShader");function Be(s){return B.custom.get(s)}l(Be,"getAsset");function Je(s){if(typeof s=="string"){let r=be(s);if(r)return r;if(W()<1)return null;throw new Error(`Sprite not found: ${s}`)}else{if(s instanceof j)return ot.loaded(s);if(s instanceof ot)return s;throw new Error(`Invalid sprite: ${s}`)}}l(Je,"resolveSprite");function pt(s){if(typeof s=="string"){let r=he(s);if(r)return r;if(W()<1)return null;throw new Error(`Sound not found: ${s}`)}else{if(s instanceof I)return ot.loaded(s);if(s instanceof ot)return s;throw new Error(`Invalid sound: ${s}`)}}l(pt,"resolveSound");function lt(s){if(!s)return E.defShader;if(typeof s=="string"){let r=Ne(s);if(r)return r.data??r;if(W()<1)return null;throw new Error(`Shader not found: ${s}`)}else if(s instanceof ot)return s.data?s.data:s;return s}l(lt,"resolveShader");function Pt(s){if(!s)return Pt(e.font??Xn);if(typeof s=="string"){let r=ve(s),o=re(s);if(r)return r.data??r;if(o)return o.data??o;if(document.fonts.check(`${ri}px ${s}`))return s;if(W()<1)return null;throw new Error(`Font not found: ${s}`)}else if(s instanceof ot)return s.data?s.data:s;return s}l(Pt,"resolveFont");function Tt(s){return s!==void 0&&(H.masterNode.gain.value=s),H.masterNode.gain.value}l(Tt,"volume");function Ft(s,r={}){let o=H.ctx,c=r.paused??!1,h=o.createBufferSource(),p=new dt,b=o.createGain(),T=r.seek??0,V=0,f=0,M=!1;h.loop=!!r.loop,h.detune.value=r.detune??0,h.playbackRate.value=r.speed??1,h.connect(b),h.onended=()=>{var q;ne()>=((q=h.buffer)==null?void 0:q.duration)&&p.trigger()},b.connect(H.masterNode),b.gain.value=r.volume??1;let K=l(q=>{h.buffer=q.buf,c||(V=o.currentTime,h.start(0,T),M=!0)},"start"),J=pt(s);J instanceof ot&&J.onLoad(K);let ne=l(()=>{if(!h.buffer)return 0;let q=c?f-V:o.currentTime-V,ee=h.buffer.duration;return h.loop?q%ee:Math.min(q,ee)},"getTime"),ae=l(q=>{let ee=o.createBufferSource();return ee.buffer=q.buffer,ee.loop=q.loop,ee.playbackRate.value=q.playbackRate.value,ee.detune.value=q.detune.value,ee.onended=q.onended,ee.connect(b),ee},"cloneNode");return{stop(){this.paused=!0,this.seek(0)},set paused(q){if(c!==q)if(c=q,q)M&&(h.stop(),M=!1),f=o.currentTime;else{h=ae(h);let ee=f-V;h.start(0,ee),M=!0,V=o.currentTime-ee,f=0}},get paused(){return c},play(q=0){this.seek(q),this.paused=!1},seek(q){var ee;(ee=h.buffer)!=null&&ee.duration&&(q>h.buffer.duration||(c?(h=ae(h),V=f-q):(h.stop(),h=ae(h),V=o.currentTime-q,h.start(0,q),M=!0,f=0)))},set speed(q){h.playbackRate.value=q},get speed(){return h.playbackRate.value},set detune(q){h.detune.value=q},get detune(){return h.detune.value},set volume(q){b.gain.value=Math.max(q,0)},get volume(){return b.gain.value},set loop(q){h.loop=q},get loop(){return h.loop},duration(){var q;return((q=h.buffer)==null?void 0:q.duration)??0},time(){return ne()%this.duration()},onEnd(q){return p.add(q)},then(q){return this.onEnd(q)}}}l(Ft,"play");function Rt(s){return Ft(H.burpSnd,s)}l(Rt,"burp");function ft(s,r){return new ks(L,s,r)}l(ft,"makeCanvas");function rt(s=Li,r=Ni){let o=ea.replace("{{user}}",s??Li),c=ta.replace("{{user}}",r??Ni);try{return new Un(L,o,c,qi.map(h=>h.name))}catch(h){let p=/(?<type>^\w+) SHADER ERROR: 0:(?<line>\d+): (?<msg>.+)/,b=In(h).match(p),T=Number(b.groups.line)-14,V=b.groups.msg.trim(),f=b.groups.type.toLowerCase();throw new Error(`${f} shader line ${T}: ${V}`)}}l(rt,"makeShader");function F(s,r,o,c){let h=s.width/r,p={},b=c.split("").entries();for(let[T,V]of b)p[V]=new Qe(T%h*r,Math.floor(T/h)*o,r,o);return{tex:s,map:p,size:o}}l(F,"makeFont");function z(s,r,o,c=E.defTex,h=E.defShader,p={}){let b=lt(h);if(!b||b instanceof ot)return;let T=E.fixed||o?E.transform:S.cam.transform.mult(E.transform),V=[];for(let f of s){let M=$e(T.multVec2(f.pos));V.push(M.x,M.y,f.uv.x,f.uv.y,f.color.r/255,f.color.g/255,f.color.b/255,f.opacity)}E.renderer.push(v.TRIANGLES,V,r,b,c,p)}l(z,"drawRaw");function _(){E.renderer.flush()}l(_,"flush");function ge(){v.clear(v.COLOR_BUFFER_BIT),E.frameBuffer.bind(),v.clear(v.COLOR_BUFFER_BIT),E.bgColor||tt(()=>{mt({width:We(),height:Ze(),quad:new Qe(0,0,We()/Ao,Ze()/Ao),tex:E.bgTex,fixed:!0})}),E.renderer.numDraws=0,E.fixed=!1,E.transformStack.length=0,E.transform=new wt}l(ge,"frameStart");function je(s,r){E.postShader=s,E.postShaderUniform=r??null}l(je,"usePostEffect");function Ve(){_(),E.lastDrawCalls=E.renderer.numDraws,E.frameBuffer.unbind(),v.viewport(0,0,v.drawingBufferWidth,v.drawingBufferHeight);let s=E.width,r=E.height;E.width=v.drawingBufferWidth/u,E.height=v.drawingBufferHeight/u,Dt({flipY:!0,tex:E.frameBuffer.tex,pos:new C(E.viewport.x,E.viewport.y),width:E.viewport.width,height:E.viewport.height,shader:E.postShader,uniform:typeof E.postShaderUniform=="function"?E.postShaderUniform():E.postShaderUniform,fixed:!0}),_(),E.width=s,E.height=r}l(Ve,"frameEnd");function $e(s){return new C(s.x/We()*2-1,-s.y/Ze()*2+1)}l($e,"screen2ndc");function es(s){E.transform=s.clone()}l(es,"pushMatrix");function Pe(...s){if(s[0]===void 0)return;let r=U(...s);r.x===0&&r.y===0||E.transform.translate(r)}l(Pe,"pushTranslate");function gt(...s){if(s[0]===void 0)return;let r=U(...s);r.x===1&&r.y===1||E.transform.scale(r)}l(gt,"pushScale");function De(s){s&&E.transform.rotate(s)}l(De,"pushRotate");function Oe(){E.transformStack.push(E.transform.clone())}l(Oe,"pushTransform");function Le(){E.transformStack.length>0&&(E.transform=E.transformStack.pop())}l(Le,"popTransform");function mt(s){if(s.width===void 0||s.height===void 0)throw new Error('drawUVQuad() requires property "width" and "height".');if(s.width<=0||s.height<=0)return;let r=s.width,o=s.height,c=Jt(s.anchor||si).scale(new C(r,o).scale(-.5)),h=s.quad||new Qe(0,0,1,1),p=s.color||Me(255,255,255),b=s.opacity??1,T=s.tex?Vo/s.tex.width:0,V=s.tex?Vo/s.tex.height:0,f=h.x+T,M=h.y+V,K=h.w-T*2,J=h.h-V*2;Oe(),Pe(s.pos),De(s.angle),gt(s.scale),Pe(c),z([{pos:new C(-r/2,o/2),uv:new C(s.flipX?f+K:f,s.flipY?M:M+J),color:p,opacity:b},{pos:new C(-r/2,-o/2),uv:new C(s.flipX?f+K:f,s.flipY?M+J:M),color:p,opacity:b},{pos:new C(r/2,-o/2),uv:new C(s.flipX?f:f+K,s.flipY?M+J:M),color:p,opacity:b},{pos:new C(r/2,o/2),uv:new C(s.flipX?f:f+K,s.flipY?M:M+J),color:p,opacity:b}],[0,1,3,1,2,3],s.fixed,s.tex,s.shader,s.uniform),Le()}l(mt,"drawUVQuad");function Dt(s){if(!s.tex)throw new Error('drawTexture() requires property "tex".');let r=s.quad??new Qe(0,0,1,1),o=s.tex.width*r.w,c=s.tex.height*r.h,h=new C(1);if(s.tiled){let p=Math.ceil((s.width||o)/o),b=Math.ceil((s.height||c)/c),T=Jt(s.anchor||si).add(new C(1,1)).scale(.5).scale(p*o,b*c);for(let V=0;V<p;V++)for(let f=0;f<b;f++)mt(Object.assign({},s,{pos:(s.pos||new C(0)).add(new C(o*V,c*f)).sub(T),scale:h.scale(s.scale||new C(1)),tex:s.tex,quad:r,width:o,height:c,anchor:"topleft"}))}else s.width&&s.height?(h.x=s.width/o,h.y=s.height/c):s.width?(h.x=s.width/o,h.y=h.x):s.height&&(h.y=s.height/c,h.x=h.y),mt(Object.assign({},s,{scale:h.scale(s.scale||new C(1)),tex:s.tex,quad:r,width:o,height:c}))}l(Dt,"drawTexture");function Qs(s){if(!s.sprite)throw new Error('drawSprite() requires property "sprite"');let r=Je(s.sprite);if(!r||!r.data)return;let o=r.data.frames[s.frame??0];if(!o)throw new Error(`Frame not found: ${s.frame??0}`);Dt(Object.assign({},s,{tex:r.data.tex,quad:o.scale(s.quad??new Qe(0,0,1,1))}))}l(Qs,"drawSprite");function At(s,r,o,c,h,p=1){c=yt(c%360),h=yt(h%360),h<=c&&(h+=Math.PI*2);let b=[],T=Math.ceil((h-c)/yt(8)*p),V=(h-c)/T;for(let f=c;f<h;f+=V)b.push(s.add(r*Math.cos(f),o*Math.sin(f)));return b.push(s.add(r*Math.cos(h),o*Math.sin(h))),b}l(At,"getArcPts");function Xe(s){if(s.width===void 0||s.height===void 0)throw new Error('drawRect() requires property "width" and "height".');if(s.width<=0||s.height<=0)return;let r=s.width,o=s.height,c=Jt(s.anchor||si).add(1,1).scale(new C(r,o).scale(-.5)),h=[new C(0,0),new C(r,0),new C(r,o),new C(0,o)];if(s.radius){let p=Math.min(Math.min(r,o)/2,s.radius);h=[new C(p,0),new C(r-p,0),...At(new C(r-p,p),p,p,270,360),new C(r,p),new C(r,o-p),...At(new C(r-p,o-p),p,p,0,90),new C(r-p,o),new C(p,o),...At(new C(p,o-p),p,p,90,180),new C(0,o-p),new C(0,p),...At(new C(p,p),p,p,180,270)]}Ke(Object.assign({},s,{offset:c,pts:h,...s.gradient?{colors:s.horizontal?[s.gradient[0],s.gradient[1],s.gradient[1],s.gradient[0]]:[s.gradient[0],s.gradient[0],s.gradient[1],s.gradient[1]]}:{}}))}l(Xe,"drawRect");function g(s){let{p1:r,p2:o}=s;if(!r||!o)throw new Error('drawLine() requires properties "p1" and "p2".');let c=s.width||1,h=o.sub(r).unit().normal().scale(c*.5),p=[r.sub(h),r.add(h),o.add(h),o.sub(h)].map(b=>({pos:new C(b.x,b.y),uv:new C(0),color:s.color??Fe.WHITE,opacity:s.opacity??1}));z(p,[0,1,3,1,2,3],s.fixed,E.defTex,s.shader,s.uniform)}l(g,"drawLine");function D(s){let r=s.pts;if(!r)throw new Error('drawLines() requires property "pts".');if(!(r.length<2))if(s.radius&&r.length>=3){let o=r[0].sdist(r[1]);for(let c=1;c<r.length-1;c++)o=Math.min(r[c].sdist(r[c+1]),o);Math.min(s.radius,Math.sqrt(o)/2),g(Object.assign({},s,{p1:r[0],p2:r[1]}));for(let c=1;c<r.length-2;c++){let h=r[c],p=r[c+1];g(Object.assign({},s,{p1:h,p2:p}))}g(Object.assign({},s,{p1:r[r.length-2],p2:r[r.length-1]}))}else for(let o=0;o<r.length-1;o++)g(Object.assign({},s,{p1:r[o],p2:r[o+1]})),s.join!=="none"&&le(Object.assign({},s,{pos:r[o],radius:s.width/2}))}l(D,"drawLines");function N(s){if(!s.p1||!s.p2||!s.p3)throw new Error('drawTriangle() requires properties "p1", "p2" and "p3".');return Ke(Object.assign({},s,{pts:[s.p1,s.p2,s.p3]}))}l(N,"drawTriangle");function le(s){if(typeof s.radius!="number")throw new Error('drawCircle() requires property "radius".');s.radius!==0&&Ae(Object.assign({},s,{radiusX:s.radius,radiusY:s.radius,angle:0}))}l(le,"drawCircle");function Ae(s){if(s.radiusX===void 0||s.radiusY===void 0)throw new Error('drawEllipse() requires properties "radiusX" and "radiusY".');if(s.radiusX===0||s.radiusY===0)return;let r=s.start??0,o=s.end??360,c=Jt(s.anchor??"center").scale(new C(-s.radiusX,-s.radiusY)),h=At(c,s.radiusX,s.radiusY,r,o,s.resolution);h.unshift(c);let p=Object.assign({},s,{pts:h,radius:0,...s.gradient?{colors:[s.gradient[0],...Array(h.length-1).fill(s.gradient[1])]}:{}});if(o-r>=360&&s.outline){s.fill!==!1&&Ke(Object.assign(p,{outline:null})),Ke(Object.assign(p,{pts:h.slice(1),fill:!1}));return}Ke(p)}l(Ae,"drawEllipse");function Ke(s){if(!s.pts)throw new Error('drawPolygon() requires property "pts".');let r=s.pts.length;if(!(r<3)){if(Oe(),Pe(s.pos),gt(s.scale),De(s.angle),Pe(s.offset),s.fill!==!1){let o=s.color??Fe.WHITE,c=s.pts.map((p,b)=>({pos:new C(p.x,p.y),uv:new C(0,0),color:s.colors&&s.colors[b]?s.colors[b].mult(o):o,opacity:s.opacity??1})),h=[...Array(r-2).keys()].map(p=>[0,p+1,p+2]).flat();z(c,s.indices??h,s.fixed,E.defTex,s.shader,s.uniform)}s.outline&&D({pts:[...s.pts,s.pts[0]],radius:s.radius,width:s.outline.width,color:s.outline.color,join:s.outline.join,uniform:s.uniform,fixed:s.fixed,opacity:s.opacity}),Le()}}l(Ke,"drawPolygon");function et(s,r,o){_(),v.clear(v.STENCIL_BUFFER_BIT),v.enable(v.STENCIL_TEST),v.stencilFunc(v.NEVER,1,255),v.stencilOp(v.REPLACE,v.REPLACE,v.REPLACE),r(),_(),v.stencilFunc(o,1,255),v.stencilOp(v.KEEP,v.KEEP,v.KEEP),s(),_(),v.disable(v.STENCIL_TEST)}l(et,"drawStenciled");function bs(s,r){et(s,r,v.EQUAL)}l(bs,"drawMasked");function Es(s,r){et(s,r,v.NOTEQUAL)}l(Es,"drawSubtracted");function ct(){return(E.viewport.width+E.viewport.height)/(E.width+E.height)}l(ct,"getViewportScale");function tt(s){_();let r=E.width,o=E.height;E.width=E.viewport.width,E.height=E.viewport.height,s(),_(),E.width=r,E.height=o}l(tt,"drawUnscaled");function pi(s,r){r.pos&&(s.pos=s.pos.add(r.pos)),r.scale&&(s.scale=s.scale.scale(U(r.scale))),r.angle&&(s.angle+=r.angle),r.color&&s.ch.length===1&&(s.color=s.color.mult(r.color)),r.opacity&&(s.opacity*=r.opacity)}l(pi,"applyCharTransform");let $i=/\[(?<style>\w+)\](?<text>.*?)\[\/\k<style>\]/g;function ki(s){let r={},o=s.replace($i,"$2"),c=0;for(let h of s.matchAll($i)){let p=h.index-c;for(let b=0;b<h.groups.text.length;b++)r[b+p]=[h.groups.style];c+=h[0].length-h.groups.text.length}return{charStyleMap:r,text:o}}l(ki,"compileStyledText");let fi={};function It(s){var Ge,He;if(s.text===void 0)throw new Error('formatText() requires property "text".');let r=Pt(s.font);if(s.text===""||r instanceof ot||!r)return{width:0,height:0,chars:[],opt:s};let{charStyleMap:o,text:c}=ki(s.text+""),h=Qo(c);if(r instanceof pe||typeof r=="string"){let ze=r instanceof pe?r.fontface.family:r,Re=r instanceof pe?{outline:r.outline,filter:r.filter}:{outline:null,filter:Bi},P=fi[ze]??{font:{tex:new jt(L,xo,vo,{filter:Re.filter}),map:{},size:ri},cursor:new C(0),outline:Re.outline};fi[ze]||(fi[ze]=P),r=P.font;for(let Q of h)if(!P.font.map[Q]){let Y=A;Y.clearRect(0,0,w.width,w.height),Y.font=`${r.size}px ${ze}`,Y.textBaseline="top",Y.textAlign="left",Y.fillStyle="#ffffff";let $=Y.measureText(Q),me=Math.ceil($.width),fe=r.size;P.outline&&(Y.lineJoin="round",Y.lineWidth=P.outline.width*2,Y.strokeStyle=P.outline.color.toHex(),Y.strokeText(Q,P.outline.width,P.outline.width),me+=P.outline.width*2,fe+=P.outline.width*3),Y.fillText(Q,((Ge=P.outline)==null?void 0:Ge.width)??0,((He=P.outline)==null?void 0:He.width)??0);let Te=Y.getImageData(0,0,me,fe);if(P.cursor.x+me>xo&&(P.cursor.x=0,P.cursor.y+=fe,P.cursor.y>vo))throw new Error("Font atlas exceeds character limit");r.tex.update(Te,P.cursor.x,P.cursor.y),r.map[Q]=new Qe(P.cursor.x,P.cursor.y,me,fe),P.cursor.x+=me}}let p=s.size||r.size,b=U(s.scale??1).scale(p/r.size),T=s.lineSpacing??0,V=s.letterSpacing??0,f=0,M=0,K=0,J=[],ne=[],ae=0,q=null,ee=null;for(;ae<h.length;){let ze=h[ae];if(ze===`
`)K+=p+T,J.push({width:f-V,chars:ne}),q=null,ee=null,f=0,ne=[];else{let Re=r.map[ze];if(Re){let P=Re.w*b.x;s.width&&f+P>s.width&&(K+=p+T,q!=null&&(ae-=ne.length-q,ze=h[ae],Re=r.map[ze],P=Re.w*b.x,ne=ne.slice(0,q-1),f=ee),q=null,ee=null,J.push({width:f-V,chars:ne}),f=0,ne=[]),ne.push({tex:r.tex,width:Re.w,height:Re.h,quad:new Qe(Re.x/r.tex.width,Re.y/r.tex.height,Re.w/r.tex.width,Re.h/r.tex.height),ch:ze,pos:new C(f,K),opacity:s.opacity??1,color:s.color??Fe.WHITE,scale:U(b),angle:0}),ze===" "&&(q=ne.length,ee=f),f+=P,M=Math.max(M,f),f+=V}}ae++}J.push({width:f-V,chars:ne}),K+=p,s.width&&(M=s.width);let st=[];for(let ze of J){let Re=(M-ze.width)*nn(s.align??"left");for(let P of ze.chars){let Q=r.map[P.ch],Y=st.length;if(P.pos=P.pos.add(Re,0).add(Q.w*b.x*.5,Q.h*b.y*.5),s.transform){let $=typeof s.transform=="function"?s.transform(Y,P.ch):s.transform;$&&pi(P,$)}if(o[Y]){let $=o[Y];for(let me of $){let fe=s.styles[me],Te=typeof fe=="function"?fe(Y,P.ch):fe;Te&&pi(P,Te)}}st.push(P)}}return{width:M,height:K,chars:st,opt:s}}l(It,"formatText");function gi(s){Ct(It(s))}l(gi,"drawText");function Ct(s){Oe(),Pe(s.opt.pos),De(s.opt.angle),Pe(Jt(s.opt.anchor??"topleft").add(1,1).scale(s.width,s.height).scale(-.5)),s.chars.forEach(r=>{mt({tex:r.tex,width:r.width,height:r.height,pos:r.pos,scale:r.scale,angle:r.angle,color:r.color,opacity:r.opacity,quad:r.quad,anchor:"center",uniform:s.opt.uniform,shader:s.opt.shader,fixed:s.opt.fixed})}),Le()}l(Ct,"drawFormattedText");function We(){return E.width}l(We,"width");function Ze(){return E.height}l(Ze,"height");function er(s){return new C((s.x-E.viewport.x)*We()/E.viewport.width,(s.y-E.viewport.y)*Ze()/E.viewport.height)}l(er,"windowToContent");function tr(s){return new C(s.x*E.viewport.width/E.width,s.y*E.viewport.height/E.height)}l(tr,"contentToView");function Vs(){return er(m.mousePos())}l(Vs,"mousePos");let sr=!1,Ie={inspect:!1,timeScale:1,showLog:!0,fps:()=>m.fps(),numFrames:()=>m.numFrames(),stepFrame:Mi,drawCalls:()=>E.lastDrawCalls,clearLog:()=>S.logs=[],log:s=>{let r=e.logMax??jn;S.logs.unshift({msg:s,time:m.time()}),S.logs.length>r&&(S.logs=S.logs.slice(0,r))},error:s=>Ie.log(new Error(s.toString?s.toString():s)),curRecording:null,numObjects:()=>Ei("*",{recursive:!0}).length,get paused(){return sr},set paused(s){sr=s,s?H.ctx.suspend():H.ctx.resume()}};function ht(){return m.dt()*Ie.timeScale}l(ht,"dt");function ir(...s){return s.length>0&&(S.cam.pos=U(...s)),S.cam.pos?S.cam.pos.clone():Fs()}l(ir,"camPos");function rr(...s){return s.length>0&&(S.cam.scale=U(...s)),S.cam.scale.clone()}l(rr,"camScale");function or(s){return s!==void 0&&(S.cam.angle=s),S.cam.angle}l(or,"camRot");function nr(s=12){S.cam.shake+=s}l(nr,"shake");function mi(s){return S.cam.transform.multVec2(s)}l(mi,"toScreen");function wi(s){return S.cam.transform.invert().multVec2(s)}l(wi,"toWorld");function Ss(s){let r=new wt;return s.pos&&r.translate(s.pos),s.scale&&r.scale(s.scale),s.angle&&r.rotate(s.angle),s.parent?r.mult(s.parent.transform):r}l(Ss,"calcTransform");function Xs(s=[]){let r=new Map,o={},c=new Cs,h=[],p=null,b=!1,T={id:Dn(),hidden:!1,transform:new wt,children:[],parent:null,set paused(f){if(f!==b){b=f;for(let M of h)M.paused=f}},get paused(){return b},add(f=[]){let M=Array.isArray(f)?Xs(f):f;if(M.parent)throw new Error("Cannot add a game obj that already has a parent.");return M.parent=this,M.transform=Ss(M),this.children.push(M),M.trigger("add",M),S.events.trigger("add",M),M},readd(f){let M=this.children.indexOf(f);return M!==-1&&(this.children.splice(M,1),this.children.push(f)),f},remove(f){let M=this.children.indexOf(f);if(M!==-1){f.parent=null,this.children.splice(M,1);let K=l(J=>{J.trigger("destroy"),S.events.trigger("destroy",J),J.children.forEach(ne=>K(ne))},"trigger");K(f)}},removeAll(f){if(f)this.get(f).forEach(M=>this.remove(M));else for(let M of[...this.children])this.remove(M)},update(){this.paused||(this.children.sort((f,M)=>(f.z??0)-(M.z??0)).forEach(f=>f.update()),this.trigger("update"))},draw(){if(this.hidden)return;this.canvas&&this.canvas.bind();let f=E.fixed;this.fixed&&(E.fixed=!0),Oe(),Pe(this.pos),gt(this.scale),De(this.angle);let M=this.children.sort((K,J)=>(K.z??0)-(J.z??0));if(this.mask){let K={intersect:bs,subtract:Es}[this.mask];if(!K)throw new Error(`Invalid mask func: "${this.mask}"`);K(()=>{M.forEach(J=>J.draw())},()=>{this.trigger("draw")})}else this.trigger("draw"),M.forEach(K=>K.draw());Le(),E.fixed=f,this.canvas&&this.canvas.unbind()},drawInspect(){this.hidden||(Oe(),Pe(this.pos),gt(this.scale),De(this.angle),this.children.sort((f,M)=>(f.z??0)-(M.z??0)).forEach(f=>f.drawInspect()),this.trigger("drawInspect"),Le())},use(f){if(!f)return;if(typeof f=="string")return this.use({id:f});let M=[];f.id&&(this.unuse(f.id),o[f.id]=[],M=o[f.id],r.set(f.id,f));for(let J in f){if(sa.has(J))continue;let ne=Object.getOwnPropertyDescriptor(f,J);if(typeof ne.value=="function"&&(f[J]=f[J].bind(this)),ne.set&&Object.defineProperty(f,J,{set:ne.set.bind(this)}),ne.get&&Object.defineProperty(f,J,{get:ne.get.bind(this)}),ia.has(J)){let ae=J==="add"?()=>{p=l(q=>M.push(q),"onCurCompCleanup"),f[J](),p=null}:f[J];M.push(this.on(J,ae).cancel)}else if(this[J]===void 0)Object.defineProperty(this,J,{get:()=>f[J],set:ae=>f[J]=ae,configurable:!0,enumerable:!0}),M.push(()=>delete this[J]);else throw new Error(`Duplicate component property: "${J}"`)}let K=l(()=>{if(f.require){for(let J of f.require)if(!this.c(J))throw new Error(`Component "${f.id}" requires component "${J}"`)}},"checkDeps");f.destroy&&M.push(f.destroy.bind(this)),this.exists()?(K(),f.add&&(p=l(J=>M.push(J),"onCurCompCleanup"),f.add.call(this),p=null)):f.require&&M.push(this.on("add",K).cancel)},unuse(f){o[f]&&(o[f].forEach(M=>M()),delete o[f]),r.has(f)&&r.delete(f)},c(f){return r.get(f)},get(f,M={}){let K=M.recursive?this.children.flatMap(l(function J(ne){return[ne,...ne.children.flatMap(J)]},"recurse")):this.children;if(K=K.filter(J=>f?J.is(f):!0),M.liveUpdate){let J=l(ae=>M.recursive?this.isAncestorOf(ae):ae.parent===this,"isChild"),ne=[];ne.push(yi(ae=>{J(ae)&&ae.is(f)&&K.push(ae)})),ne.push(ar(ae=>{if(J(ae)&&ae.is(f)){let q=K.findIndex(ee=>ee.id===ae.id);q!==-1&&K.splice(q,1)}})),this.onDestroy(()=>{for(let ae of ne)ae.cancel()})}return K},isAncestorOf(f){return f.parent?f.parent===this||this.isAncestorOf(f.parent):!1},exists(){return S.root.isAncestorOf(this)},is(f){if(f==="*")return!0;if(Array.isArray(f)){for(let M of f)if(!this.c(M))return!1;return!0}else return this.c(f)!=null},on(f,M){let K=c.on(f,M.bind(this));return p&&p(()=>K.cancel()),K},trigger(f,...M){c.trigger(f,...M),S.objEvents.trigger(f,this,...M)},destroy(){this.parent&&this.parent.remove(this)},inspect(){let f={};for(let[M,K]of r)f[M]=K.inspect?K.inspect():null;return f},onAdd(f){return this.on("add",f)},onUpdate(f){return this.on("update",f)},onDraw(f){return this.on("draw",f)},onDestroy(f){return this.on("destroy",f)},clearEvents(){c.clear()}},V=["onKeyPress","onKeyPressRepeat","onKeyDown","onKeyRelease","onMousePress","onMouseDown","onMouseRelease","onMouseMove","onCharInput","onMouseMove","onTouchStart","onTouchMove","onTouchEnd","onScroll","onGamepadButtonPress","onGamepadButtonDown","onGamepadButtonRelease","onGamepadStick"];for(let f of V)T[f]=(...M)=>{let K=m[f](...M);return h.push(K),T.onDestroy(()=>K.cancel()),K};for(let f of s)T.use(f);return T}l(Xs,"make");function xt(s,r,o){return S.objEvents[s]||(S.objEvents[s]=new Ko),S.objEvents.on(s,(c,...h)=>{c.is(r)&&o(c,...h)})}l(xt,"on");let hn=it(s=>{let r=Rs([{update:s}]);return{get paused(){return r.paused},set paused(o){r.paused=o},cancel:()=>r.destroy()}},(s,r)=>xt("update",s,r)),dn=it(s=>{let r=Rs([{draw:s}]);return{get paused(){return r.hidden},set paused(o){r.hidden=o},cancel:()=>r.destroy()}},(s,r)=>xt("draw",s,r)),yi=it(s=>S.events.on("add",s),(s,r)=>xt("add",s,r)),ar=it(s=>S.events.on("destroy",s),(s,r)=>xt("destroy",s,r));function lr(s,r,o){return xt("collide",s,(c,h,p)=>h.is(r)&&o(c,h,p))}l(lr,"onCollide");function cr(s,r,o){return xt("collideUpdate",s,(c,h,p)=>h.is(r)&&o(c,h,p))}l(cr,"onCollideUpdate");function hr(s,r,o){return xt("collideEnd",s,(c,h,p)=>h.is(r)&&o(c,h,p))}l(hr,"onCollideEnd");function Ms(s,r){Ei(s,{recursive:!0}).forEach(r),yi(s,r)}l(Ms,"forAllCurrentAndFuture");let un=it(s=>m.onMousePress(s),(s,r)=>{let o=[];return Ms(s,c=>{if(!c.area)throw new Error("onClick() requires the object to have area() component");o.push(c.onClick(()=>r(c)))}),os.join(o)});function dr(s,r){let o=[];return Ms(s,c=>{if(!c.area)throw new Error("onHover() requires the object to have area() component");o.push(c.onHover(()=>r(c)))}),os.join(o)}l(dr,"onHover");function ur(s,r){let o=[];return Ms(s,c=>{if(!c.area)throw new Error("onHoverUpdate() requires the object to have area() component");o.push(c.onHoverUpdate(()=>r(c)))}),os.join(o)}l(ur,"onHoverUpdate");function pr(s,r){let o=[];return Ms(s,c=>{if(!c.area)throw new Error("onHoverEnd() requires the object to have area() component");o.push(c.onHoverEnd(()=>r(c)))}),os.join(o)}l(pr,"onHoverEnd");function fr(s){S.gravity=s}l(fr,"setGravity");function gr(){return S.gravity}l(gr,"getGravity");function mr(...s){s.length===1||s.length===2?(E.bgColor=Me(s[0]),s[1]&&(E.bgAlpha=s[1])):(s.length===3||s.length===4)&&(E.bgColor=Me(s[0],s[1],s[2]),s[3]&&(E.bgAlpha=s[3])),v.clearColor(E.bgColor.r/255,E.bgColor.g/255,E.bgColor.b/255,E.bgAlpha)}l(mr,"setBackground");function wr(){return E.bgColor.clone()}l(wr,"getBackground");function Ps(...s){return{id:"pos",pos:U(...s),moveBy(...r){this.pos=this.pos.add(U(...r))},move(...r){this.moveBy(U(...r).scale(ht()))},moveTo(...r){if(typeof r[0]=="number"&&typeof r[1]=="number")return this.moveTo(U(r[0],r[1]),r[2]);let o=r[0],c=r[1];if(c===void 0){this.pos=U(o);return}let h=o.sub(this.pos);if(h.len()<=c*ht()){this.pos=U(o);return}this.move(h.unit().scale(c))},worldPos(){return this.parent?this.parent.transform.multVec2(this.pos):this.pos},screenPos(){let r=this.worldPos();return ss(this)?r:mi(r)},inspect(){return`(${Math.round(this.pos.x)}, ${Math.round(this.pos.y)})`},drawInspect(){le({color:Me(255,0,0),radius:4/ct()})}}}l(Ps,"pos");function Ts(...s){return s.length===0?Ts(1):{id:"scale",scale:U(...s),scaleTo(...r){this.scale=U(...r)},scaleBy(...r){this.scale.scale(U(...r))},inspect(){return`(${ts(this.scale.x,2)}, ${ts(this.scale.y,2)})`}}}l(Ts,"scale");function yr(s){return{id:"rotate",angle:s??0,rotateBy(r){this.angle+=r},rotateTo(r){this.angle=r},inspect(){return`${Math.round(this.angle)}`}}}l(yr,"rotate");function Ar(...s){return{id:"color",color:Me(...s),inspect(){return this.color.toString()}}}l(Ar,"color");function ts(s,r){return Number(s.toFixed(r))}l(ts,"toFixed");function xr(s){return{id:"opacity",opacity:s??1,inspect(){return`${ts(this.opacity,1)}`},fadeOut(r=1,o=ti.linear){return Vi(this.opacity,0,r,c=>this.opacity=c,o)}}}l(xr,"opacity");function Ws(s){if(!s)throw new Error("Please define an anchor");return{id:"anchor",anchor:s,inspect(){return typeof this.anchor=="string"?this.anchor:this.anchor.toString()}}}l(Ws,"anchor");function vr(s){return{id:"z",z:s,inspect(){return`${this.z}`}}}l(vr,"z");function br(s,r){return{id:"follow",require:["pos"],follow:{obj:s,offset:r??U(0)},add(){s.exists()&&(this.pos=this.follow.obj.pos.add(this.follow.offset))},update(){s.exists()&&(this.pos=this.follow.obj.pos.add(this.follow.offset))}}}l(br,"follow");function Er(s,r){let o=typeof s=="number"?C.fromAngle(s):s.unit();return{id:"move",require:["pos"],update(){this.move(o.scale(r))}}}l(Er,"move");let pn=200;function Vr(s={}){let r=s.distance??pn,o=!1;return{id:"offscreen",require:["pos"],isOffScreen(){let c=this.screenPos(),h=new _e(U(0),We(),Ze());return!Us(h,c)&&h.sdistToPoint(c)>r*r},onExitScreen(c){return this.on("exitView",c)},onEnterScreen(c){return this.on("enterView",c)},update(){this.isOffScreen()?(o||(this.trigger("exitView"),o=!0),s.hide&&(this.hidden=!0),s.pause&&(this.paused=!0),s.destroy&&this.destroy()):(o&&(this.trigger("enterView"),o=!1),s.hide&&(this.hidden=!1),s.pause&&(this.paused=!1))}}}l(Vr,"offscreen");function ss(s){return s.fixed?!0:s.parent?ss(s.parent):!1}l(ss,"isFixed");function Sr(s={}){let r={},o=new Set;return{id:"area",collisionIgnore:s.collisionIgnore??[],add(){this.area.cursor&&this.onHover(()=>m.setCursor(this.area.cursor)),this.onCollideUpdate((c,h)=>{r[c.id]||this.trigger("collide",c,h),r[c.id]=h,o.add(c.id)})},update(){for(let c in r)o.has(Number(c))||(this.trigger("collideEnd",r[c].target),delete r[c]);o.clear()},drawInspect(){let c=this.localArea();Oe(),gt(this.area.scale),Pe(this.area.offset);let h={outline:{width:4/ct(),color:Me(0,0,255)},anchor:this.anchor,fill:!1,fixed:ss(this)};c instanceof _e?Xe({...h,pos:c.pos,width:c.width,height:c.height}):c instanceof Is?Ke({...h,pts:c.pts}):c instanceof uo&&le({...h,pos:c.center,radius:c.radius}),Le()},area:{shape:s.shape??null,scale:s.scale?U(s.scale):U(1),offset:s.offset??U(0),cursor:s.cursor??null},isClicked(){return m.isMousePressed()&&this.isHovering()},isHovering(){let c=ss(this)?Vs():wi(Vs());return this.hasPoint(c)},checkCollision(c){return r[c.id]??null},getCollisions(){return Object.values(r)},isColliding(c){return!!r[c.id]},isOverlapping(c){let h=r[c.id];return h&&h.hasOverlap()},onClick(c){let h=m.onMousePress("left",()=>{this.isHovering()&&c()});return this.onDestroy(()=>h.cancel()),h},onHover(c){let h=!1;return this.onUpdate(()=>{h?h=this.isHovering():this.isHovering()&&(h=!0,c())})},onHoverUpdate(c){return this.onUpdate(()=>{this.isHovering()&&c()})},onHoverEnd(c){let h=!1;return this.onUpdate(()=>{h?this.isHovering()||(h=!1,c()):h=this.isHovering()})},onCollide(c,h){if(typeof c=="function"&&h===void 0)return this.on("collide",c);if(typeof c=="string")return this.onCollide((p,b)=>{p.is(c)&&h(p,b)})},onCollideUpdate(c,h){if(typeof c=="function"&&h===void 0)return this.on("collideUpdate",c);if(typeof c=="string")return this.on("collideUpdate",(p,b)=>p.is(c)&&h(p,b))},onCollideEnd(c,h){if(typeof c=="function"&&h===void 0)return this.on("collideEnd",c);if(typeof c=="string")return this.on("collideEnd",p=>p.is(c)&&h(p))},hasPoint(c){return ji(this.worldArea(),c)},resolveCollision(c){let h=this.checkCollision(c);h&&!h.resolved&&(this.pos=this.pos.add(h.displacement),h.resolved=!0)},localArea(){return this.area.shape?this.area.shape:this.renderArea()},worldArea(){let c=this.localArea();if(!(c instanceof Is||c instanceof _e))throw new Error("Only support polygon and rect shapes for now");let h=this.transform.clone().scale(U(this.area.scale??1)).translate(this.area.offset);if(c instanceof _e){let p=Jt(this.anchor||si).add(1,1).scale(-.5).scale(c.width,c.height);h.translate(p)}return c.transform(h)},screenArea(){let c=this.worldArea();return ss(this)?c:c.transform(S.cam.transform)}}}l(Sr,"area");function zt(s){return{color:s.color,opacity:s.opacity,anchor:s.anchor,outline:s.outline,shader:s.shader,uniform:s.uniform}}l(zt,"getRenderProps");function Js(s,r={}){let o=null,c=null,h=null,p=new dt;if(!s)throw new Error("Please pass the resource name or data to sprite()");let b=l((T,V,f,M)=>{let K=U(1,1);return f&&M?(K.x=f/(T.width*V.w),K.y=M/(T.height*V.h)):f?(K.x=f/(T.width*V.w),K.y=K.x):M&&(K.y=M/(T.height*V.h),K.x=K.y),K},"calcTexScale");return{id:"sprite",width:0,height:0,frame:r.frame||0,quad:r.quad||new Qe(0,0,1,1),animSpeed:r.animSpeed??1,flipX:r.flipX??!1,flipY:r.flipY??!1,draw(){if(!o)return;let T=o.frames[this.frame??0];if(!T)throw new Error(`Frame not found: ${this.frame??0}`);if(o.slice9){let{left:V,right:f,top:M,bottom:K}=o.slice9,J=o.tex.width*T.w,ne=o.tex.height*T.h,ae=this.width-V-f,q=this.height-M-K,ee=V/J,st=f/J,Ge=1-ee-st,He=M/ne,ze=K/ne,Re=1-He-ze,P=[Ue(0,0,ee,He),Ue(ee,0,Ge,He),Ue(ee+Ge,0,st,He),Ue(0,He,ee,Re),Ue(ee,He,Ge,Re),Ue(ee+Ge,He,st,Re),Ue(0,He+Re,ee,ze),Ue(ee,He+Re,Ge,ze),Ue(ee+Ge,He+Re,st,ze),Ue(0,0,V,M),Ue(V,0,ae,M),Ue(V+ae,0,f,M),Ue(0,M,V,q),Ue(V,M,ae,q),Ue(V+ae,M,f,q),Ue(0,M+q,V,K),Ue(V,M+q,ae,K),Ue(V+ae,M+q,f,K)];for(let Q=0;Q<9;Q++){let Y=P[Q],$=P[Q+9];Dt(Object.assign(zt(this),{pos:$.pos(),tex:o.tex,quad:T.scale(Y),flipX:this.flipX,flipY:this.flipY,tiled:r.tiled,width:$.w,height:$.h}))}}else Dt(Object.assign(zt(this),{tex:o.tex,quad:T.scale(this.quad??new Qe(0,0,1,1)),flipX:this.flipX,flipY:this.flipY,tiled:r.tiled,width:this.width,height:this.height}))},add(){let T=l(f=>{let M=f.frames[0].clone();r.quad&&(M=M.scale(r.quad));let K=b(f.tex,M,r.width,r.height);this.width=f.tex.width*M.w*K.x,this.height=f.tex.height*M.h*K.y,r.anim&&this.play(r.anim),o=f,p.trigger(o)},"setSpriteData"),V=Je(s);V?V.onLoad(T):Zs(()=>T(Je(s).data))},update(){if(!c)return;let T=o.anims[c.name];if(typeof T=="number"){this.frame=T;return}if(T.speed===0)throw new Error("Sprite anim speed cannot be 0");c.timer+=ht()*this.animSpeed,c.timer>=1/c.speed&&(c.timer=0,this.frame+=h,(this.frame<Math.min(T.from,T.to)||this.frame>Math.max(T.from,T.to))&&(c.loop?c.pingpong?(this.frame-=h,h*=-1,this.frame+=h):this.frame=T.from:(this.frame=T.to,c.onEnd(),this.stop())))},play(T,V={}){if(!o){p.add(()=>this.play(T,V));return}let f=o.anims[T];if(f===void 0)throw new Error(`Anim not found: ${T}`);c&&this.stop(),c=typeof f=="number"?{name:T,timer:0,loop:!1,pingpong:!1,speed:0,onEnd:()=>{}}:{name:T,timer:0,loop:V.loop??f.loop??!1,pingpong:V.pingpong??f.pingpong??!1,speed:V.speed??f.speed??10,onEnd:V.onEnd??(()=>{})},h=typeof f=="number"?null:f.from<f.to?1:-1,this.frame=typeof f=="number"?f:f.from,this.trigger("animStart",T)},stop(){if(!c)return;let T=c.name;c=null,this.trigger("animEnd",T)},numFrames(){return(o==null?void 0:o.frames.length)??0},curAnim(){return c==null?void 0:c.name},onAnimEnd(T){return this.on("animEnd",T)},onAnimStart(T){return this.on("animStart",T)},renderArea(){return new _e(U(0),this.width,this.height)},inspect(){if(typeof s=="string")return`"${s}"`}}}l(Js,"sprite");function Mr(s,r={}){function o(h){var b,T;let p=It(Object.assign(zt(h),{text:h.text+"",size:h.textSize,font:h.font,width:r.width&&h.width,align:h.align,letterSpacing:h.letterSpacing,lineSpacing:h.lineSpacing,transform:h.textTransform,styles:h.textStyles}));return r.width||(h.width=p.width/(((b=h.scale)==null?void 0:b.x)||1)),h.height=p.height/(((T=h.scale)==null?void 0:T.y)||1),p}l(o,"update");let c={id:"text",set text(h){s=h,o(this)},get text(){return s},textSize:r.size??Wn,font:r.font,width:r.width??0,height:0,align:r.align,lineSpacing:r.lineSpacing,letterSpacing:r.letterSpacing,textTransform:r.transform,textStyles:r.styles,add(){Zs(()=>o(this))},draw(){Ct(o(this))},renderArea(){return new _e(U(0),this.width,this.height)}};return o(c),c}l(Mr,"text");function Pr(s,r={}){if(s.length<3)throw new Error(`Polygon's need more than two points, ${s.length} points provided`);return{id:"polygon",pts:s,colors:r.colors,radius:r.radius,draw(){Ke(Object.assign(zt(this),{pts:this.pts,colors:this.colors,radius:this.radius,fill:r.fill}))},renderArea(){return new Is(this.pts)},inspect(){return this.pts.map(o=>`[${o.x},${o.y}]`).join(",")}}}l(Pr,"polygon");function Tr(s,r,o={}){return{id:"rect",width:s,height:r,radius:o.radius||0,draw(){Xe(Object.assign(zt(this),{width:this.width,height:this.height,radius:this.radius,fill:o.fill}))},renderArea(){return new _e(U(0),this.width,this.height)},inspect(){return`${Math.ceil(this.width)}, ${Math.ceil(this.height)}`}}}l(Tr,"rect");function Fr(s,r){return{id:"rect",width:s,height:r,draw(){mt(Object.assign(zt(this),{width:this.width,height:this.height}))},renderArea(){return new _e(U(0),this.width,this.height)},inspect(){return`${Math.ceil(this.width)}, ${Math.ceil(this.height)}`}}}l(Fr,"uvquad");function Rr(s,r={}){return{id:"circle",radius:s,draw(){le(Object.assign(zt(this),{radius:this.radius,fill:r.fill}))},renderArea(){return new _e(new C(this.anchor?0:-this.radius),this.radius*2,this.radius*2)},inspect(){return`${Math.ceil(this.radius)}`}}}l(Rr,"circle");function Dr(s=1,r=Me(0,0,0)){return{id:"outline",outline:{width:s,color:r}}}l(Dr,"outline");function js(){return{id:"timer",wait(s,r){let o=[];r&&o.push(r);let c=0,h=this.onUpdate(()=>{c+=ht(),c>=s&&(o.forEach(p=>p()),h.cancel())});return{get paused(){return h.paused},set paused(p){h.paused=p},cancel:h.cancel,onEnd(p){o.push(p)},then(p){return this.onEnd(p),this}}},loop(s,r){let o=null,c=l(()=>{o=this.wait(s,c),r()},"newAction");return o=this.wait(0,c),{get paused(){return o.paused},set paused(h){o.paused=h},cancel:()=>o.cancel()}},tween(s,r,o,c,h=ti.linear){let p=0,b=[],T=this.onUpdate(()=>{p+=ht();let V=Math.min(p/o,1);c(Et(s,r,h(V))),V===1&&(T.cancel(),c(r),b.forEach(f=>f()))});return{get paused(){return T.paused},set paused(V){T.paused=V},onEnd(V){b.push(V)},then(V){return this.onEnd(V),this},cancel(){T.cancel()},finish(){T.cancel(),c(r),b.forEach(V=>V())}}}}}l(js,"timer");let fn=640,gn=65536;function Ir(s={}){let r=null,o=null,c=!1;return{id:"body",require:["pos","area"],vel:new C(0),jumpForce:s.jumpForce??fn,gravityScale:s.gravityScale??1,isStatic:s.isStatic??!1,mass:s.mass??1,add(){if(this.mass===0)throw new Error("Can't set body mass to 0");this.onCollideUpdate((h,p)=>{if(h.is("body")&&!p.resolved&&(this.trigger("beforePhysicsResolve",p),h.trigger("beforePhysicsResolve",p.reverse()),!p.resolved&&!(this.isStatic&&h.isStatic))){if(!this.isStatic&&!h.isStatic){let b=this.mass+h.mass;this.pos=this.pos.add(p.displacement.scale(h.mass/b)),h.pos=h.pos.add(p.displacement.scale(-this.mass/b)),this.transform=Ss(this),h.transform=Ss(h)}else{let b=!this.isStatic&&h.isStatic?p:p.reverse();b.source.pos=b.source.pos.add(b.displacement),b.source.transform=Ss(b.source)}p.resolved=!0,this.trigger("physicsResolve",p),h.trigger("physicsResolve",p.reverse())}}),this.onPhysicsResolve(h=>{S.gravity&&(h.isBottom()&&this.isFalling()?(this.vel.y=0,r=h.target,o=h.target.pos,c?c=!1:this.trigger("ground",r)):h.isTop()&&this.isJumping()&&(this.vel.y=0,this.trigger("headbutt",h.target)))})},update(){if(!S.gravity||this.isStatic)return;if(c&&(r=null,o=null,this.trigger("fallOff"),c=!1),r)if(!this.isColliding(r)||!r.exists()||!r.is("body"))c=!0;else{!r.pos.eq(o)&&s.stickToPlatform!==!1&&this.moveBy(r.pos.sub(o)),o=r.pos;return}let h=this.vel.y;this.vel.y+=S.gravity*this.gravityScale*ht(),this.vel.y=Math.min(this.vel.y,s.maxVelocity??gn),h<0&&this.vel.y>=0&&this.trigger("fall"),this.move(this.vel)},onPhysicsResolve(h){return this.on("physicsResolve",h)},onBeforePhysicsResolve(h){return this.on("beforePhysicsResolve",h)},curPlatform(){return r},isGrounded(){return r!==null},isFalling(){return this.vel.y>0},isJumping(){return this.vel.y<0},jump(h){r=null,o=null,this.vel.y=-h||-this.jumpForce},onGround(h){return this.on("ground",h)},onFall(h){return this.on("fall",h)},onFallOff(h){return this.on("fallOff",h)},onHeadbutt(h){return this.on("headbutt",h)}}}l(Ir,"body");function Cr(s=2){let r=s;return{id:"doubleJump",require:["body"],numJumps:s,add(){this.onGround(()=>{r=this.numJumps})},doubleJump(o){r<=0||(r<this.numJumps&&this.trigger("doubleJump"),r--,this.jump(o))},onDoubleJump(o){return this.on("doubleJump",o)},inspect(){return`${r}`}}}l(Cr,"doubleJump");function zr(s,r){return{id:"shader",shader:s,...typeof r=="function"?{uniform:r(),update(){this.uniform=r()}}:{uniform:r}}}l(zr,"shader");function Br(){return{id:"fixed",fixed:!0}}l(Br,"fixed");function Ai(s){return{id:"stay",stay:!0,scenesToStay:s}}l(Ai,"stay");function Lr(s,r){if(s==null)throw new Error("health() requires the initial amount of hp");return{id:"health",hurt(o=1){this.setHP(s-o),this.trigger("hurt",o)},heal(o=1){let c=s;this.setHP(s+o),this.trigger("heal",s-c)},hp(){return s},maxHP(){return r??null},setMaxHP(o){r=o},setHP(o){s=r?Math.min(r,o):o,s<=0&&this.trigger("death")},onHurt(o){return this.on("hurt",o)},onHeal(o){return this.on("heal",o)},onDeath(o){return this.on("death",o)},inspect(){return`${s}`}}}l(Lr,"health");function Nr(s,r={}){if(s==null)throw new Error("lifespan() requires time");let o=r.fade??0;return{id:"lifespan",async add(){await _r(s),o>0&&this.opacity&&await Vi(this.opacity,0,o,c=>this.opacity=c,ti.linear),this.destroy()}}}l(Nr,"lifespan");function Ur(s,r,o){if(!s)throw new Error("state() requires an initial state");let c={};function h(V){c[V]||(c[V]={enter:new dt,end:new dt,update:new dt,draw:new dt})}l(h,"initStateEvents");function p(V,f,M){return h(f),c[f][V].add(M)}l(p,"on");function b(V,f,...M){h(f),c[f][V].trigger(...M)}l(b,"trigger");let T=!1;return{id:"state",state:s,enterState(V,...f){if(T=!0,r&&!r.includes(V))throw new Error(`State not found: ${V}`);let M=this.state;if(o){if(!(o!=null&&o[M]))return;let K=typeof o[M]=="string"?[o[M]]:o[M];if(!K.includes(V))throw new Error(`Cannot transition state from "${M}" to "${V}". Available transitions: ${K.map(J=>`"${J}"`).join(", ")}`)}b("end",M,...f),this.state=V,b("enter",V,...f),b("enter",`${M} -> ${V}`,...f)},onStateTransition(V,f,M){return p("enter",`${V} -> ${f}`,M)},onStateEnter(V,f){return p("enter",V,f)},onStateUpdate(V,f){return p("update",V,f)},onStateDraw(V,f){return p("draw",V,f)},onStateEnd(V,f){return p("end",V,f)},update(){T||(b("enter",s),T=!0),b("update",this.state)},draw(){b("draw",this.state)},inspect(){return this.state}}}l(Ur,"state");function Or(s=1){let r=0,o=!1;return{require:["opacity"],add(){this.opacity=0},update(){o||(r+=ht(),this.opacity=Nt(r,0,s,0,1),r>=s&&(this.opacity=1,o=!0))}}}l(Or,"fadeIn");function Gr(s="intersect"){return{id:"mask",mask:s}}l(Gr,"mask");function Kr(s){return{add(){this.canvas=s}}}l(Kr,"drawon");function Zs(s){B.loaded?s():S.events.on("load",s)}l(Zs,"onLoad");function Hr(s,r){S.scenes[s]=r}l(Hr,"scene");function Yr(s,...r){if(!S.scenes[s])throw new Error(`Scene not found: ${s}`);S.events.onOnce("frameEnd",()=>{S.events.trigger("sceneLeave",s),m.events.clear(),S.events.clear(),S.objEvents.clear(),[...S.root.children].forEach(o=>{(!o.stay||o.scenesToStay&&!o.scenesToStay.includes(s))&&S.root.remove(o)}),S.root.clearEvents(),Ri(),S.cam={pos:null,scale:U(1),angle:0,shake:0,transform:new wt},S.scenes[s](...r)})}l(Yr,"go");function qr(s){return S.events.on("sceneLeave",s)}l(qr,"onSceneLeave");function Qr(s,r){try{return JSON.parse(window.localStorage[s])}catch{return r?(xi(s,r),r):null}}l(Qr,"getData");function xi(s,r){window.localStorage[s]=JSON.stringify(r)}l(xi,"setData");function vi(s,...r){let o=s(qt),c;typeof o=="function"?c=o(...r)(qt):c=o;for(let h in c)qt[h]=c[h],e.global!==!1&&(window[h]=c[h]);return qt}l(vi,"plug");function Fs(){return U(We()/2,Ze()/2)}l(Fs,"center"),(s=>(s[s.None=0]="None",s[s.Left=1]="Left",s[s.Top=2]="Top",s[s.LeftTop=3]="LeftTop",s[s.Right=4]="Right",s[s.Horizontal=5]="Horizontal",s[s.RightTop=6]="RightTop",s[s.HorizontalTop=7]="HorizontalTop",s[s.Bottom=8]="Bottom",s[s.LeftBottom=9]="LeftBottom",s[s.Vertical=10]="Vertical",s[s.LeftVertical=11]="LeftVertical",s[s.RightBottom=12]="RightBottom",s[s.HorizontalBottom=13]="HorizontalBottom",s[s.RightVertical=14]="RightVertical",s[s.All=15]="All"))(void 0||(ja={}));function bi(s={}){let r=U(0),o=s.isObstacle??!1,c=s.cost??0,h=s.edges??[],p=l(()=>{let T={left:1,top:2,right:4,bottom:8};return h.map(V=>T[V]||0).reduce((V,f)=>V|f,0)},"getEdgeMask"),b=p();return{id:"tile",tilePosOffset:s.offset??U(0),set tilePos(T){let V=this.getLevel();r=T.clone(),this.pos=U(this.tilePos.x*V.tileWidth(),this.tilePos.y*V.tileHeight()).add(this.tilePosOffset)},get tilePos(){return r},set isObstacle(T){o!==T&&(o=T,this.getLevel().invalidateNavigationMap())},get isObstacle(){return o},set cost(T){c!==T&&(c=T,this.getLevel().invalidateNavigationMap())},get cost(){return c},set edges(T){h=T,b=p(),this.getLevel().invalidateNavigationMap()},get edges(){return h},get edgeMask(){return b},getLevel(){return this.parent},moveLeft(){this.tilePos=this.tilePos.add(U(-1,0))},moveRight(){this.tilePos=this.tilePos.add(U(1,0))},moveUp(){this.tilePos=this.tilePos.add(U(0,-1))},moveDown(){this.tilePos=this.tilePos.add(U(0,1))}}}l(bi,"tile");function Xr(s,r){if(!r.tileWidth||!r.tileHeight)throw new Error("Must provide tileWidth and tileHeight.");let o=Rs([Ps(r.pos??U(0))]),c=s.length,h=0,p=null,b=null,T=null,V=null,f=l(P=>P.x+P.y*h,"tile2Hash"),M=l(P=>U(Math.floor(P%h),Math.floor(P/h)),"hash2Tile"),K=l(()=>{p=[];for(let P of o.children)J(P)},"createSpatialMap"),J=l(P=>{let Q=f(P.tilePos);p[Q]?p[Q].push(P):p[Q]=[P]},"insertIntoSpatialMap"),ne=l(P=>{let Q=f(P.tilePos);if(p[Q]){let Y=p[Q].indexOf(P);Y>=0&&p[Q].splice(Y,1)}},"removeFromSpatialMap"),ae=l(()=>{let P=!1;for(let Q of o.children){let Y=o.pos2Tile(Q.pos);(Q.tilePos.x!=Y.x||Q.tilePos.y!=Y.y)&&(P=!0,ne(Q),Q.tilePos.x=Y.x,Q.tilePos.y=Y.y,J(Q))}P&&o.trigger("spatial_map_changed")},"updateSpatialMap"),q=l(()=>{let P=o.getSpatialMap(),Q=o.numRows()*o.numColumns();b?b.length=Q:b=new Array(Q),b.fill(1,0,Q);for(let Y=0;Y<P.length;Y++){let $=P[Y];if($){let me=0;for(let fe of $)if(fe.isObstacle){me=1/0;break}else me+=fe.cost;b[Y]=me||1}}},"createCostMap"),ee=l(()=>{let P=o.getSpatialMap(),Q=o.numRows()*o.numColumns();T?T.length=Q:T=new Array(Q),T.fill(15,0,Q);for(let Y=0;Y<P.length;Y++){let $=P[Y];if($){let me=$.length,fe=15;for(let Te=0;Te<me;Te++)fe|=$[Te].edgeMask;T[Y]=fe}}},"createEdgeMap"),st=l(()=>{let P=o.numRows()*o.numColumns(),Q=l(($,me)=>{let fe=[];for(fe.push($);fe.length>0;){let Te=fe.pop();ze(Te).forEach(qe=>{V[qe]<0&&(V[qe]=me,fe.push(qe))})}},"traverse");V?V.length=P:V=new Array(P),V.fill(-1,0,P);let Y=0;for(let $=0;$<b.length;$++){if(V[$]>=0){Y++;continue}Q($,Y),Y++}},"createConnectivityMap"),Ge=l((P,Q)=>b[Q],"getCost"),He=l((P,Q)=>{let Y=M(P),$=M(Q);return Y.dist($)},"getHeuristic"),ze=l((P,Q)=>{let Y=[],$=Math.floor(P%h),me=$>0&&T[P]&1&&b[P-1]!==1/0,fe=P>=h&&T[P]&2&&b[P-h]!==1/0,Te=$<h-1&&T[P]&4&&b[P+1]!==1/0,qe=P<h*c-h-1&&T[P]&8&&b[P+h]!==1/0;return Q?(me&&(fe&&Y.push(P-h-1),Y.push(P-1),qe&&Y.push(P+h-1)),fe&&Y.push(P-h),Te&&(fe&&Y.push(P-h+1),Y.push(P+1),qe&&Y.push(P+h+1)),qe&&Y.push(P+h)):(me&&Y.push(P-1),fe&&Y.push(P-h),Te&&Y.push(P+1),qe&&Y.push(P+h)),Y},"getNeighbours"),Re={id:"level",tileWidth(){return r.tileWidth},tileHeight(){return r.tileHeight},spawn(P,...Q){let Y=U(...Q),$=(()=>{if(typeof P=="string"){if(r.tiles[P]){if(typeof r.tiles[P]!="function")throw new Error("Level symbol def must be a function returning a component list");return r.tiles[P](Y)}else if(r.wildcardTile)return r.wildcardTile(P,Y)}else{if(Array.isArray(P))return P;throw new Error("Expected a symbol or a component list")}})();if(!$)return null;let me=!1,fe=!1;for(let qe of $)qe.id==="tile"&&(fe=!0),qe.id==="pos"&&(me=!0);me||$.push(Ps()),fe||$.push(bi());let Te=o.add($);return me&&(Te.tilePosOffset=Te.pos.clone()),Te.tilePos=Y,p&&(J(Te),this.trigger("spatial_map_changed"),this.trigger("navigation_map_invalid")),Te},numColumns(){return h},numRows(){return c},levelWidth(){return h*this.tileWidth()},levelHeight(){return c*this.tileHeight()},tile2Pos(...P){return U(...P).scale(this.tileWidth(),this.tileHeight())},pos2Tile(...P){let Q=U(...P);return U(Math.floor(Q.x/this.tileWidth()),Math.floor(Q.y/this.tileHeight()))},getSpatialMap(){return p||K(),p},onSpatialMapChanged(P){return this.on("spatial_map_changed",P)},onNavigationMapInvalid(P){return this.on("navigation_map_invalid",P)},getAt(P){p||K();let Q=f(P);return p[Q]||[]},update(){p&&ae()},invalidateNavigationMap(){b=null,T=null,V=null},onNavigationMapChanged(P){return this.on("navigation_map_changed",P)},getTilePath(P,Q,Y={}){var co;if(b||q(),T||ee(),V||st(),P.x<0||P.x>=h||P.y<0||P.y>=c||Q.x<0||Q.x>=h||Q.y<0||Q.y>=c)return null;let $=f(P),me=f(Q);if(b[me]===1/0)return null;if($===me)return[];if(V[$]!=-1&&V[$]!==V[me])return null;let fe=new Cn((vt,Ci)=>vt.cost<Ci.cost);fe.insert({cost:0,node:$});let Te=new Map;Te.set($,$);let qe=new Map;for(qe.set($,0);fe.length!==0;){let vt=(co=fe.remove())==null?void 0:co.node;if(vt===me)break;let Ci=ze(vt,Y.allowDiagonals);for(let Xt of Ci){let zi=(qe.get(vt)||0)+Ge(vt,Xt)+He(Xt,me);(!qe.has(Xt)||zi<qe.get(Xt))&&(qe.set(Xt,zi),fe.insert({cost:zi,node:Xt}),Te.set(Xt,vt))}}let Ii=[],Ds=me,vn=M(Ds);for(Ii.push(vn);Ds!==$;){Ds=Te.get(Ds);let vt=M(Ds);Ii.push(vt)}return Ii.reverse()},getPath(P,Q,Y={}){let $=this.tileWidth(),me=this.tileHeight(),fe=this.getTilePath(this.pos2Tile(P),this.pos2Tile(Q),Y);return fe?[P,...fe.slice(1,-1).map(Te=>Te.scale($,me).add($/2,me/2)),Q]:null}};return o.use(Re),o.onNavigationMapInvalid(()=>{o.invalidateNavigationMap(),o.trigger("navigation_map_changed")}),s.forEach((P,Q)=>{let Y=P.split("");h=Math.max(Y.length,h),Y.forEach(($,me)=>{o.spawn($,U(me,Q))})}),o}l(Xr,"addLevel");function Wr(s={}){let r=null,o=null,c=null,h=null;return{id:"agent",require:["pos","tile"],agentSpeed:s.speed??100,allowDiagonals:s.allowDiagonals??!0,getDistanceToTarget(){return r?this.pos.dist(r):0},getNextLocation(){return o&&c?o[c]:null},getPath(){return o?o.slice():null},getTarget(){return r},isNavigationFinished(){return o?c===null:!0},isTargetReachable(){return o!==null},isTargetReached(){return r?this.pos.eq(r):!0},setTarget(p){r=p,o=this.getLevel().getPath(this.pos,r,{allowDiagonals:this.allowDiagonals}),c=o?0:null,o?(h||(h=this.getLevel().onNavigationMapChanged(()=>{o&&c!==null&&(o=this.getLevel().getPath(this.pos,r,{allowDiagonals:this.allowDiagonals}),c=o?0:null,o?this.trigger("navigation-next",this,o[c]):this.trigger("navigation-ended",this))}),this.onDestroy(()=>h.cancel())),this.trigger("navigation-started",this),this.trigger("navigation-next",this,o[c])):this.trigger("navigation-ended",this)},update(){if(o&&c!==null){if(this.pos.sdist(o[c])<2)if(c===o.length-1){this.pos=r.clone(),c=null,this.trigger("navigation-ended",this),this.trigger("target-reached",this);return}else c++,this.trigger("navigation-next",this,o[c]);this.moveTo(o[c],this.agentSpeed)}},onNavigationStarted(p){return this.on("navigation-started",p)},onNavigationNext(p){return this.on("navigation-next",p)},onNavigationEnded(p){return this.on("navigation-ended",p)},onTargetReached(p){return this.on("target-reached",p)},inspect(){return JSON.stringify({target:JSON.stringify(r),path:JSON.stringify(o)})}}}l(Wr,"agent");function Jr(s){let r=m.canvas.captureStream(s),o=H.ctx.createMediaStreamDestination();H.masterNode.connect(o);let c=new MediaRecorder(r),h=[];return c.ondataavailable=p=>{p.data.size>0&&h.push(p.data)},c.onerror=()=>{H.masterNode.disconnect(o),r.getTracks().forEach(p=>p.stop())},c.start(),{resume(){c.resume()},pause(){c.pause()},stop(){return c.stop(),H.masterNode.disconnect(o),r.getTracks().forEach(p=>p.stop()),new Promise(p=>{c.onstop=()=>{p(new Blob(h,{type:"video/mp4"}))}})},download(p="kaboom.mp4"){this.stop().then(b=>Hi(p,b))}}}l(Jr,"record");function jr(){return document.activeElement===m.canvas}l(jr,"isFocused");function Zr(s){s.destroy()}l(Zr,"destroy");let Rs=S.root.add.bind(S.root),mn=S.root.readd.bind(S.root),wn=S.root.removeAll.bind(S.root),Ei=S.root.get.bind(S.root),_r=S.root.wait.bind(S.root),yn=S.root.loop.bind(S.root),Vi=S.root.tween.bind(S.root);function Si(s=2,r=1){let o=0;return{require:["scale"],update(){let c=Math.sin(o*s)*r;c<0&&this.destroy(),this.scale=U(c),o+=ht()}}}l(Si,"boom");let An=se(null,Yn),xn=se(null,qn);function $r(s,r={}){let o=Rs([Ps(s),Ai()]),c=(r.speed||1)*5,h=r.scale||1;o.add([Js(xn),Ts(0),Ws("center"),Si(c,h),...r.comps??[]]);let p=o.add([Js(An),Ts(0),Ws("center"),js(),...r.comps??[]]);return p.wait(.4/c,()=>p.use(Si(c,h))),p.onDestroy(()=>o.destroy()),o}l($r,"addKaboom");function Mi(){S.root.update()}l(Mi,"updateFrame");const $s=class $s{constructor(r,o,c,h=!1){R(this,"source");R(this,"target");R(this,"displacement");R(this,"resolved",!1);this.source=r,this.target=o,this.displacement=c,this.resolved=h}reverse(){return new $s(this.target,this.source,this.displacement.scale(-1),this.resolved)}hasOverlap(){return!this.displacement.isZero()}isLeft(){return this.displacement.x>0}isRight(){return this.displacement.x<0}isTop(){return this.displacement.y>0}isBottom(){return this.displacement.y<0}preventResolution(){this.resolved=!0}};l($s,"Collision");let Pi=$s;function kr(){let s={},r=e.hashGridSize||Jn,o=new wt,c=[];function h(p){if(c.push(o.clone()),p.pos&&o.translate(p.pos),p.scale&&o.scale(p.scale),p.angle&&o.rotate(p.angle),p.transform=o.clone(),p.c("area")&&!p.paused){let b=p,T=b.worldArea().bbox(),V=Math.floor(T.pos.x/r),f=Math.floor(T.pos.y/r),M=Math.ceil((T.pos.x+T.width)/r),K=Math.ceil((T.pos.y+T.height)/r),J=new Set;for(let ne=V;ne<=M;ne++)for(let ae=f;ae<=K;ae++)if(!s[ne])s[ne]={},s[ne][ae]=[b];else if(!s[ne][ae])s[ne][ae]=[b];else{let q=s[ne][ae];e:for(let ee of q){if(ee.paused||!ee.exists()||J.has(ee.id))continue;for(let Ge of b.collisionIgnore)if(ee.is(Ge))continue e;for(let Ge of ee.collisionIgnore)if(b.is(Ge))continue e;let st=Go(b.worldArea(),ee.worldArea());if(st){let Ge=new Pi(b,ee,st);b.trigger("collideUpdate",ee,Ge);let He=Ge.reverse();He.resolved=Ge.resolved,ee.trigger("collideUpdate",b,He)}J.add(ee.id)}q.push(b)}}p.children.forEach(h),o=c.pop()}l(h,"checkObj"),h(S.root)}l(kr,"checkFrame");function eo(){let s=S.cam,r=C.fromAngle(Ns(0,360)).scale(s.shake);s.shake=Et(s.shake,0,5*ht()),s.transform=new wt().translate(Fs()).scale(s.scale).rotate(s.angle).translate((s.pos??Fs()).scale(-1).add(r)),S.root.draw(),_()}l(eo,"drawFrame");function to(){let s=W();S.events.numListeners("loading")>0?S.events.trigger("loading",s):tt(()=>{let r=We()/2,o=24,c=U(We()/2,Ze()/2).sub(U(r/2,o/2));Xe({pos:U(0),width:We(),height:Ze(),color:Me(0,0,0)}),Xe({pos:c,width:r,height:o,fill:!1,outline:{width:4}}),Xe({pos:c,width:r*s,height:o})})}l(to,"drawLoadScreen");function Ti(s,r){tt(()=>{let o=U(8);Oe(),Pe(s);let c=It({text:r,font:ii,size:16,pos:o,color:Me(255,255,255),fixed:!0}),h=c.width+o.x*2,p=c.height+o.x*2;s.x+h>=We()&&Pe(U(-h,0)),s.y+p>=Ze()&&Pe(U(0,-p)),Xe({width:h,height:p,color:Me(0,0,0),radius:4,opacity:.8,fixed:!0}),Ct(c),Le()})}l(Ti,"drawInspectText");function so(){if(Ie.inspect){let s=null;for(let r of S.root.get("*",{recursive:!0}))if(r.c("area")&&r.isHovering()){s=r;break}if(S.root.drawInspect(),s){let r=[],o=s.inspect();for(let c in o)o[c]?r.push(`${c}: ${o[c]}`):r.push(`${c}`);Ti(tr(Vs()),r.join(`
`))}Ti(U(8),`FPS: ${Ie.fps()}`)}Ie.paused&&tt(()=>{Oe(),Pe(We(),0),Pe(-8,8);let s=32;Xe({width:s,height:s,anchor:"topright",color:Me(0,0,0),opacity:.8,radius:4,fixed:!0});for(let r=1;r<=2;r++)Xe({width:4,height:s*.6,anchor:"center",pos:U(-s/3*r,s*.5),color:Me(255,255,255),radius:2,fixed:!0});Le()}),Ie.timeScale!==1&&tt(()=>{Oe(),Pe(We(),Ze()),Pe(-8,-8);let s=8,r=It({text:Ie.timeScale.toFixed(1),font:ii,size:16,color:Me(255,255,255),pos:U(-s),anchor:"botright",fixed:!0});Xe({width:r.width+s*2+s*4,height:r.height+s*2,anchor:"botright",color:Me(0,0,0),opacity:.8,radius:4,fixed:!0});for(let o=0;o<2;o++){let c=Ie.timeScale<1;N({p1:U(-r.width-s*(c?2:3.5),-s),p2:U(-r.width-s*(c?2:3.5),-s-r.height),p3:U(-r.width-s*(c?3.5:2),-s-r.height/2),pos:U(-o*s*1+(c?-s*.5:0),0),color:Me(255,255,255),fixed:!0})}Ct(r),Le()}),Ie.curRecording&&tt(()=>{Oe(),Pe(0,Ze()),Pe(24,-24),le({radius:12,color:Me(255,0,0),opacity:Gi(0,1,m.time()*4),fixed:!0}),Le()}),Ie.showLog&&S.logs.length>0&&tt(()=>{var c;Oe(),Pe(0,Ze()),Pe(8,-8);let s=8,r=[];for(let h of S.logs){let p="",b=h.msg instanceof Error?"error":"info";p+=`[time]${h.time.toFixed(2)}[/time]`,p+=" ",p+=`[${b}]${(c=h.msg)!=null&&c.toString?h.msg.toString():h.msg}[/${b}]`,r.push(p)}S.logs=S.logs.filter(h=>m.time()-h.time<(e.logTime||Zn));let o=It({text:r.join(`
`),font:ii,pos:U(s,-s),anchor:"botleft",size:16,width:We()*.6,lineSpacing:s/2,fixed:!0,styles:{time:{color:Me(127,127,127)},info:{color:Me(255,255,255)},error:{color:Me(255,0,127)}}});Xe({width:o.width+s*2,height:o.height+s*2,anchor:"botleft",color:Me(0,0,0),radius:4,opacity:.8,fixed:!0}),Ct(o),Le()})}l(so,"drawDebug");function io(s){S.events.on("loading",s)}l(io,"onLoading");function ro(s){m.onResize(s)}l(ro,"onResize");function oo(s){S.events.on("error",s)}l(oo,"onError");function no(s){console.error(s),H.ctx.suspend(),m.run(()=>{ge(),tt(()=>{let r=We(),o=Ze(),c={size:36,width:r-32*2,letterSpacing:4,lineSpacing:4,font:ii,fixed:!0};Xe({width:r,height:o,color:Me(0,0,255),fixed:!0});let h=It({...c,text:"Error",pos:U(32),color:Me(255,128,0),fixed:!0});Ct(h),gi({...c,text:s.message,pos:U(32,32+h.height+16),fixed:!0}),Le(),S.events.trigger("error",s)}),Ve()})}l(no,"handleErr");function ao(s){G.push(s)}l(ao,"onCleanup");function lo(){S.events.onOnce("frameEnd",()=>{m.quit(),v.clear(v.COLOR_BUFFER_BIT|v.DEPTH_BUFFER_BIT|v.STENCIL_BUFFER_BIT);let s=v.getParameter(v.MAX_TEXTURE_IMAGE_UNITS);for(let r=0;r<s;r++)v.activeTexture(v.TEXTURE0+r),v.bindTexture(v.TEXTURE_2D,null),v.bindTexture(v.TEXTURE_CUBE_MAP,null);v.bindBuffer(v.ARRAY_BUFFER,null),v.bindBuffer(v.ELEMENT_ARRAY_BUFFER,null),v.bindRenderbuffer(v.RENDERBUFFER,null),v.bindFramebuffer(v.FRAMEBUFFER,null),L.destroy(),G.forEach(r=>r())})}l(lo,"quit");let _s=!0;m.run(()=>{try{B.loaded||W()===1&&!_s&&(B.loaded=!0,S.events.trigger("load")),!B.loaded&&e.loadingScreen!==!1||_s?(ge(),to(),Ve()):(Ie.paused||Mi(),kr(),ge(),eo(),e.debug!==!1&&so(),Ve()),_s&&(_s=!1),S.events.trigger("frameEnd")}catch(s){no(s)}});function Fi(){let s=u,r=v.drawingBufferWidth/s,o=v.drawingBufferHeight/s;if(e.letterbox){if(!e.width||!e.height)throw new Error("Letterboxing requires width and height defined.");let c=r/o,h=e.width/e.height;if(c>h){let p=o*h,b=(r-p)/2;E.viewport={x:b,y:0,width:p,height:o}}else{let p=r/h,b=(o-p)/2;E.viewport={x:0,y:b,width:r,height:p}}return}if(e.stretch&&(!e.width||!e.height))throw new Error("Stretching requires width and height defined.");E.viewport={x:0,y:0,width:r,height:o}}l(Fi,"updateViewport");function Ri(){m.onHide(()=>{e.backgroundAudio||H.ctx.suspend()}),m.onShow(()=>{!e.backgroundAudio&&!Ie.paused&&H.ctx.resume()}),m.onResize(()=>{if(m.isFullscreen())return;let s=e.width&&e.height;s&&!e.stretch&&!e.letterbox||(i.width=i.offsetWidth*u,i.height=i.offsetHeight*u,Fi(),s||(E.frameBuffer.free(),E.frameBuffer=new ks(L,v.drawingBufferWidth,v.drawingBufferHeight),E.width=v.drawingBufferWidth/u,E.height=v.drawingBufferHeight/u))}),e.debug!==!1&&(m.onKeyPress("f1",()=>Ie.inspect=!Ie.inspect),m.onKeyPress("f2",()=>Ie.clearLog()),m.onKeyPress("f8",()=>Ie.paused=!Ie.paused),m.onKeyPress("f7",()=>{Ie.timeScale=ts(bt(Ie.timeScale-.2,0,2),1)}),m.onKeyPress("f9",()=>{Ie.timeScale=ts(bt(Ie.timeScale+.2,0,2),1)}),m.onKeyPress("f10",()=>Ie.stepFrame())),e.burp&&m.onKeyPress("b",()=>Rt())}l(Ri,"initEvents"),Fi(),Ri();let qt={VERSION:Qn,loadRoot:Z,loadProgress:W,loadSprite:se,loadSpriteAtlas:O,loadSound:ut,loadBitmapFont:te,loadFont:ie,loadShader:Mt,loadShaderURL:at,loadAseprite:Ee,loadPedit:Se,loadBean:ye,loadJSON:ue,load:de,getSprite:be,getSound:he,getFont:re,getBitmapFont:ve,getShader:Ne,getAsset:Be,Asset:ot,SpriteData:j,SoundData:I,width:We,height:Ze,center:Fs,dt:ht,time:m.time,screenshot:m.screenshot,record:Jr,isFocused:jr,setCursor:m.setCursor,getCursor:m.getCursor,setCursorLocked:m.setCursorLocked,isCursorLocked:m.isCursorLocked,setFullscreen:m.setFullscreen,isFullscreen:m.isFullscreen,isTouchscreen:m.isTouchscreen,onLoad:Zs,onLoading:io,onResize:ro,onGamepadConnect:m.onGamepadConnect,onGamepadDisconnect:m.onGamepadDisconnect,onError:oo,onCleanup:ao,camPos:ir,camScale:rr,camRot:or,shake:nr,toScreen:mi,toWorld:wi,setGravity:fr,getGravity:gr,setBackground:mr,getBackground:wr,getGamepads:m.getGamepads,add:Rs,make:Xs,destroy:Zr,destroyAll:wn,get:Ei,readd:mn,pos:Ps,scale:Ts,rotate:yr,color:Ar,opacity:xr,anchor:Ws,area:Sr,sprite:Js,text:Mr,polygon:Pr,rect:Tr,circle:Rr,uvquad:Fr,outline:Dr,body:Ir,doubleJump:Cr,shader:zr,timer:js,fixed:Br,stay:Ai,health:Lr,lifespan:Nr,z:vr,move:Er,offscreen:Vr,follow:br,state:Ur,fadeIn:Or,mask:Gr,drawon:Kr,tile:bi,agent:Wr,on:xt,onUpdate:hn,onDraw:dn,onAdd:yi,onDestroy:ar,onClick:un,onCollide:lr,onCollideUpdate:cr,onCollideEnd:hr,onHover:dr,onHoverUpdate:ur,onHoverEnd:pr,onKeyDown:m.onKeyDown,onKeyPress:m.onKeyPress,onKeyPressRepeat:m.onKeyPressRepeat,onKeyRelease:m.onKeyRelease,onMouseDown:m.onMouseDown,onMousePress:m.onMousePress,onMouseRelease:m.onMouseRelease,onMouseMove:m.onMouseMove,onCharInput:m.onCharInput,onTouchStart:m.onTouchStart,onTouchMove:m.onTouchMove,onTouchEnd:m.onTouchEnd,onScroll:m.onScroll,onHide:m.onHide,onShow:m.onShow,onGamepadButtonDown:m.onGamepadButtonDown,onGamepadButtonPress:m.onGamepadButtonPress,onGamepadButtonRelease:m.onGamepadButtonRelease,onGamepadStick:m.onGamepadStick,mousePos:Vs,mouseDeltaPos:m.mouseDeltaPos,isKeyDown:m.isKeyDown,isKeyPressed:m.isKeyPressed,isKeyPressedRepeat:m.isKeyPressedRepeat,isKeyReleased:m.isKeyReleased,isMouseDown:m.isMouseDown,isMousePressed:m.isMousePressed,isMouseReleased:m.isMouseReleased,isMouseMoved:m.isMouseMoved,isGamepadButtonPressed:m.isGamepadButtonPressed,isGamepadButtonDown:m.isGamepadButtonDown,isGamepadButtonReleased:m.isGamepadButtonReleased,getGamepadStick:m.getGamepadStick,charInputted:m.charInputted,loop:yn,wait:_r,play:Ft,volume:Tt,burp:Rt,audioCtx:H.ctx,Line:as,Rect:_e,Circle:uo,Polygon:Is,Vec2:C,Color:Fe,Mat4:wt,Quad:Qe,RNG:Do,rand:Ns,randi:Xi,randSeed:Io,vec2:U,rgb:Me,hsl2rgb:Mn,quad:Ue,choose:zo,chance:Co,lerp:Et,tween:Vi,easings:ti,map:Nt,mapc:Ro,wave:Gi,deg2rad:yt,rad2deg:vs,clamp:bt,testLineLine:ns,testRectRect:Bo,testRectLine:No,testRectPoint:Us,testCirclePolygon:Oo,testLinePoint:Uo,testLineCircle:Wi,drawSprite:Qs,drawText:gi,formatText:It,drawRect:Xe,drawLine:g,drawLines:D,drawTriangle:N,drawCircle:le,drawEllipse:Ae,drawUVQuad:mt,drawPolygon:Ke,drawFormattedText:Ct,drawMasked:bs,drawSubtracted:Es,pushTransform:Oe,popTransform:Le,pushTranslate:Pe,pushScale:gt,pushRotate:De,pushMatrix:es,usePostEffect:je,makeCanvas:ft,debug:Ie,scene:Hr,go:Yr,onSceneLeave:qr,addLevel:Xr,getData:Qr,setData:xi,download:hi,downloadJSON:qo,downloadText:Zi,downloadBlob:Hi,plug:vi,ASCII_CHARS:yo,canvas:m.canvas,addKaboom:$r,LEFT:C.LEFT,RIGHT:C.RIGHT,UP:C.UP,DOWN:C.DOWN,RED:Fe.RED,GREEN:Fe.GREEN,BLUE:Fe.BLUE,YELLOW:Fe.YELLOW,MAGENTA:Fe.MAGENTA,CYAN:Fe.CYAN,WHITE:Fe.WHITE,BLACK:Fe.BLACK,quit:lo,Event:dt,EventHandler:Cs,EventController:os};if(e.plugins&&e.plugins.forEach(vi),e.global!==!1)for(let s in qt)window[s]=qt[s];return e.focus!==!1&&m.canvas.focus(),qt},"default");const y=16;function ce(e,t,i,n){const a=document.createElement("canvas");a.width=e,a.height=t;const d=a.getContext("2d");return d.fillStyle=i,d.fillRect(0,0,e,t),n&&(d.fillStyle=n,d.fillRect(2,2,e-4,t-4)),a.toDataURL()}function Ui(e,t,i,n,a){const d=document.createElement("canvas");d.width=e,d.height=t;const u=d.getContext("2d"),w=u.createLinearGradient(0,0,0,t);w.addColorStop(0,n),w.addColorStop(1,i),u.fillStyle=w,u.fillRect(0,0,e,t),u.fillStyle="rgba(255,255,255,0.1)";for(let A=0;A<20;A++){const m=Math.random()*e,G=Math.random()*t,v=Math.random()*50+10;u.beginPath(),u.arc(m,G,v,0,Math.PI*2),u.fill()}return u.fillStyle="rgba(255,255,255,0.3)",u.font="bold 24px monospace",u.textAlign="center",u.fillText(a,e/2,t/2),d.toDataURL()}function oa(e){e.loadSprite("intro_city",Ui(640,360,"#1a1a2e","#16213e","CITY - 20XX")),e.loadSprite("intro_room",Ui(640,360,"#2d132c","#801336","V'S HIDEOUT")),e.loadSprite("intro_corp",Ui(640,360,"#0f0f23","#1a1a40","BAGASSE CORP")),e.loadSprite("player",ce(16,16,"#4FC3F7","#29B6F6")),e.loadSprite("guard",ce(16,16,"#FF7043","#E64A19")),e.loadSprite("camera-enemy",ce(12,12,"#7E57C2","#5E35B1")),e.loadSprite("babythree",ce(16,16,"#EF5350","#C62828")),e.loadSprite("frozen-fan",ce(16,16,"#B3E5FC","#81D4FA")),e.loadSprite("antifan",ce(16,16,"#D32F2F","#B71C1C")),e.loadSprite("boss",ce(32,32,"#D32F2F","#880E4F")),e.loadSprite("minion",ce(12,12,"#F8BBD9","#EC407A")),e.loadSprite("tuse",ce(16,24,"#FFC107","#FF9800")),e.loadSprite("debt-collector",ce(16,20,"#8B0000","#FF0000")),e.loadSprite("red-eyes",ce(24,12,"#FF0000","#880000")),e.loadSprite("icicle",ce(8,24,"#E0F7FA","#B2EBF2")),e.loadSprite("icicle-shadow",ce(16,8,"#000000","#222222")),e.loadSprite("floor",ce(16,16,"#37474F","#455A64")),e.loadSprite("wall",ce(16,16,"#263238","#1C313A")),e.loadSprite("floor-ice",ce(16,16,"#B3E5FC","#81D4FA")),e.loadSprite("floor-cave",ce(16,16,"#3E2723","#4E342E")),e.loadSprite("floor-boss",ce(16,16,"#7B1FA2","#6A1B9A")),e.loadSprite("pillar",ce(16,32,"#FFD54F","#FFC107")),e.loadSprite("crate",ce(14,14,"#8D6E63","#6D4C41")),e.loadSprite("computer",ce(12,10,"#607D8B","#455A64")),e.loadSprite("pipe",ce(6,16,"#78909C","#546E7A")),e.loadSprite("barrel",ce(12,14,"#5D4037","#4E342E")),e.loadSprite("desk",ce(20,12,"#795548","#5D4037")),e.loadSprite("elevator",ce(16,24,"#FFFFFF","#E0E0E0")),e.loadSprite("projectile",ce(8,8,"#FFCA28","#FFB300")),e.loadSprite("money-projectile",ce(10,8,"#4CAF50","#388E3C")),e.loadSprite("salary-projectile",ce(12,8,"#4CAF50","#2E7D32")),e.loadSprite("ban-hammer",ce(24,32,"#B71C1C","#880E4F")),e.loadSprite("mask-silence",ce(16,16,"#9E9E9E","#757575")),e.loadSprite("mask-ghost",ce(16,16,"#81D4FA","#4FC3F7")),e.loadSprite("mask-frozen",ce(16,16,"#B3E5FC","#81D4FA")),e.loadSprite("mask-shield",ce(16,16,"#FFCC80","#FFB74D")),e.loadSprite("heart",ce(12,12,"#EF5350","#C62828")),e.loadSprite("heart-empty",ce(12,12,"#424242","#303030")),e.loadSprite("arrow",ce(16,16,"#4CAF50","#388E3C")),e.loadSprite("dust",ce(4,4,"#9E9E9E","#757575")),e.loadSprite("hit-particle",ce(6,6,"#FFFFFF","#FFD700")),e.loadSprite("spark",ce(3,3,"#FFEB3B","#FFC107")),console.log("All placeholder assets loaded! Replace with actual sprites.")}const So={ui:{dialogue:"#1A1A2E",dialogueBorder:"#4FC3F7"}},nt={silence:{id:"silence",name:"Mask of Silence",nameVi:"Mt n Cm Lng",color:"#9E9E9E",cooldown:10,duration:5,description:"Become invisible for 5 seconds"},ghost:{id:"ghost",name:"Ghost Mask",nameVi:"Mt n Trn N",color:"#81D4FA",cooldown:8,duration:3,description:"Phase through enemies for 3 seconds"},frozen:{id:"frozen",name:"Frozen Mask",nameVi:"Mt n T Lit",color:"#B3E5FC",cooldown:12,duration:4,description:"Freeze all enemies for 4 seconds"},shield:{id:"shield",name:"Shield Mask",nameVi:"Mt n Bt Tai",color:"#FFCC80",cooldown:8,duration:3,description:"Reflect projectiles for 3 seconds"}},Vt={1:{intro:[{speaker:"Vu",text:"Security floor... I need to sneak past these cameras.",color:"#4FC3F7"},{speaker:"Radio",text:"Be careful, they're watching closely.",color:"#81C784"}],outro:[{speaker:"Vu",text:"Made it past floor 1! Something seems to have dropped...",color:"#4FC3F7"},{speaker:"System",text:"You received: Mask of Silence!",color:"#FFCA28"}]},2:{intro:[{speaker:"Vu",text:"What's all this noise?",color:"#4FC3F7"},{speaker:"Debt Manager",text:"Hey Vu! You think you can pass? Pay the debt first!",color:"#EF5350"},{speaker:"Debt Manager",text:"Stop right there! Pay up!",color:"#EF5350"}],outro:[{speaker:"Vu",text:"Almost got caught in debt!",color:"#4FC3F7"},{speaker:"System",text:"You received: Ghost Mask!",color:"#FFCA28"}]},3:{intro:[{speaker:"Vu",text:"Why is it so cold here?",color:"#4FC3F7"},{speaker:"Demon Statue",text:"Welcome to TWAN. Watch out for falling stars.",color:"#81C784"},{speaker:"Radio",text:"TWAN Headquarters... Where stars fall constantly.",color:"#81C784"}],outro:[{speaker:"Vu",text:"Made it out alive!",color:"#4FC3F7"},{speaker:"System",text:"You received: Freeze Mask!",color:"#FFCA28"}]},4:{intro:[{speaker:"Vu",text:"Too dark, can't see the way out.",color:"#4FC3F7"},{speaker:"Stadium Gate",text:"Welcome to the Stadium. Wear sunglasses when leaving.",color:"#81C784"},{speaker:"Radio",text:"This is the Red Fan Stadium!",color:"#81C784"}],outro:[{speaker:"Vu",text:"Almost at the goal!",color:"#4FC3F7"},{speaker:"System",text:"You received: Shield Mask!",color:"#FFCA28"}]},5:{intro:[{speaker:"Final Boss",text:"Want to get medicine for mom? Step over my body first!",color:"#D32F2F"},{speaker:"Final Boss",text:"This Golden Jerky Box is the corporation's treasure!",color:"#D32F2F"},{speaker:"Vu",text:"Mom is waiting... I can't lose!",color:"#4FC3F7"}]}},ln={health:3,maxHealth:3,currentMask:null,collectedMasks:[],isInvincible:!1,isInvisible:!1,isEthereal:!1,isShielding:!1},Mo={currentLevel:1,isPaused:!1,isDialogueActive:!1,player:{...ln},timeFrozen:!1};class na{constructor(){R(this,"state");this.state=this.deepCopy(Mo)}deepCopy(t){return JSON.parse(JSON.stringify(t))}getState(){return this.state}getPlayerState(){return this.state.player}getCurrentLevel(){return this.state.currentLevel}isPaused(){return this.state.isPaused}isDialogueActive(){return this.state.isDialogueActive}isTimeFrozen(){return this.state.timeFrozen}setCurrentLevel(t){this.state.currentLevel=t}setPaused(t){this.state.isPaused=t}setDialogueActive(t){this.state.isDialogueActive=t}setTimeFrozen(t){this.state.timeFrozen=t}setPlayerHealth(t){this.state.player.health=Math.max(0,Math.min(t,this.state.player.maxHealth))}damagePlayer(t=1){!this.state.player.isInvincible&&!this.state.player.isEthereal&&(this.state.player.health=Math.max(0,this.state.player.health-t))}healPlayer(t=1){this.state.player.health=Math.min(this.state.player.maxHealth,this.state.player.health+t)}isPlayerDead(){return this.state.player.health<=0}setCurrentMask(t){this.state.player.currentMask=t}addCollectedMask(t){this.state.player.collectedMasks.find(i=>i.id===t.id)||this.state.player.collectedMasks.push(t)}getCollectedMasks(){return this.state.player.collectedMasks}hasMask(t){return this.state.player.collectedMasks.some(i=>i.id===t)}setInvisible(t){this.state.player.isInvisible=t}setEthereal(t){this.state.player.isEthereal=t}setShielding(t){this.state.player.isShielding=t}setInvincible(t){this.state.player.isInvincible=t}isInvincible(){return this.state.player.isInvincible}isPlayerInvisible(){return this.state.player.isInvisible}isPlayerEthereal(){return this.state.player.isEthereal}isPlayerShielding(){return this.state.player.isShielding}resetPlayerState(){const t=this.state.player.collectedMasks;this.state.player=this.deepCopy(ln),this.state.player.collectedMasks=t}resetGameState(){this.state=this.deepCopy(Mo)}nextLevel(){this.state.currentLevel++,this.resetPlayerState();const t={1:"silence",2:"ghost",3:"frozen",4:"shield"},i=this.state.currentLevel-1;t[i]&&this.addCollectedMask(nt[t[i]])}prepareForLevel(t){this.state.currentLevel=t,this.state.player.health=t===2?999:3,this.state.player.maxHealth=t===2?999:3;const i={1:"silence",2:"ghost",3:"frozen",4:"shield"};if(t===1)this.state.player.currentMask=null;else if(t<=4){const n=i[t-1];n&&this.hasMask(n)&&(this.state.player.currentMask=nt[n])}else t===5&&this.state.player.collectedMasks.length>0&&(this.state.player.currentMask=this.state.player.collectedMasks[0])}}const x=new na;function aa(e){const t=e.width(),i=e.height();e.add([e.rect(t,i),e.pos(0,0),e.color(20,20,35),e.z(0)]);const n=Math.min(48,t/16);e.add([e.text("CHICKEN JERKY",{size:n}),e.pos(t/2,i*.15),e.anchor("center"),e.color(255,200,100),e.z(1)]),e.add([e.text("RETRIEVAL",{size:n}),e.pos(t/2,i*.22),e.anchor("center"),e.color(255,200,100),e.z(1)]),e.add([e.text("The Masked Mission",{size:Math.min(24,t/32)}),e.pos(t/2,i*.3),e.anchor("center"),e.color(150,150,200),e.z(1)]),["Vu - A covert agent on a crucial mission.","The target: The Golden Jerky Box","The location: Bagasse Corp Tower","Infiltrate. Survive. Retrieve."].forEach((u,w)=>{e.add([e.text(u,{size:Math.min(14,t/55)}),e.pos(t/2,i*.42+w*25),e.anchor("center"),e.color(180,180,180),e.z(1)])});const d=e.add([e.text("Press ENTER or SPACE to Start",{size:Math.min(20,t/40)}),e.pos(t/2,i*.68),e.anchor("center"),e.color(100,255,150),e.z(1)]);d.onUpdate(()=>{const u=.6+Math.sin(e.time()*4)*.4;d.color=e.rgb(100*u,255*u,150*u)}),e.add([e.text("Controls: WASD/Arrows = Move | SPACE = Use Ability",{size:Math.min(12,t/65)}),e.pos(t/2,i*.8),e.anchor("center"),e.color(120,120,120),e.z(1)]),e.add([e.text("Game Jam 2026 - Made with Kaboom.js",{size:Math.min(10,t/80)}),e.pos(t/2,i-20),e.anchor("center"),e.color(80,80,80),e.z(1)]),e.onKeyPress("enter",()=>{x.resetGameState(),e.go("intro")}),e.onKeyPress("space",()=>{x.resetGameState(),e.go("intro")})}function la(e){const t=e.width(),i=e.height();e.add([e.rect(t,i),e.pos(0,0),e.color(30,15,15),e.z(0)]),e.add([e.text("GAME OVER",{size:Math.min(64,t/12)}),e.pos(t/2,i*.25),e.anchor("center"),e.color(255,80,80),e.z(1)]),e.add([e.text(`Failed at Floor ${x.getCurrentLevel()}`,{size:Math.min(24,t/32)}),e.pos(t/2,i*.38),e.anchor("center"),e.color(200,150,150),e.z(1)]);const n={1:"The guards caught you sneaking around...",2:"The creditors got you! 'N nn g tm ny!'",3:"Frozen by the T-One curse...",4:"Pelted by too many bricks and comments!",5:"The CEO was too powerful..."};e.add([e.text(n[x.getCurrentLevel()]||"Mission failed!",{size:Math.min(16,t/50),width:t-100}),e.pos(t/2,i*.48),e.anchor("center"),e.color(180,120,120),e.z(1)]);const a=e.add([e.text("Press ENTER to Retry | ESC for Menu",{size:Math.min(20,t/40)}),e.pos(t/2,i*.65),e.anchor("center"),e.color(150,200,150),e.z(1)]);a.onUpdate(()=>{const d=.6+Math.sin(e.time()*3)*.4;a.color=e.rgb(150*d,200*d,150*d)}),e.onKeyPress("enter",()=>{x.resetPlayerState(),e.go(`level${x.getCurrentLevel()}`)}),e.onKeyPress("escape",()=>{x.resetGameState(),e.go("menu")})}function ca(e){const t=e.width(),i=e.height();e.add([e.rect(t,i),e.pos(0,0),e.color(20,35,25),e.z(0)]);for(let d=0;d<50;d++){const u=e.add([e.rect(e.rand(5,12),e.rand(5,12)),e.pos(e.rand(0,t),e.rand(-100,i)),e.color(e.rand(100,255),e.rand(100,255),e.rand(100,255)),e.rotate(e.rand(0,360)),e.z(1),{speed:e.rand(50,150),rotSpeed:e.rand(-180,180)}]);u.onUpdate(()=>{u.pos.y+=u.speed*e.dt(),u.angle+=u.rotSpeed*e.dt(),u.pos.y>i+20&&(u.pos.y=-20,u.pos.x=e.rand(0,t))})}e.add([e.text(" VICTORY! ",{size:Math.min(56,t/14)}),e.pos(t/2,i*.15),e.anchor("center"),e.color(255,215,0),e.z(10)]),["Vu successfully retrieved the Golden Jerky Box!","","The Final Boss admitted defeat:",`"Well done, I'm proud of you."`,"","Mother and son went home,","enjoying jerky while watching 24h Motion News.","","THE END"].forEach((d,u)=>{e.add([e.text(d,{size:Math.min(16,t/50),width:t-100}),e.pos(t/2,i*.28+u*28),e.anchor("center"),e.color(200,230,200),e.z(10)])}),e.add([e.text("",{size:Math.min(48,t/16)}),e.pos(t/2,i*.82),e.anchor("center"),e.z(10)]);const a=e.add([e.text("Press ENTER to Play Again",{size:Math.min(18,t/44)}),e.pos(t/2,i-40),e.anchor("center"),e.color(150,255,150),e.z(10)]);a.onUpdate(()=>{const d=.6+Math.sin(e.time()*3)*.4;a.color=e.rgb(150*d,255*d,150*d)}),e.onKeyPress("enter",()=>{x.resetGameState(),e.go("menu")})}function ha(e){const t=e.width(),i=e.height(),n=[{img:"intro_room",text:"Mom Bi has a strange illness: 'Terminal Chicken Jerky Craving Syndrome'. The only cure is the Golden Jerky Box."},{img:"intro_corp",text:"That Golden Jerky Box is at the top floor of Bagasse Corp. Vu decides to infiltrate and save mom."},{img:"intro_city",text:"Vu: 'Wait for me mom, I'll bring it back! No matter who I have to face!'"}];let a=0,d=!1,u=null,w=null,A=null,m=0,G=0;const v=.03;e.add([e.rect(t,i),e.pos(0,0),e.color(0,0,0),e.z(0),e.fixed()]);const L=e.add([e.rect(100,36,{radius:6}),e.pos(t-120,20),e.color(40,40,50),e.outline(2,e.rgb(150,150,160)),e.opacity(.9),e.area(),e.z(300),e.fixed(),"skip-btn"]),E=e.add([e.text("SKIP",{size:16}),e.pos(t-70,38),e.anchor("center"),e.color(200,200,200),e.z(301),e.fixed()]);L.onHover(()=>{L.color=e.rgb(70,70,90),E.color=e.rgb(255,255,255)}),L.onHoverEnd(()=>{L.color=e.rgb(40,40,50),E.color=e.rgb(200,200,200)}),L.onClick(()=>{Po(e)});const j=e.add([e.rect(140,44,{radius:8}),e.pos(t-160,i-60),e.color(60,100,60),e.outline(3,e.rgb(100,200,100)),e.opacity(.95),e.area(),e.z(300),e.fixed(),"next-btn"]),I=e.add([e.text("Tip theo >>",{size:18}),e.pos(t-90,i-38),e.anchor("center"),e.color(220,255,220),e.z(301),e.fixed()]);j.onHover(()=>{j.color=e.rgb(80,140,80),I.color=e.rgb(255,255,255)}),j.onHoverEnd(()=>{j.color=e.rgb(60,100,60),I.color=e.rgb(220,255,220)}),j.onClick(()=>{H()});function H(){if(d)return;const X=n[a];if(!(!X||!A)){if(m<X.text.length){m=X.text.length,A.text=X.text;return}d=!0,u&&e.tween(1,0,.3,S=>{u&&(u.opacity=S),w&&(w.opacity=S*.85),A&&(A.opacity=S)},e.easings.easeInQuad).onEnd(()=>{a++,B(a)})}}function B(X){if(X>=n.length){Po(e);return}const S=n[X];m=0,G=0,d=!1,u&&u.destroy(),w&&w.destroy(),A&&A.destroy(),u=e.add([e.sprite(S.img),e.pos(t/2,i/2),e.anchor("center"),e.scale(1.3),e.opacity(0),e.z(1)]);const W=[{startX:-50,startY:-30,endX:50,endY:30,startScale:1.3,endScale:1},{startX:50,startY:-20,endX:-50,endY:40,startScale:1.1,endScale:1.25},{startX:0,startY:-40,endX:0,endY:40,startScale:1.35,endScale:1.05}],Z=W[X%W.length];u.pos=e.vec2(t/2+Z.startX,i/2+Z.startY),u.scale=e.vec2(Z.startScale,Z.startScale),e.tween(0,1,.8,ie=>{u&&(u.opacity=ie)},e.easings.easeOutQuad),e.tween(0,1,15,ie=>{if(u){const te=t/2+Z.startX+(Z.endX-Z.startX)*ie,oe=i/2+Z.startY+(Z.endY-Z.startY)*ie,O=Z.startScale+(Z.endScale-Z.startScale)*ie;u.pos=e.vec2(te,oe),u.scale=e.vec2(O,O)}},e.easings.linear);const ue=100,pe=40;w=e.add([e.rect(t-pe*2,ue,{radius:8}),e.pos(pe,i-ue-80),e.color(0,0,0),e.opacity(.85),e.outline(2,e.rgb(100,100,120)),e.z(100),e.fixed()]),A=e.add([e.text("",{size:Math.min(20,t/40),width:t-pe*2-40,lineSpacing:6}),e.pos(pe+20,i-ue-60),e.color(255,255,255),e.z(101),e.fixed()]),e.destroyAll("slide-dot");for(let ie=0;ie<n.length;ie++)e.add([e.circle(ie===X?6:4),e.pos(t/2-30+ie*25,i-190),e.color(ie===X?e.rgb(255,255,255):e.rgb(100,100,100)),e.z(102),e.fixed(),"slide-dot"])}B(0),e.onUpdate(()=>{if(d)return;const X=n[a];!X||!A||(G+=e.dt(),G>=v&&m<X.text.length&&(m++,A.text=X.text.substring(0,m),G=0))}),e.onKeyPress("enter",()=>H()),e.onKeyPress("space",()=>H())}function Po(e){const t=e.add([e.rect(e.width(),e.height()),e.pos(0,0),e.color(0,0,0),e.opacity(0),e.z(500),e.fixed()]);e.tween(0,1,.8,i=>{t.opacity=i},e.easings.easeInQuad).onEnd(()=>{e.go("level1")})}function da(e){const t=e.width(),i=e.height(),n=[{img:"intro_corp",text:"The Final Boss collapses. Vu approaches to remove the mask..."},{img:"intro_room",text:"It's MOM BI! She is the mysterious CEO of Bagasse Corp."},{img:"intro_city",text:"Mom Bi: 'I'm sorry for hiding this from you. I needed to know if you were mature enough to protect the family.'"},{img:"intro_room",text:`Vu has proven his worth. Mother and son enjoy the Golden Jerky while watching 24h Motion News.
THE END.`}];let a=0,d=!1,u=null,w=null,A=null,m=0,G=0;const v=.03;e.add([e.rect(t,i),e.pos(0,0),e.color(0,0,0),e.z(0),e.fixed()]);const L=e.add([e.rect(100,36,{radius:6}),e.pos(t-120,20),e.color(40,40,50),e.outline(2,e.rgb(150,150,160)),e.opacity(.9),e.area(),e.z(300),e.fixed(),"skip-btn"]),E=e.add([e.text("SKIP",{size:16}),e.pos(t-70,38),e.anchor("center"),e.color(200,200,200),e.z(301),e.fixed()]);L.onHover(()=>{L.color=e.rgb(70,70,90),E.color=e.rgb(255,255,255)}),L.onHoverEnd(()=>{L.color=e.rgb(40,40,50),E.color=e.rgb(200,200,200)}),L.onClick(()=>{X()});const j=e.add([e.rect(140,44,{radius:8}),e.pos(t-160,i-60),e.color(60,100,60),e.outline(3,e.rgb(100,200,100)),e.opacity(.95),e.area(),e.z(300),e.fixed(),"next-btn"]),I=e.add([e.text("Tip theo >>",{size:18}),e.pos(t-90,i-38),e.anchor("center"),e.color(220,255,220),e.z(301),e.fixed()]);j.onHover(()=>{j.color=e.rgb(80,140,80),I.color=e.rgb(255,255,255)}),j.onHoverEnd(()=>{j.color=e.rgb(60,100,60),I.color=e.rgb(220,255,220)}),j.onClick(()=>{H()});function H(){if(d)return;const S=n[a];if(!(!S||!A)){if(m<S.text.length){m=S.text.length,A.text=S.text;return}d=!0,u&&e.tween(1,0,.3,de=>{u&&(u.opacity=de),w&&(w.opacity=de*.85),A&&(A.opacity=de)},e.easings.easeInQuad).onEnd(()=>{a++,B(a)})}}function B(S){if(S>=n.length){X();return}const de=n[S];m=0,G=0,d=!1,u&&u.destroy(),w&&w.destroy(),A&&A.destroy(),u=e.add([e.sprite(de.img),e.pos(t/2,i/2),e.anchor("center"),e.scale(1.3),e.opacity(0),e.z(1)]);const W=e.rand(-50,50),Z=e.rand(-30,30);u.pos=e.vec2(t/2+W,i/2+Z),e.tween(0,1,.8,ie=>{u&&(u.opacity=ie)},e.easings.easeOutQuad),e.tween(0,1,15,ie=>{u&&(u.pos=e.vec2(t/2+W-W*2*ie,i/2+Z-Z*2*ie))},e.easings.linear);const ue=120,pe=40;w=e.add([e.rect(t-pe*2,ue,{radius:8}),e.pos(pe,i-ue-80),e.color(0,0,0),e.opacity(.85),e.outline(2,e.rgb(100,100,120)),e.z(100),e.fixed()]),A=e.add([e.text("",{size:Math.min(18,t/45),width:t-pe*2-40,lineSpacing:6}),e.pos(pe+20,i-ue-60),e.color(255,255,255),e.z(101),e.fixed()]),e.destroyAll("slide-dot");for(let ie=0;ie<n.length;ie++)e.add([e.circle(ie===S?6:4),e.pos(t/2-30+ie*25,i-210),e.color(ie===S?e.rgb(255,255,255):e.rgb(100,100,100)),e.z(102),e.fixed(),"slide-dot"])}function X(){e.get("*").forEach(de=>de.destroy()),e.add([e.rect(t,i),e.pos(0,0),e.color(80,60,50),e.z(0),e.fixed()]),e.add([e.rect(300,120,{radius:10}),e.pos(t/2,i/2+50),e.anchor("center"),e.color(120,80,60),e.z(1),e.fixed()]),e.add([e.sprite("player"),e.pos(t/2-60,i/2+30),e.anchor("center"),e.scale(2.5),e.z(5),e.fixed()]),e.add([e.sprite("player"),e.pos(t/2+60,i/2+30),e.anchor("center"),e.scale(2.5),e.color(255,180,200),e.z(5),e.fixed()]),e.add([e.rect(40,60,{radius:5}),e.pos(t/2,i/2+80),e.anchor("center"),e.color(200,150,100),e.outline(2,e.rgb(100,70,40)),e.z(6),e.fixed()]),e.add([e.text(`Golden
Jerky`,{size:10,align:"center"}),e.pos(t/2,i/2+80),e.anchor("center"),e.color(80,50,30),e.z(7),e.fixed()]),e.add([e.rect(180,120,{radius:8}),e.pos(t/2,i/2-120),e.anchor("center"),e.color(40,40,60),e.z(2),e.fixed()]),e.add([e.rect(160,100,{radius:4}),e.pos(t/2,i/2-120),e.anchor("center"),e.color(100,150,200),e.z(3),e.fixed()]),e.add([e.text("LIVE",{size:14}),e.pos(t/2,i/2-160),e.anchor("center"),e.color(255,50,50),e.z(4),e.fixed()]),e.add([e.text("24h Motion News",{size:10}),e.pos(t/2,i/2-140),e.anchor("center"),e.color(255,255,255),e.z(4),e.fixed()]),e.add([e.text("Evening News",{size:8}),e.pos(t/2,i/2-125),e.anchor("center"),e.color(200,200,200),e.z(4),e.fixed()]),e.add([e.rect(t-60,100,{radius:12}),e.pos(t/2,60),e.anchor("center"),e.color(0,0,0),e.opacity(.8),e.z(100),e.fixed()]),e.add([e.text("HAPPY ENDING",{size:28}),e.pos(t/2,40),e.anchor("center"),e.color(255,215,0),e.z(101),e.fixed()]),e.add([e.text("GIA NH VN HA",{size:20}),e.pos(t/2,70),e.anchor("center"),e.color(200,200,255),e.z(101),e.fixed()]);const S=e.add([e.rect(200,50,{radius:8}),e.pos(t/2,i-60),e.anchor("center"),e.color(50,100,50),e.outline(3,e.rgb(100,200,100)),e.area(),e.z(101),e.fixed()]);e.add([e.text("MENU",{size:24}),e.pos(t/2,i-60),e.anchor("center"),e.color(255,255,255),e.z(102),e.fixed()]),S.onHover(()=>{S.color=e.rgb(70,130,70)}),S.onHoverEnd(()=>{S.color=e.rgb(50,100,50)}),S.onClick(()=>{e.go("menu")}),e.onKeyPress("space",()=>{e.go("menu")}),e.onKeyPress("enter",()=>{e.go("menu")})}B(0),e.onUpdate(()=>{if(d)return;const S=n[a];!S||!A||(G+=e.dt(),G>=v&&m<S.text.length&&(m++,A.text=S.text.substring(0,m),G=0))}),e.onKeyPress("enter",()=>H()),e.onKeyPress("space",()=>H())}function ua(e){const t=e.width(),i=e.height(),n=e.add([e.rect(t,i),e.pos(0,0),e.color(0,0,0),e.opacity(1),e.z(0),e.fixed()]),a=e.add([e.rect(t,i),e.pos(0,0),e.color(255,255,255),e.opacity(0),e.z(200),e.fixed()]),d=e.add([e.rect(120,40,{radius:20}),e.pos(t-140,25),e.color(80,40,40),e.outline(3,e.rgb(200,100,100)),e.opacity(.9),e.area(),e.z(500),e.fixed(),"skip-btn"]);e.add([e.text(" SKIP",{size:14}),e.pos(t-80,45),e.anchor("center"),e.color(255,200,200),e.z(501),e.fixed()]),d.onHover(()=>{d.color=e.rgb(120,60,60)}),d.onHoverEnd(()=>{d.color=e.rgb(80,40,40)}),d.onClick(()=>{e.go("level5")});const u=Math.min(400,t*.6),w=Math.min(500,i*.8),A=t/2,m=i/2;e.add([e.rect(u+20,w+20,{radius:8}),e.pos(A,m),e.anchor("center"),e.color(30,30,40),e.outline(6,e.rgb(80,70,60)),e.z(1),e.fixed()]);const G=e.add([e.rect(u,w,{radius:4}),e.pos(A,m),e.anchor("center"),e.color(60,55,70),e.outline(3,e.rgb(100,90,80)),e.z(2),e.fixed()]);for(let O=0;O<8;O++)e.add([e.rect(u-40,2),e.pos(A,m-w/2+50+O*(w-80)/7),e.anchor("center"),e.color(80,75,90),e.opacity(.5),e.z(3),e.fixed()]);e.add([e.text("SUPREME GATE",{size:20}),e.pos(A,m-w/2-30),e.anchor("center"),e.color(180,150,100),e.z(10),e.fixed()]);const v=50,L=100,E=m,j=A-L*1.5,I=[nt.silence,nt.ghost,nt.frozen,nt.shield],H=[];for(let O=0;O<4;O++){const k=j+O*L;e.add([e.rect(v+10,v+10,{radius:8}),e.pos(k,E),e.anchor("center"),e.color(40,35,45),e.outline(3,e.rgb(90,80,70)),e.z(4),e.fixed()]);const se=e.add([e.rect(v,v,{radius:6}),e.pos(k,E),e.anchor("center"),e.color(20,20,25),e.outline(2,e.rgb(60,50,40)),e.opacity(.8),e.z(5),e.fixed()]);H.push({x:k,y:E,mask:I[O],filled:!1,visual:se})}const B=i/2,X=[],S=[],de=e.add([e.circle(100),e.pos(t/2,i/2),e.anchor("center"),e.color(255,255,200),e.opacity(0),e.z(15),e.fixed()]);for(let O=0;O<4;O++){const k=I[O],se=e.add([e.circle(25),e.pos(t/2,B),e.anchor("center"),e.color(e.Color.fromHex(k.color)),e.opacity(0),e.scale(.5),e.z(20),e.fixed(),{maskIndex:O,bobOffset:O*.5,orbitAngle:O/4*Math.PI*2,orbitRadius:70}]),Se=["","","",""],Ee=e.add([e.text(Se[O],{size:18}),e.pos(t/2,B),e.anchor("center"),e.opacity(0),e.z(21),e.fixed(),{parentMask:se}]);X.push(se),S.push(Ee),Ee.onUpdate(()=>{Ee.pos=se.pos})}let W=0,Z=0;function ue(){if(H[Z-1]){const O=H[Z-1];O.visual.color=e.rgb(255,255,200),e.wait(.1,()=>{O.visual.color=e.Color.fromHex(O.mask.color)})}e.tween(.7,0,.25,O=>{a.opacity=O},e.easings.easeOutQuad),e.shake(2)}function pe(O){const k=X[O],se=S[O],Se=H[O];e.tween(1.2,1.5,.15,Ee=>{k.scale=e.vec2(Ee,Ee)},e.easings.easeOutQuad),e.wait(.15,()=>{e.tween(k.pos,e.vec2(Se.x,Se.y),.6,Ee=>{k.pos=Ee},e.easings.easeInCubic).onEnd(()=>{e.tween(1.5,1,.1,Ee=>{k.scale=e.vec2(Ee,Ee)},e.easings.easeOutQuad),Se.filled=!0,Se.visual.color=e.Color.fromHex(Se.mask.color),Se.visual.opacity=1,se.opacity=0,k.opacity=0,ue(),Z++,W++})})}function ie(){let O=0;const k=e.onUpdate(()=>{O+=e.dt(),G.pos.x=A+Math.sin(O*30)*3,O>1.5&&(k.cancel(),G.pos.x=A,te())})}function te(){for(let k=0;k<6;k++){const se=k/6*Math.PI-Math.PI/2,Se=e.add([e.rect(8,0),e.pos(A,m),e.anchor("bot"),e.rotate(se*(180/Math.PI)),e.color(255,240,180),e.opacity(.8),e.z(50),e.fixed()]);e.tween(0,500,1,Ee=>{Se.height=Ee,Se.opacity=.8-Ee/800},e.easings.easeOutQuad)}const O=e.add([e.rect(t,i),e.pos(0,0),e.color(255,255,255),e.opacity(0),e.z(100),e.fixed()]);e.tween(0,1,1.5,k=>{O.opacity=k},e.easings.easeInQuad).onEnd(()=>{e.go("level5")})}e.wait(.3,()=>{e.tween(0,.9,.5,O=>{n.opacity=O},e.easings.easeInQuad),e.tween(0,.4,.8,O=>{de.opacity=O},e.easings.easeOutQuad),e.wait(.5,()=>{X.forEach((O,k)=>{e.tween(0,.9,.5,se=>{O.opacity=se,S[k].opacity=se},e.easings.easeOutQuad),e.tween(.5,1.2,.4,se=>{O.scale=e.vec2(se,se)},e.easings.easeOutBack)})}),e.wait(1.5,()=>{e.tween(.9,.6,.5,O=>{n.opacity=O},e.easings.easeOutQuad),W=1})});let oe=1.5;e.onUpdate(()=>{(W===0||W===1)&&X.forEach(O=>{if(O.opacity<.1)return;O.orbitAngle+=oe*e.dt();const k=t/2,se=i/2;O.pos.x=k+Math.cos(O.orbitAngle)*O.orbitRadius,O.pos.y=se+Math.sin(O.orbitAngle)*O.orbitRadius+Math.sin(e.time()*3+O.bobOffset)*5}),W>=2&&W<=5&&Z===W-2&&(oe=0,pe(Z)),W===6&&(W=7,e.wait(.5,()=>{ie()}))}),e.wait(3.5,()=>{W=2}),e.add([e.text("4 Masks activate the Supreme Gate...",{size:14}),e.pos(t/2,i-40),e.anchor("center"),e.color(150,140,120),e.opacity(.8),e.z(10),e.fixed()])}class Os{constructor(t){R(this,"k");R(this,"cooldowns",new Map);R(this,"activeEffects",new Map);this.k=t,Object.keys(nt).forEach(i=>{this.cooldowns.set(i,0),this.activeEffects.set(i,!1)})}getCooldown(t){return this.cooldowns.get(t)||0}canUseAbility(t){return(this.cooldowns.get(t)||0)<=0}isEffectActive(t){return this.activeEffects.get(t)||!1}update(t){this.cooldowns.forEach((i,n)=>{i>0&&this.cooldowns.set(n,Math.max(0,i-t))})}activateAbility(t){const i=x.getPlayerState().currentMask;if(i&&this.canUseAbility(i.id))switch(this.cooldowns.set(i.id,i.cooldown),this.activeEffects.set(i.id,!0),i.id){case"silence":this.activateSilence(t,i);break;case"ghost":this.activateGhost(t,i);break;case"frozen":this.activateFrozen(i);break;case"shield":this.activateShield(t,i);break}}activateSilence(t,i){x.setInvisible(!0),t.opacity!==void 0&&(t.opacity=.3),this.showAbilityText("INVISIBLE!"),this.k.wait(i.duration,()=>{x.setInvisible(!1),t.opacity!==void 0&&(t.opacity=1),this.activeEffects.set(i.id,!1)})}activateGhost(t,i){x.setEthereal(!0),t.color&&(t.color=this.k.rgb(129,212,250)),this.showAbilityText("ETHEREAL!"),this.k.wait(i.duration,()=>{x.setEthereal(!1),t.color&&(t.color=this.k.rgb(79,195,247)),this.activeEffects.set(i.id,!1)})}activateFrozen(t){x.setTimeFrozen(!0),this.showAbilityText("TIME FREEZE!"),this.k.wait(t.duration,()=>{x.setTimeFrozen(!1),this.activeEffects.set(t.id,!1)})}activateShield(t,i){x.setShielding(!0),this.showAbilityText("SHIELD!"),this.k.wait(i.duration,()=>{x.setShielding(!1),this.activeEffects.set(i.id,!1)})}showAbilityText(t){const i=this.k.add([this.k.text(t,{size:32}),this.k.pos(this.k.width()/2,this.k.height()/2-50),this.k.anchor("center"),this.k.color(255,255,100),this.k.opacity(1),this.k.z(100),"ability-text"]);this.k.tween(1,0,.5,n=>{i.opacity=n},this.k.easings.easeOutQuad).onEnd(()=>{i.destroy()}),this.k.tween(i.pos.y,i.pos.y-50,.5,n=>{i.pos.y=n},this.k.easings.easeOutQuad)}switchToNextMask(){const t=x.getCollectedMasks();if(t.length===0)return;const i=x.getPlayerState().currentMask;if(!i){x.setCurrentMask(t[0]);return}const a=(t.findIndex(d=>d.id===i.id)+1)%t.length;x.setCurrentMask(t[a])}switchToMaskByIndex(t){const i=x.getCollectedMasks();t>=0&&t<i.length&&x.setCurrentMask(i[t])}setMask(t){this.switchToMaskByIndex(t)}cycleMask(){const t=x.getCollectedMasks();if(t.length===0)return;const i=x.getPlayerState().currentMask,a=((i?t.findIndex(d=>d.id===i.id):-1)+1)%t.length;x.setCurrentMask(t[a])}getCooldownPercent(t){const i=nt[t];return i?(this.cooldowns.get(t)||0)/i.cooldown:0}reset(){this.cooldowns.forEach((t,i)=>{this.cooldowns.set(i,0),this.activeEffects.set(i,!1)}),x.setInvisible(!1),x.setEthereal(!1),x.setShielding(!1),x.setTimeFrozen(!1)}}let Ye=null,Ls=0,Wt=0,Lt=!1,ni=0;const To=.03;function St(e,t,i){if(t.length===0){i();return}x.setDialogueActive(!0),Ls=0,pa(e),Qi(e,t,i)}function pa(e){Ye&&cn();const t=e.width(),i=e.height(),n=Math.max(100,Math.min(140,i*.2)),a=i-n-20,d=t-60,u=30,w=Math.max(14,Math.min(22,t/40)),A=Math.max(12,Math.min(18,t/50)),m=Math.max(10,Math.min(14,t/60)),G=e.add([e.rect(d,n,{radius:8}),e.pos(u,a),e.color(e.Color.fromHex(So.ui.dialogue)),e.outline(3,e.Color.fromHex(So.ui.dialogueBorder)),e.opacity(.95),e.z(200),e.fixed(),"dialogue-ui"]),v=e.add([e.text("",{size:w}),e.pos(u+20,a+15),e.color(255,255,255),e.z(201),e.fixed(),"dialogue-ui"]),L=e.add([e.text("",{size:A,width:d-40,lineSpacing:4}),e.pos(u+20,a+40),e.color(255,255,255),e.z(201),e.fixed(),"dialogue-ui"]),E=e.add([e.text("Press ENTER to continue...",{size:m}),e.pos(t-u-180,a+n-22),e.color(180,180,180),e.opacity(.8),e.z(201),e.fixed(),"dialogue-ui"]);E.onUpdate(()=>{E.opacity=.5+Math.sin(e.time()*4)*.3,E.hidden=Lt}),Ye={box:G,speakerText:v,dialogueText:L,continueText:E}}function Qi(e,t,i){if(!Ye)return;if(Ls>=t.length){cn(),x.setDialogueActive(!1),i();return}const n=t[Ls];Ye.speakerText.text=n.speaker,n.color&&(Ye.speakerText.color=e.Color.fromHex(n.color)),Wt=0,Lt=!0,ni=0,Ye.dialogueText.text="";const a=e.onUpdate(()=>{if(!(!Lt||!Ye)){for(ni+=e.dt();ni>=To&&Wt<n.text.length;)ni-=To,Wt++,Ye.dialogueText.text=n.text.substring(0,Wt);Wt>=n.text.length&&(Lt=!1)}}),d=e.onKeyPress("enter",()=>{Lt?(Lt=!1,Ye&&(Ye.dialogueText.text=n.text),Wt=n.text.length):(Ls++,a.cancel(),d.cancel(),Qi(e,t,i))}),u=e.onKeyPress("space",()=>{Lt?(Lt=!1,Ye&&(Ye.dialogueText.text=n.text),Wt=n.text.length):(Ls++,a.cancel(),u.cancel(),d.cancel(),Qi(e,t,i))})}function cn(){Ye&&(Ye.box.destroy(),Ye.speakerText.destroy(),Ye.dialogueText.destroy(),Ye.continueText.destroy(),Ye=null)}const fa={zoom:3,lerpSpeed:.1,lookAheadDistance:30,bounds:void 0};function Fo(e,t,i){return e+(t-e)*i}class Gs{constructor(t,i={}){R(this,"k");R(this,"config");R(this,"targetPos");R(this,"currentPos");R(this,"shakeIntensity",0);R(this,"shakeDuration",0);this.k=t,this.config={...fa,...i},this.targetPos=t.vec2(0,0),this.currentPos=t.vec2(0,0),t.camScale(t.vec2(this.config.zoom))}follow(t,i){if(!t||!t.pos)return;let n=t.pos.x,a=t.pos.y;if(i&&this.config.lookAheadDistance>0){const w=this.k.vec2(this.k.width()/2,this.k.height()/2),m=i.sub(w).unit().scale(this.config.lookAheadDistance);n+=m.x,a+=m.y}if(this.targetPos=this.k.vec2(n,a),this.config.bounds){const w=this.k.width()/(2*this.config.zoom),A=this.k.height()/(2*this.config.zoom);this.targetPos.x=Math.max(this.config.bounds.minX+w,Math.min(this.config.bounds.maxX-w,this.targetPos.x)),this.targetPos.y=Math.max(this.config.bounds.minY+A,Math.min(this.config.bounds.maxY-A,this.targetPos.y))}this.currentPos.x=Fo(this.currentPos.x,this.targetPos.x,this.config.lerpSpeed),this.currentPos.y=Fo(this.currentPos.y,this.targetPos.y,this.config.lerpSpeed);let d=this.currentPos.x,u=this.currentPos.y;this.shakeDuration>0&&(this.shakeDuration-=this.k.dt(),d+=(Math.random()-.5)*this.shakeIntensity,u+=(Math.random()-.5)*this.shakeIntensity),this.k.camPos(d,u)}snapTo(t){this.currentPos=t.clone(),this.targetPos=t.clone(),this.k.camPos(t)}shake(t=5,i=.2){this.shakeIntensity=t,this.shakeDuration=i}setZoom(t){this.config.zoom=t,this.k.camScale(this.k.vec2(t))}getZoom(){return this.config.zoom}setBounds(t,i,n,a){this.config.bounds={minX:t,minY:i,maxX:n,maxY:a}}clearBounds(){this.config.bounds=void 0}screenToWorld(t){const i=this.k.camPos(),n=this.config.zoom;return this.k.vec2((t.x-this.k.width()/2)/n+i.x,(t.y-this.k.height()/2)/n+i.y)}worldToScreen(t){const i=this.k.camPos(),n=this.config.zoom;return this.k.vec2((t.x-i.x)*n+this.k.width()/2,(t.y-i.y)*n+this.k.height()/2)}isOnScreen(t,i=50){const n=this.worldToScreen(t);return n.x>=-i&&n.x<=this.k.width()+i&&n.y>=-i&&n.y<=this.k.height()+i}}function Ks(e){const t=e.add([e.pos(0,0),e.fixed(),e.z(1e3)]),i=[];for(let v=0;v<3;v++){const L=t.add([e.sprite("heart"),e.pos(10+v*16,10),e.scale(1.5),e.z(1001),{index:v}]);i.push(L)}const n=t.add([e.sprite("mask-silence"),e.pos(10,40),e.scale(2),e.z(1001)]),a=t.add([e.text("No Mask",{size:10}),e.pos(50,42),e.color(200,200,200),e.z(1001)]),d=t.add([e.rect(80,10),e.pos(50,55),e.color(20,20,30),e.outline(1,e.rgb(60,60,80)),e.z(1001)]),u=t.add([e.rect(78,8),e.pos(51,56),e.color(100,255,100),e.z(1002)]),w=t.add([e.rect(80,10),e.pos(50,55),e.color(100,255,100),e.opacity(0),e.z(1e3)]),A=t.add([e.text("READY",{size:7}),e.pos(90,60),e.anchor("center"),e.color(255,255,255),e.z(1003)]),m=t.add([e.text("Floor 1",{size:12}),e.pos(e.width()/2,10),e.anchor("top"),e.color(255,255,255),e.z(1001)]),G=t.add([e.sprite("arrow"),e.pos(e.width()/2,e.height()/2),e.anchor("center"),e.rotate(0),e.scale(1.5),e.opacity(.8),e.z(1003),{visible:!1}]);return{container:t,hearts:i,maskIcon:n,maskNameText:a,cooldownBg:d,cooldownBar:u,cooldownGlow:w,cooldownText:A,levelText:m,objectivePointer:G,timerText:null}}function Hs(e,t,i,n,a){const d=x.getPlayerState(),u=x.getCurrentLevel();t.hearts.forEach((A,m)=>{m<d.health?(A.use(e.sprite("heart")),A.opacity=1):(A.use(e.sprite("heart-empty")),A.opacity=.5)}),u===2?t.hearts.forEach(A=>A.hidden=!0):t.hearts.forEach(A=>A.hidden=!1);const w=d.currentMask;if(w){const A={silence:"mask-silence",ghost:"mask-ghost",frozen:"mask-frozen",shield:"mask-shield"};t.maskIcon.use(e.sprite(A[w.id]||"mask-silence")),t.maskNameText.text=w.nameVi;const m=1-i.getCooldownPercent(w.id);t.cooldownBar.width=78*m,i.canUseAbility(w.id)?(t.cooldownBar.color=e.rgb(100,255,100),t.cooldownText.text="READY",t.cooldownText.color=e.rgb(100,255,100),t.cooldownGlow.opacity=.2+Math.sin(e.time()*6)*.15):(t.cooldownBar.color=e.rgb(79,195,247),t.cooldownText.text=`${Math.floor(m*100)}%`,t.cooldownText.color=e.rgb(150,150,150),t.cooldownGlow.opacity=0)}else t.maskNameText.text="No Mask",t.cooldownBar.width=0,t.cooldownText.text="---",t.cooldownGlow.opacity=0;t.levelText.text=`Floor ${u}`,n&&a?ga(e,t,n,a):t.objectivePointer.hidden=!0}function ga(e,t,i,n){if(n.isOnScreen(i,0)){t.objectivePointer.hidden=!0;return}t.objectivePointer.hidden=!1;const d=e.vec2(e.width()/2,e.height()/2),w=n.worldToScreen(i).sub(d),A=Math.atan2(w.y,w.x)*(180/Math.PI)+90,m=30,G=e.width()-m,v=e.height()-m;let L=d.x+w.unit().x*(e.width()/2-m),E=d.y+w.unit().y*(e.height()/2-m);L=Math.max(m,Math.min(G,L)),E=Math.max(m,Math.min(v,E)),t.objectivePointer.pos=e.vec2(L,E),t.objectivePointer.angle=A,t.objectivePointer.opacity=.6+Math.sin(e.time()*4)*.3}const ma={tileSize:y,floorSprite:"floor",wallSprite:"wall",tiles:["##################################################","#................................................#","#.......C................................C.......#","#................................................#","#....######..........G..........######..........#","#....#....#......................#....#.........#","#....#....#......................#....#....E....#","#....######......................######.........#","#................................................#","#..........G..........................G..........#","#................................................#","#....######..........######..........######.....#","#....#....#..........#....#..........#....#.....#","#....#....#..........#....#..........#....#.....#","#....######..........######..........######.....#","#................................................#","#.......C.................C.................C...#","#................................................#","#................................................#","#....######.......................######........#","#....#....#.......................#....#........#","#....#....#..........G............#....#........#","#....######.......................######........#","#................................................#","#.P..............................................#","##################################################"],get width(){return this.tiles[0].length*this.tileSize},get height(){return this.tiles.length*this.tileSize}},wa={tileSize:y,floorSprite:"floor",wallSprite:"wall",tiles:["################################","#..............................#","#..............................#","#..T...........................#","#..............................#","#..............................#","#..............................#","#..............................#","#..............P...............#","#..............................#","#..............................#","#..............................#","#..............................#","#..............................#","#..............................#","#..............................#","################################"],get width(){return this.tiles[0].length*this.tileSize},get height(){return this.tiles.length*this.tileSize}},ya={tileSize:y,floorSprite:"floor-ice",wallSprite:"wall",tiles:["##################################################","#................................................#","#.....F..............F..............F...........#","#................................................#","#........###........###........###..........E...#","#........###........###........###..............#","#................................................#","#...F..............F..............F.............#","#................................................#","#................................................#","#........###........###........###..............#","#........###........###........###..............#","#................................................#","#...F..............F..............F..............#","#................................................#","#........###........###........###..............#","#........###........###........###..............#","#................................................#","#...F..............F..............F..............#","#.P..............................................#","##################################################"],get width(){return this.tiles[0].length*this.tileSize},get height(){return this.tiles.length*this.tileSize}},Aa={tileSize:y,floorSprite:"floor-cave",wallSprite:"wall",tiles:["##################################################","#................................................#","#.....A......................A...................#","#................................................#","#.........#####################..................#","#.........#...................#..................#","#.........#...................#..................#","#.........#...................#..................#","#.........#...................#..........E.......#","#.........#...................#..................#","#.........#...................#..................#","#.........#####################..................#","#................................................#","#.....A......................A...................#","#................................................#","#.........#####################..................#","#.........#...................#..................#","#.........#...................#..................#","#.........#####################..................#","#.P..............................................#","##################################################"],get width(){return this.tiles[0].length*this.tileSize},get height(){return this.tiles.length*this.tileSize}},xa={tileSize:y,floorSprite:"floor-boss",wallSprite:"wall",tiles:["########################################","#......................................#","#..O................................O..#","#......................................#","#......................................#","#..............M.......................#","#......................................#","#......................................#","#..O................................O..#","#......................................#","#......................................#","#......................................#","#......................................#","#..O................................O..#","#......................................#","#......................................#","#..................P...................#","#......................................#","########################################"],get width(){return this.tiles[0].length*this.tileSize},get height(){return this.tiles.length*this.tileSize}};function Ys(e,t){const i=[];for(let n=0;n<e.tiles.length;n++)for(let a=0;a<e.tiles[n].length;a++)e.tiles[n][a]===t&&i.push({x:a*e.tileSize+e.tileSize/2,y:n*e.tileSize+e.tileSize/2});return i}function qs(e){return Ys(e,"P")[0]||{x:100,y:100}}function _i(e){return Ys(e,"E")[0]||{x:e.width-50,y:50}}function va(e){const t=ma,i=new Gs(e,{zoom:3,lerpSpeed:.08,lookAheadDistance:20});i.setBounds(0,0,t.width,t.height);const n=new Os(e);x.prepareForLevel(1),ba(e,t);const a=qs(t),d=_i(t),u=Ea(e,a.x,a.y,n);i.snapTo(e.vec2(a.x,a.y)),e.add([e.sprite("elevator"),e.pos(d.x,d.y),e.anchor("center"),e.area(),e.z(5),"elevator"]);const w=Va(e,t),A=Sa(e,t),m=Ks(e);let G=0;const v=.5,L=e.add([e.text("!",{size:20}),e.pos(u.pos.x,u.pos.y-20),e.anchor("center"),e.color(255,50,50),e.opacity(0),e.z(200)]),E=e.add([e.rect(18,18),e.pos(u.pos.x,u.pos.y-20),e.anchor("center"),e.color(255,50,50),e.opacity(0),e.z(199)]);e.onUpdate(()=>{if(x.isPaused()||x.isDialogueActive())return;n.update(e.dt()),i.follow(u,e.mousePos());let j=!1;if(w.forEach(I=>{if(x.isTimeFrozen())return;Ma(e,I);const H=Ta(e,I,u,I.visionRange,I.visionAngle);I.canSeePlayer=H,H&&!x.isPlayerInvisible()&&(j=!0)}),A.forEach(I=>{if(x.isTimeFrozen())return;Pa(e,I);const H=Fa(e,I,u);I.canSeePlayer=H,H&&!x.isPlayerInvisible()&&(j=!0)}),L.pos=e.vec2(u.pos.x,u.pos.y-20),E.pos=e.vec2(u.pos.x,u.pos.y-20),j){G+=e.dt();const I=Math.min(G/v,1);L.opacity=.5+Math.sin(e.time()*20)*.3,E.opacity=I*.6,E.height=18*I,u.color=e.rgb(255,100,100),G>=v&&(x.damagePlayer(1),G=0,i.shake(10,.4),u.pos.x=a.x,u.pos.y=a.y,i.snapTo(e.vec2(a.x,a.y)),L.opacity=0,E.opacity=0,x.isPlayerDead()&&e.go("gameover"),x.setInvincible(!0),e.wait(1,()=>{x.setInvincible(!1)}))}else G=0,L.opacity=0,E.opacity=0,x.isPlayerInvisible()||(u.color=e.rgb(79,195,247));Hs(e,m,n,e.vec2(d.x,d.y),i)}),u.onCollide("elevator",()=>{x.addCollectedMask(nt.silence),St(e,Vt[1].outro,()=>{e.go("level2")})}),St(e,Vt[1].intro,()=>{x.setDialogueActive(!1)})}function ba(e,t){for(let d=0;d<t.tiles.length;d++)for(let u=0;u<t.tiles[d].length;u++){const w=t.tiles[d][u],A=u*y+y/2,m=d*y+y/2;e.add([e.sprite(t.floorSprite),e.pos(A,m),e.anchor("center"),e.z(0)]),w==="#"&&e.add([e.sprite(t.wallSprite),e.pos(A,m),e.anchor("center"),e.area(),e.body({isStatic:!0}),e.z(2),"wall"])}const i=t.tiles[0].length*y,n=t.tiles.length*y,a=16;e.add([e.rect(i+a*2,a),e.pos(-a,-a),e.area(),e.body({isStatic:!0}),e.opacity(0),e.z(100),"boundary"]),e.add([e.rect(i+a*2,a),e.pos(-a,n),e.area(),e.body({isStatic:!0}),e.opacity(0),e.z(100),"boundary"]),e.add([e.rect(a,n+a*2),e.pos(-a,-a),e.area(),e.body({isStatic:!0}),e.opacity(0),e.z(100),"boundary"]),e.add([e.rect(a,n+a*2),e.pos(i,-a),e.area(),e.body({isStatic:!0}),e.opacity(0),e.z(100),"boundary"])}function Ea(e,t,i,n){const a=e.add([e.sprite("player"),e.pos(t,i),e.anchor("center"),e.area(),e.body(),e.color(79,195,247),e.opacity(1),e.z(10),"player",{speed:80,dir:e.vec2(0,0)}]);return a.onUpdate(()=>{if(x.isPaused()||x.isDialogueActive())return;const d=e.vec2(0,0);(e.isKeyDown("left")||e.isKeyDown("a"))&&(d.x-=1),(e.isKeyDown("right")||e.isKeyDown("d"))&&(d.x+=1),(e.isKeyDown("up")||e.isKeyDown("w"))&&(d.y-=1),(e.isKeyDown("down")||e.isKeyDown("s"))&&(d.y+=1),d.len()>0&&(a.dir=d.unit(),a.move(a.dir.scale(a.speed))),x.isPlayerInvisible()?a.opacity=.3:a.opacity=1}),e.onKeyPress("space",()=>{x.isPaused()||x.isDialogueActive()||n.activateAbility(a)}),a}function Va(e,t){const i=Ys(t,"G"),n=[];return i.forEach((a,d)=>{const u=e.add([e.sprite("guard"),e.pos(a.x,a.y),e.anchor("center"),e.area(),e.z(5),"guard","enemy",{visionRange:100,visionAngle:75,speed:30,patrolDir:d%2===0?1:-1,patrolRange:70,startX:a.x,canSeePlayer:!1,direction:e.vec2(1,0)}]);u.onDraw(()=>{const w=u.visionRange,A=u.visionAngle/2*(Math.PI/180),m=Math.atan2(u.direction.y,u.direction.x),G=u.canSeePlayer?e.rgb(255,50,50):e.rgb(255,200,50),v=u.canSeePlayer?.5:.25;e.drawTriangle({p1:e.vec2(0,0),p2:e.vec2(Math.cos(m-A)*w,Math.sin(m-A)*w),p3:e.vec2(Math.cos(m+A)*w,Math.sin(m+A)*w),color:G,opacity:v})}),n.push(u)}),n}function Sa(e,t){const i=Ys(t,"C"),n=[];return i.forEach(a=>{const d=e.add([e.sprite("camera-enemy"),e.pos(a.x,a.y),e.anchor("center"),e.z(6),"camera","enemy",{visionRange:120,visionAngle:60,rotationSpeed:35,currentAngle:90,sweepAngle:100,sweepDir:1,canSeePlayer:!1}]);d.onDraw(()=>{const u=d.visionRange,w=d.visionAngle/2*(Math.PI/180),A=d.currentAngle*(Math.PI/180),m=d.canSeePlayer?e.rgb(255,50,50):e.rgb(100,200,255),G=d.canSeePlayer?.5:.2;e.drawTriangle({p1:e.vec2(0,0),p2:e.vec2(Math.cos(A-w)*u,Math.sin(A-w)*u),p3:e.vec2(Math.cos(A+w)*u,Math.sin(A+w)*u),color:m,opacity:G})}),n.push(d)}),n}function Ma(e,t){t.pos.x+=t.speed*t.patrolDir*e.dt(),t.direction.x=t.patrolDir,t.direction.y=0,Math.abs(t.pos.x-t.startX)>t.patrolRange&&(t.patrolDir*=-1)}function Pa(e,t){t.currentAngle+=t.rotationSpeed*t.sweepDir*e.dt(),t.currentAngle>90+t.sweepAngle/2?t.sweepDir=-1:t.currentAngle<90-t.sweepAngle/2&&(t.sweepDir=1)}function Ta(e,t,i,n,a){if(x.isPlayerInvisible())return!1;const d=i.pos.sub(t.pos);if(d.len()>n)return!1;const w=Math.atan2(t.direction.y,t.direction.x),A=Math.atan2(d.y,d.x);let m=Math.abs(w-A);m>Math.PI&&(m=2*Math.PI-m);const G=a/2*(Math.PI/180);return m<=G}function Fa(e,t,i){if(x.isPlayerInvisible())return!1;const n=i.pos.sub(t.pos);if(n.len()>t.visionRange)return!1;const d=t.currentAngle*(Math.PI/180),u=Math.atan2(n.y,n.x);let w=Math.abs(d-u);w>Math.PI&&(w=2*Math.PI-w);const A=t.visionAngle/2*(Math.PI/180);return w<=A}function Ra(e){const t=wa,i=new Gs(e,{zoom:3,lerpSpeed:.1,lookAheadDistance:15});i.setBounds(0,0,t.width,t.height);const n=new Os(e);x.prepareForLevel(2),Da(e,t);const a=y;e.add([e.rect(t.width+a*2,a),e.pos(-a,-a),e.area(),e.body({isStatic:!0}),e.opacity(0),"boundary"]),e.add([e.rect(t.width+a*2,a),e.pos(-a,t.height),e.area(),e.body({isStatic:!0}),e.opacity(0),"boundary"]),e.add([e.rect(a,t.height+a*2),e.pos(-a,-a),e.area(),e.body({isStatic:!0}),e.opacity(0),"boundary"]),e.add([e.rect(a,t.height+a*2),e.pos(t.width,-a),e.area(),e.body({isStatic:!0}),e.opacity(0),"boundary"]);const d=qs(t),u=Ia(e,d.x,d.y,n,t.width,t.height);i.snapTo(e.vec2(d.x,d.y));const w=Ca(e,t.width/2,40);let A=0;const m=t.width/2,G=t.height/2,v=Math.min(t.width,t.height)/2-y*2;let L=v;const E=8;let j=0;const I=.5,H=e.add([e.circle(L),e.pos(m,G),e.anchor("center"),e.color(100,255,100),e.opacity(.15),e.outline(2,e.rgb(100,255,100)),e.z(1)]),B=e.add([e.text("Interest: 0%",{size:8}),e.pos(t.width/2,10),e.anchor("center"),e.color(255,100,100),e.z(100)]),X=[];let S=0;const de=4,W=4,Z=[],ue=[];let pe=0;const ie=1.8,te=["rocket","diamond","egg"];function oe(F){const z=e.vec2(t.width/2,40),_=u.pos.sub(z),ge=_.unit(),je=Math.atan2(ge.y,ge.x)*(180/Math.PI),Ve=_.len(),$e=e.add([e.rect(Ve,2),e.pos(z.x,z.y+30),e.anchor("left"),e.rotate(je),e.color(255,50,50),e.opacity(.6),e.z(7),"hazardous"]);$e.onUpdate(()=>{$e.opacity=.3+Math.sin(e.time()*20)*.3}),e.wait(.5,()=>{$e.exists()&&$e.destroy(),O(F,ge,z)})}function O(F,z,_){let ge;F==="rocket"?ge=e.add([e.polygon([e.vec2(-8,-4),e.vec2(8,0),e.vec2(-8,4)]),e.pos(_.x,_.y+30),e.anchor("center"),e.area({shape:new e.Rect(e.vec2(0,0),16,8)}),e.rotate(Math.atan2(z.y,z.x)*(180/Math.PI)),e.color(255,100,50),e.z(8),"projectile","hazardous","rocket",{projType:"rocket",dir:z,speed:200}]):F==="diamond"?(ge=e.add([e.polygon([e.vec2(0,-8),e.vec2(8,0),e.vec2(0,8),e.vec2(-8,0)]),e.pos(_.x,_.y+30),e.anchor("center"),e.area({shape:new e.Rect(e.vec2(0,0),12,12)}),e.color(100,200,255),e.z(8),"projectile","hazardous","diamond",{projType:"diamond",dir:e.vec2(e.rand(-1,1),e.rand(.3,1)).unit(),speed:130,bounces:0,maxBounces:4}]),ge.onUpdate(()=>{ge.angle=(ge.angle||0)+180*e.dt()})):ge=e.add([e.circle(9),e.pos(_.x,_.y+30),e.anchor("center"),e.area({shape:new e.Rect(e.vec2(0,0),14,14)}),e.color(255,240,200),e.z(8),"projectile","hazardous","egg",{projType:"egg",dir:z,speed:100,targetPos:u.pos.clone()}]),Z.push(ge)}function k(F){Z.forEach((z,_)=>{z.exists()&&(z.projType==="rocket"?(z.pos=z.pos.add(z.dir.scale(z.speed*F)),(z.pos.x<0||z.pos.x>t.width||z.pos.y<0||z.pos.y>t.height)&&(z.destroy(),Z.splice(_,1))):z.projType==="diamond"?(z.pos=z.pos.add(z.dir.scale(z.speed*F)),(z.pos.x<y||z.pos.x>t.width-y)&&(z.dir.x*=-1,z.bounces++,z.pos.x=e.clamp(z.pos.x,y,t.width-y)),(z.pos.y<y||z.pos.y>t.height-y)&&(z.dir.y*=-1,z.bounces++,z.pos.y=e.clamp(z.pos.y,y,t.height-y)),z.bounces>=z.maxBounces&&(z.destroy(),Z.splice(_,1))):z.projType==="egg"&&(z.pos=z.pos.add(z.dir.scale(z.speed*F)),z.pos.dist(z.targetPos)<15&&(se(z.pos.x,z.pos.y),z.destroy(),Z.splice(_,1)),(z.pos.x<y||z.pos.x>t.width-y||z.pos.y<y||z.pos.y>t.height-y)&&(se(z.pos.x,z.pos.y),z.destroy(),Z.splice(_,1))))})}function se(F,z){const _=e.add([e.circle(25),e.pos(F,z),e.anchor("center"),e.color(255,255,100),e.opacity(.4),e.area(),e.z(2),"slippery",{lifetime:5,timer:0}]);ue.push(_);for(let ge=0;ge<6;ge++){const je=ge/6*Math.PI*2;e.add([e.circle(4),e.pos(F+Math.cos(je)*10,z+Math.sin(je)*10),e.anchor("center"),e.color(255,230,150),e.opacity(.8),e.z(3),{vel:e.vec2(Math.cos(je)*30,Math.sin(je)*30)}]).onUpdate(function(){this.pos=this.pos.add(this.vel.scale(e.dt())),this.opacity-=e.dt()*.8,this.opacity<=0&&this.destroy()})}}const Se=[];let Ee=0;const Mt=2.5,at=6,ut=15;let ye=0,be=!1;const he=Ks(e),re=e.add([e.text(`Time: ${ut}s`,{size:10}),e.pos(t.width/2,25),e.anchor("center"),e.color(255,255,100),e.z(100)]),ve=e.add([e.text("Survive 15 seconds for the elevator to open!",{size:8}),e.pos(t.width/2,t.height-30),e.anchor("center"),e.color(100,255,200),e.z(100),e.opacity(1)]);e.wait(3,()=>{ve.exists()&&e.tween(1,0,1,F=>{ve.exists()&&(ve.opacity=F)},e.easings.easeOutQuad).onEnd(()=>{ve.exists()&&ve.destroy()})});let Ne=!1;const Be=t.width/2,Je=y*1.5,pt=e.add([e.rect(y*1.5,y),e.pos(Be,Je),e.anchor("center"),e.color(80,80,100),e.outline(2,e.rgb(60,60,80)),e.area(),e.z(3),"elevator"]);e.add([e.text("ELEVATOR",{size:6}),e.pos(Be,Je+10),e.anchor("center"),e.color(150,150,150),e.z(4)]);const lt=e.add([e.circle(y),e.pos(Be,Je),e.anchor("center"),e.color(100,255,100),e.opacity(0),e.z(2)]);function Pt(){if(Ne=!0,e.destroyAll("hazardous"),e.destroyAll("enemy"),e.destroyAll("projectile"),e.destroyAll("slippery"),e.destroyAll("babythree"),e.destroyAll("debt-collector"),Se.length=0,X.length=0,Z.length=0,ue.length=0,pt.color=e.rgb(100,200,100),pt.outline.color=e.rgb(50,255,50),e.tween(0,.5,.5,F=>{lt.opacity=F},e.easings.easeOutQuad),lt.onUpdate(()=>{lt.opacity=.3+Math.sin(e.time()*4)*.2}),e.add([e.text("ENTER!",{size:8}),e.pos(Be,Je-15),e.anchor("center"),e.color(100,255,100),e.z(100),"elevator-prompt"]),w&&w.exists()){w.color=e.rgb(100,180,100);const F=e.add([e.text(" Tch... Fine. The elevator is yours.",{size:7}),e.pos(w.pos.x,w.pos.y-30),e.anchor("center"),e.color(200,200,100),e.opacity(1),e.z(100)]);e.wait(2,()=>{F.exists()&&e.tween(1,0,.5,z=>{F.exists()&&(F.opacity=z)},e.easings.easeOutQuad).onEnd(()=>{F.exists()&&F.destroy()})})}}function Tt(){if(Se.length>=at)return;const F=Math.floor(e.rand(0,4));let z=0,_=0;switch(F){case 0:z=y*2,_=e.rand(y*2,t.height-y*2);break;case 1:z=t.width-y*2,_=e.rand(y*2,t.height-y*2);break;case 2:z=e.rand(y*2,t.width-y*2),_=y*2;break;case 3:z=e.rand(y*2,t.width-y*2),_=t.height-y*2;break}const ge=e.add([e.sprite("babythree"),e.pos(z,_),e.anchor("center"),e.area(),e.z(5),"babythree","enemy",{speed:36+ye*1.5,target:u}]);Se.push(ge)}function Ft(){if(X.length>=W)return;const F=Math.floor(e.rand(0,4));let z=0,_=0;switch(F){case 0:z=y,_=e.rand(y*3,t.height-y*3);break;case 1:z=t.width-y,_=e.rand(y*3,t.height-y*3);break;case 2:z=e.rand(y*3,t.width-y*3),_=y;break;case 3:z=e.rand(y*3,t.width-y*3),_=t.height-y;break}const ge=e.add([e.sprite("debt-collector"),e.pos(z,_),e.anchor("center"),e.area(),e.z(6),"debt-collector","enemy",{state:"telegraph",stateTimer:0,chargeDir:e.vec2(0,0),chargeSpeed:300,telegraphLine:null}]);X.push(ge)}function Rt(F,z){if(F.stateTimer+=z,F.state==="telegraph"){const _=u.pos.sub(F.pos);if(F.chargeDir=_.unit(),F.telegraphLine||(F.telegraphLine=e.add([e.rect(_.len(),3),e.pos(F.pos),e.anchor("left"),e.rotate(Math.atan2(_.y,_.x)*(180/Math.PI)),e.color(255,50,50),e.opacity(.7),e.z(4)]),F.telegraphLine.onUpdate(()=>{F.telegraphLine&&(F.telegraphLine.opacity=.4+Math.sin(e.time()*20)*.3)})),F.telegraphLine){const ge=u.pos.sub(F.pos);F.telegraphLine.pos=F.pos,F.telegraphLine.width=ge.len(),F.telegraphLine.angle=Math.atan2(ge.y,ge.x)*(180/Math.PI),F.chargeDir=ge.unit()}F.stateTimer>=.5&&(F.state="charging",F.stateTimer=0,F.telegraphLine&&(F.telegraphLine.destroy(),F.telegraphLine=null),F.color=e.rgb(255,255,255),e.wait(.1,()=>{F.exists()&&(F.color=e.rgb(255,255,255))}))}F.state==="charging"&&(F.pos=F.pos.add(F.chargeDir.scale(F.chargeSpeed*z)),F.color=e.rgb(255,100+Math.sin(e.time()*30)*50,100),F.stateTimer>=.6&&(F.state="cooldown",F.stateTimer=0,F.color=e.rgb(255,255,255)),(F.pos.x<y||F.pos.x>t.width-y||F.pos.y<y||F.pos.y>t.height-y)&&(F.state="cooldown",F.stateTimer=0)),F.state==="cooldown"&&(F.color=e.rgb(139,69,69),F.stateTimer>=1.5&&(F.state="telegraph",F.stateTimer=0))}for(let F=0;F<2;F++)Tt();e.onUpdate(()=>{if(x.isPaused()||x.isDialogueActive()||be)return;const F=e.dt();ye+=F,n.update(F),i.follow(u,e.mousePos()),L=Math.max(y*3,v-ye*E),H.radius=L;const z=Math.floor((1-L/v)*100);B.text=`Li sut: ${z}%`,B.color=e.rgb(255,Math.max(0,255-z*2),Math.max(0,100-z));const _=1-L/v;if(H.color=e.rgb(100+_*155,255-_*200,100-_*100),u.pos.dist(e.vec2(m,G))>L){if(j+=F,u.color=e.rgb(255,100,100),j>=I&&(j=0,x.damagePlayer(1),i.shake(5,.2),x.isPlayerDead())){e.go("gameover");return}}else j=0;const je=Math.max(0,ut-ye);if(re.text=`Time: ${je.toFixed(1)}s`,ye>=ut&&!Ne&&(Pt(),re.text="Elevator Open!",re.color=e.rgb(100,255,100)),Ee+=F,Ee>=Mt&&(Ee=0,Tt()),S+=F,S>=de&&ye>3&&(S=0,Ft()),pe+=F,pe>=ie&&ye>1){pe=0;const Ve=te[Math.floor(e.rand(0,te.length))];oe(Ve)}k(F),ue.forEach((Ve,$e)=>{Ve.exists()&&(Ve.timer+=F,Ve.opacity=.4*(1-Ve.timer/Ve.lifetime),Ve.timer>=Ve.lifetime&&(Ve.destroy(),ue.splice($e,1)))}),Se.forEach(Ve=>{if(Ve.exists()&&!x.isTimeFrozen()){const $e=u.pos.sub(Ve.pos).unit();Ve.move($e.scale(Ve.speed))}}),X.forEach(Ve=>{Ve.exists()&&!x.isTimeFrozen()&&Rt(Ve,F)}),A+=F,A>=3&&(A=0,za(e,w)),Hs(e,he,n,u.pos,i)}),u.onCollide("babythree",()=>{if(x.isPlayerEthereal()||x.isInvincible())return;x.damagePlayer(1),i.shake(8,.3);const F=u.pos.sub(e.vec2(t.width/2,t.height/2)).unit();u.pos=u.pos.add(F.scale(30)),x.isPlayerDead()&&e.go("gameover"),x.setInvincible(!0),e.wait(1,()=>{x.setInvincible(!1)})}),u.onCollide("debt-collector",F=>{if(x.isPlayerEthereal()||x.isInvincible()||F.state!=="charging")return;x.damagePlayer(2),i.shake(12,.4);const z=F.chargeDir;u.pos=u.pos.add(z.scale(50)),x.isPlayerDead()&&e.go("gameover"),x.setInvincible(!0),e.wait(1.5,()=>{x.setInvincible(!1)})}),u.onCollide("projectile",F=>{x.isPlayerEthereal()||x.isInvincible()||(x.damagePlayer(1),i.shake(6,.2),F.dir&&(u.pos=u.pos.add(F.dir.scale(20))),x.isPlayerDead()&&e.go("gameover"),F.destroy(),x.setInvincible(!0),e.wait(.8,()=>{x.setInvincible(!1)}))});let ft=!1,rt=e.vec2(0,0);u.onCollide("slippery",()=>{ft||(ft=!0,rt=e.vec2(e.isKeyDown("d")?1:e.isKeyDown("a")?-1:0,e.isKeyDown("s")?1:e.isKeyDown("w")?-1:0).unit(),rt.len()===0&&(rt=e.vec2(e.rand(-1,1),e.rand(-1,1)).unit()))}),u.onCollideEnd("slippery",()=>{ft=!1}),e.onUpdate(()=>{ft&&!x.isPaused()&&!be&&(u.pos=u.pos.add(rt.scale(80*e.dt())),u.pos.x=e.clamp(u.pos.x,y,t.width-y),u.pos.y=e.clamp(u.pos.y,y,t.height-y))}),u.onCollide("elevator",()=>{!Ne||be||(be=!0,x.addCollectedMask(nt.ghost),Se.forEach(F=>F.destroy()),X.forEach(F=>{F.telegraphLine&&F.telegraphLine.destroy(),F.destroy()}),Z.forEach(F=>F.destroy()),ue.forEach(F=>F.destroy()),u.pos=e.vec2(Be,Je),e.tween(1,0,.5,F=>{u.opacity=F},e.easings.easeInQuad).onEnd(()=>{St(e,Vt[2].outro,()=>{e.go("level3")})}))}),St(e,Vt[2].intro,()=>{x.setDialogueActive(!1)})}function Da(e,t){for(let i=0;i<t.tiles.length;i++)for(let n=0;n<t.tiles[i].length;n++){const a=t.tiles[i][n],d=n*y+y/2,u=i*y+y/2;e.add([e.sprite(t.floorSprite),e.pos(d,u),e.anchor("center"),e.z(0)]),a==="#"&&e.add([e.sprite(t.wallSprite),e.pos(d,u),e.anchor("center"),e.area(),e.body({isStatic:!0}),e.z(2),"wall"])}}function Ia(e,t,i,n,a,d){const u=e.add([e.sprite("player"),e.pos(t,i),e.anchor("center"),e.area(),e.body(),e.color(79,195,247),e.opacity(1),e.z(10),"player",{speed:90,dir:e.vec2(0,0)}]);return u.onUpdate(()=>{if(x.isPaused()||x.isDialogueActive())return;const w=e.vec2(0,0);(e.isKeyDown("left")||e.isKeyDown("a"))&&(w.x-=1),(e.isKeyDown("right")||e.isKeyDown("d"))&&(w.x+=1),(e.isKeyDown("up")||e.isKeyDown("w"))&&(w.y-=1),(e.isKeyDown("down")||e.isKeyDown("s"))&&(w.y+=1),w.len()>0&&(u.dir=w.unit(),u.move(u.dir.scale(u.speed)));const A=y;u.pos.x=e.clamp(u.pos.x,A,a-A),u.pos.y=e.clamp(u.pos.y,A,d-A),x.isPlayerEthereal()?(u.opacity=.4,u.color=e.rgb(200,150,255)):(u.opacity=1,u.color=e.rgb(79,195,247))}),e.onKeyPress("space",()=>{x.isPaused()||x.isDialogueActive()||n.activateAbility(u)}),u}function Ca(e,t,i){return e.add([e.sprite("tuse"),e.pos(t,i),e.anchor("center"),e.z(5),"tuse",{lastShout:0}])}function za(e,t){const i=e.add([e.text("Pay up!",{size:8}),e.pos(t.pos.x,t.pos.y+12),e.anchor("center"),e.color(255,200,50),e.z(99)]);e.wait(1.5,()=>{i.exists()&&i.destroy()})}function Ba(e){const t=ya,i=new Gs(e,{zoom:3,lerpSpeed:.08,lookAheadDistance:25});i.setBounds(0,0,t.width,t.height);const n=new Os(e);x.prepareForLevel(3),La(e,t);const a=qs(t),d=_i(t);let u=e.vec2(0,0),w=!1,A=0;const m=.3;let G=e.vec2(0,0);const v=Na(e,a.x,a.y,n,()=>u,te=>{u=te},()=>w);i.snapTo(e.vec2(a.x,a.y)),e.add([e.sprite("elevator"),e.pos(d.x,d.y),e.anchor("center"),e.area(),e.z(5),"elevator"]);const L=Ua(e,t),E=[];let j=0;const I=1.2,H=1.5,B=8;let X=!1,S=0;const de=1;e.add([e.text("Coi chng b 1 hit!",{size:6}),e.pos(t.width/2,12),e.anchor("center"),e.color(255,215,0),e.z(100)]);function W(){if(E.filter(Se=>!Se.fallen).length>=B)return;const te=e.rand(-80,80),oe=e.rand(-80,80);let O=e.clamp(v.pos.x+te,y*2,t.width-y*2),k=e.clamp(v.pos.y+oe,y*2,t.height-y*2);e.rand()<.25&&(O=v.pos.x,k=v.pos.y);const se=e.add([e.circle(8),e.pos(O,k),e.anchor("center"),e.color(255,215,0),e.opacity(.2),e.z(1),"star-shadow"]);E.push({shadow:se,timer:0,targetX:O,targetY:k,fallen:!1})}function Z(te){te.fallen=!0,te.shadow.destroy();const oe=e.add([e.polygon([e.vec2(0,-12),e.vec2(3,-4),e.vec2(12,-4),e.vec2(5,2),e.vec2(7,12),e.vec2(0,6),e.vec2(-7,12),e.vec2(-5,2),e.vec2(-12,-4),e.vec2(-3,-4)]),e.pos(te.targetX,te.targetY-150),e.anchor("center"),e.color(255,215,0),e.outline(2,e.rgb(255,180,0)),e.z(50),"falling-star"]);e.tween(te.targetY-150,te.targetY,.25,O=>{oe.pos.y=O},e.easings.easeInQuad).onEnd(()=>{if(i.shake(5,.15),v.pos.dist(e.vec2(te.targetX,te.targetY))<25&&!x.isPlayerEthereal()&&!x.isInvincible()){X=!0,S=0,v.color=e.rgb(255,215,0),i.shake(10,.3);const k=e.add([e.text("1 HIT!",{size:10}),e.pos(v.pos.x,v.pos.y-20),e.anchor("center"),e.color(255,215,0),e.z(100)]);e.wait(de,()=>{k.exists()&&k.destroy()})}for(let k=0;k<8;k++){const se=e.add([e.circle(3),e.pos(te.targetX,te.targetY),e.anchor("center"),e.color(255,215,0),e.opacity(1),e.z(49),{vel:e.vec2(e.rand(-100,100),e.rand(-120,-30)),life:.6}]);se.onUpdate(()=>{se.pos=se.pos.add(se.vel.scale(e.dt())),se.vel.y+=250*e.dt(),se.opacity-=e.dt()*1.5,se.life-=e.dt(),se.life<=0&&se.destroy()})}e.wait(.2,()=>{oe.exists()&&oe.destroy()})})}const ue=Ks(e),pe=e.vec2(a.x,a.y);Ga(e,t);const ie=e.add([e.text("!",{size:10}),e.pos(0,0),e.anchor("center"),e.color(255,200,100),e.opacity(0),e.z(50)]);e.onUpdate(()=>{if(x.isPaused()||x.isDialogueActive())return;const te=e.dt();n.update(te),i.follow(v,e.mousePos()),X&&(S+=te,v.angle=Math.sin(e.time()*20)*5,S>=de&&(X=!1,v.angle=0,v.color=e.rgb(79,195,247))),w&&(A+=te,v.move(G.scale(1-A/m)),ie.pos=v.pos.add(e.vec2(0,-20)),ie.opacity=1-A/m,A>=m&&(w=!1,ie.opacity=0)),j+=te,j>=I&&(j=0,W()),E.forEach(oe=>{if(oe.fallen)return;oe.timer+=te;const O=oe.timer/H,k=8+O*15;oe.shadow.radius=k,oe.shadow.opacity=.2+O*.5,O>.7&&(oe.shadow.color=e.rgb(255,215+Math.sin(e.time()*25)*40,Math.sin(e.time()*25)*100)),oe.timer>=H&&Z(oe)});for(let oe=E.length-1;oe>=0;oe--)E[oe].fallen&&E.splice(oe,1);L.forEach(oe=>{oe.exists()&&!x.isTimeFrozen()?(Oa(e,oe,t),oe.color=e.rgb(60,60,80)):x.isTimeFrozen()&&(oe.color=e.rgb(100,100,120))}),Hs(e,ue,n,e.vec2(d.x,d.y),i)}),v.onUpdate(()=>{if(X||w)return;const te=e.vec2(0,0);(e.isKeyDown("left")||e.isKeyDown("a"))&&(te.x-=1),(e.isKeyDown("right")||e.isKeyDown("d"))&&(te.x+=1),(e.isKeyDown("up")||e.isKeyDown("w"))&&(te.y-=1),(e.isKeyDown("down")||e.isKeyDown("s"))&&(te.y+=1),te.len()>0&&u.len()>0&&te.unit().dot(u)<-.5&&(w=!0,A=0,G=u.scale(v.speed*.8),v.color=e.rgb(150,200,255),e.wait(.1,()=>{X||(v.color=e.rgb(79,195,247))})),te.len()>0&&(u=te.unit())}),v.onCollide("zed-shadow",()=>{if(!x.isPlayerEthereal()&&!x.isInvincible()){if(v.color=e.rgb(255,100,100),i.shake(10,.3),x.damagePlayer(1),x.isPlayerDead()){e.go("gameover");return}v.pos=pe.clone(),i.snapTo(v.pos),X=!1,w=!1,x.setInvincible(!0),e.wait(1,()=>{x.setInvincible(!1),v.color=e.rgb(79,195,247)})}}),v.onCollide("elevator",()=>{x.addCollectedMask(nt.frozen),St(e,Vt[3].outro,()=>{e.go("level4")})}),St(e,Vt[3].intro,()=>{x.setDialogueActive(!1)})}function La(e,t){for(let d=0;d<t.tiles.length;d++)for(let u=0;u<t.tiles[d].length;u++){const w=t.tiles[d][u],A=u*y+y/2,m=d*y+y/2;e.add([e.sprite(t.floorSprite),e.pos(A,m),e.anchor("center"),e.z(0)]),w==="#"&&e.add([e.sprite(t.wallSprite),e.pos(A,m),e.anchor("center"),e.area(),e.body({isStatic:!0}),e.z(2),"wall"])}const i=t.tiles[0].length*y,n=t.tiles.length*y,a=16;[[i+32,a,-16,-a],[i+32,a,-16,n],[a,n+32,-a,-16],[a,n+32,i,-16]].forEach(([d,u,w,A])=>{e.add([e.rect(d,u),e.pos(w,A),e.area(),e.body({isStatic:!0}),e.opacity(0),e.z(100),"boundary"])})}function Na(e,t,i,n,a,d,u){const w=e.add([e.sprite("player"),e.pos(t,i),e.anchor("center"),e.area(),e.body(),e.color(79,195,247),e.opacity(1),e.rotate(0),e.z(10),"player",{speed:85,dir:e.vec2(0,0)}]);return w.onUpdate(()=>{if(x.isPaused()||x.isDialogueActive()||u())return;const A=e.vec2(0,0);(e.isKeyDown("left")||e.isKeyDown("a"))&&(A.x-=1),(e.isKeyDown("right")||e.isKeyDown("d"))&&(A.x+=1),(e.isKeyDown("up")||e.isKeyDown("w"))&&(A.y-=1),(e.isKeyDown("down")||e.isKeyDown("s"))&&(A.y+=1),A.len()>0&&(w.dir=A.unit(),w.move(w.dir.scale(w.speed)))}),e.onKeyPress("space",()=>{x.isPaused()||x.isDialogueActive()||n.activateAbility(w)}),w}function Ua(e,t){const i=Ys(t,"F"),n=[];i.forEach(()=>{const a=e.rand(y*2,t.width-y*2),d=e.rand(y*2,t.height-y*2),u=e.add([e.sprite("frozen-fan"),e.pos(a,d),e.anchor("center"),e.area(),e.color(60,60,80),e.z(5),"zed-shadow","enemy",{speed:e.rand(180,280),dir:e.vec2(e.rand(-1,1),e.rand(-1,1)).unit()}]);n.push(u)});for(let a=0;a<5;a++){const d=e.rand(y*2,t.width-y*2),u=e.rand(y*2,t.height-y*2),w=e.add([e.sprite("frozen-fan"),e.pos(d,u),e.anchor("center"),e.area(),e.color(60,60,80),e.z(5),"zed-shadow","enemy",{speed:e.rand(200,320),dir:e.vec2(e.rand(-1,1),e.rand(-1,1)).unit()}]);n.push(w)}return n}function Oa(e,t,i){t.move(t.dir.scale(t.speed*e.dt())),(t.pos.x<y||t.pos.x>i.width-y)&&(t.dir.x*=-1,t.pos.x=e.clamp(t.pos.x,y,i.width-y)),(t.pos.y<y||t.pos.y>i.height-y)&&(t.dir.y*=-1,t.pos.y=e.clamp(t.pos.y,y,i.height-y)),e.rand()<.02&&(t.dir=e.vec2(e.rand(-1,1),e.rand(-1,1)).unit())}function Ga(e,t){e.add([e.rect(t.width,t.height),e.pos(0,0),e.color(20,20,40),e.opacity(.3),e.z(-1)]);for(let i=0;i<25;i++)e.add([e.circle(e.rand(1,3)),e.pos(e.rand(0,t.width),e.rand(0,t.height)),e.color(255,215,0),e.opacity(e.rand(.2,.6)),e.z(1),{speed:e.rand(15,35),offset:e.rand(0,Math.PI*2),mapHeight:t.height,mapWidth:t.width,twinkle:e.rand(0,Math.PI*2)}]).onUpdate(function(){this.pos.y+=this.speed*e.dt(),this.pos.x+=Math.sin(e.time()*2+this.offset)*.5,this.opacity=.3+Math.sin(e.time()*3+this.twinkle)*.3,this.pos.y>this.mapHeight&&(this.pos.y=-5,this.pos.x=e.rand(0,this.mapWidth))})}function Ka(e){const t=Aa,i=new Gs(e,{zoom:3,lerpSpeed:.1,lookAheadDistance:20});i.setBounds(0,0,t.width,t.height);const n=new Os(e);x.prepareForLevel(4),Ha(e,t);const a=qs(t),d=_i(t),u=Ya(e,a.x,a.y,n);i.snapTo(e.vec2(a.x,a.y)),e.add([e.sprite("elevator"),e.pos(d.x,d.y),e.anchor("center"),e.area(),e.z(5),"elevator"]),e.add([e.rect(t.width,t.height),e.pos(0,0),e.color(40,120,40),e.z(-1)]);const w=6;for(let I=1;I<w;I++){const H=t.height/w*I;e.add([e.rect(t.width-y*4,2),e.pos(y*2,H),e.color(255,255,255),e.opacity(.6),e.z(0)])}e.add([e.circle(40),e.pos(t.width/2,t.height/2),e.anchor("center"),e.color(255,255,255),e.opacity(0),e.outline(2,e.rgb(255,255,255)),e.z(0)]),e.add([e.rect(2,t.height-y*4),e.pos(t.width/2,y*2),e.color(255,255,255),e.opacity(.6),e.z(0)]);const A=[e.rgb(200,50,50),e.rgb(180,40,40),e.rgb(220,60,60)];for(let I=0;I<20;I++){const H=y*1.5+I*((t.width-y*3)/20),B=e.add([e.rect(8,12),e.pos(H,y*.8),e.anchor("bot"),e.color(A[I%3]),e.z(2),{baseY:y*.8,jumpOffset:e.rand(0,Math.PI*2),isJumping:!1}]);e.loop(.5+e.rand(0,.3),()=>{B.exists()&&(B.isJumping=!B.isJumping)}),B.onUpdate(()=>{B.pos.y=B.baseY-(B.isJumping?6:0)})}for(let I=0;I<20;I++){const H=y*1.5+I*((t.width-y*3)/20),B=e.add([e.rect(8,12),e.pos(H,t.height-y*.3),e.anchor("bot"),e.color(A[I%3]),e.z(2),{baseY:t.height-y*.3,isJumping:!1}]);e.loop(.5+e.rand(0,.3),()=>{B.exists()&&(B.isJumping=!B.isJumping)}),B.onUpdate(()=>{B.pos.y=B.baseY-(B.isJumping?6:0)})}[{x:y*2.5,y:y*2.5},{x:t.width-y*2.5,y:y*2.5},{x:y*2.5,y:t.height-y*2.5},{x:t.width-y*2.5,y:t.height-y*2.5}].forEach(I=>{e.add([e.rect(20,8),e.pos(I.x,I.y+10),e.anchor("center"),e.color(60,60,60),e.z(3)]),e.add([e.text("",{size:20}),e.pos(I.x,I.y),e.anchor("center"),e.z(4)]),e.add([e.text("Qu ",{size:5}),e.pos(I.x,I.y+18),e.anchor("center"),e.color(200,50,50),e.z(4)])});const G=[],v=15,L=["Anh Lc","Anh Long","Anh Vc","Anh Nhng","Anh Th","A Hong","Vut Ph","A Ni","A B","Mc Hi"];for(let I=0;I<v;I++){const H=e.rand(y*3,t.width-y*3),B=e.rand(y*3,t.height-y*3),X=L[Math.floor(e.rand(0,L.length))],S=e.add([e.rect(10,14,{radius:2}),e.pos(H,B),e.anchor("center"),e.area(),e.color(200,40,40),e.outline(1,e.rgb(255,255,255)),e.z(5),"red-player","enemy",{speed:e.rand(60,120),dir:e.vec2(e.rand(-1,1),e.rand(-1,1)).unit(),dirChangeTimer:0,dirChangeInterval:e.rand(.3,.8),circlePhase:e.rand(0,Math.PI*2),circleRadius:e.rand(20,50),displayName:X,jerseyNumber:Math.floor(e.rand(1,99))}]);S.onDraw(()=>{e.drawText({text:S.displayName,pos:e.vec2(0,-16),size:5,anchor:"center",color:e.rgb(255,220,220)}),e.drawText({text:String(S.jerseyNumber),pos:e.vec2(0,0),size:6,anchor:"center",color:e.rgb(255,255,255)})}),G.push(S)}function E(I,H){I.dirChangeTimer+=H,I.dirChangeTimer>=I.dirChangeInterval&&(I.dirChangeTimer=0,I.dirChangeInterval=e.rand(.3,.8),e.rand()<.4?(I.circlePhase+=e.rand(.5,1.5),I.dir=e.vec2(Math.cos(I.circlePhase),Math.sin(I.circlePhase))):I.dir=e.vec2(e.rand(-1,1),e.rand(-1,1)).unit()),I.move(I.dir.scale(I.speed)),(I.pos.x<y||I.pos.x>t.width-y)&&(I.dir.x*=-1,I.pos.x=e.clamp(I.pos.x,y,t.width-y)),(I.pos.y<y||I.pos.y>t.height-y)&&(I.dir.y*=-1,I.pos.y=e.clamp(I.pos.y,y,t.height-y)),G.forEach(B=>{if(B===I||!B.exists())return;I.pos.dist(B.pos)<16&&(I.dir=I.pos.sub(B.pos).unit(),B.dir=B.pos.sub(I.pos).unit())})}e.add([e.text(" SN VN NG  ",{size:7}),e.pos(t.width/2,y*1.3),e.anchor("center"),e.color(255,255,200),e.z(100)]);const j=Ks(e);e.onUpdate(()=>{if(x.isPaused()||x.isDialogueActive())return;const I=e.dt();n.update(I),i.follow(u,e.mousePos()),G.forEach(H=>{H.exists()&&!x.isTimeFrozen()?E(H,I):x.isTimeFrozen()?H.color=e.rgb(150,80,80):H.color=e.rgb(220,50,50)}),Hs(e,j,n,e.vec2(d.x,d.y),i)}),u.onCollide("red-player",I=>{if(x.isPlayerEthereal()||x.isInvincible()||x.isPlayerShielding())return;x.damagePlayer(1),i.shake(8,.3);const H=u.pos.sub(I.pos).unit();u.pos=u.pos.add(H.scale(40)),u.color=e.rgb(255,100,100),e.wait(.15,()=>{x.isPlayerShielding()?u.color=e.rgb(255,215,0):u.color=e.rgb(79,195,247)}),x.isPlayerDead()&&e.go("gameover"),x.setInvincible(!0),e.wait(1,()=>{x.setInvincible(!1)})}),u.onCollide("elevator",()=>{x.addCollectedMask(nt.shield),St(e,Vt[4].outro,()=>{e.go("gate_opening")})}),St(e,Vt[4].intro,()=>{x.setDialogueActive(!1)})}function Ha(e,t){for(let d=0;d<t.tiles.length;d++)for(let u=0;u<t.tiles[d].length;u++){const w=t.tiles[d][u],A=u*y+y/2,m=d*y+y/2;e.add([e.sprite(t.floorSprite),e.pos(A,m),e.anchor("center"),e.z(0)]),w==="#"&&e.add([e.sprite(t.wallSprite),e.pos(A,m),e.anchor("center"),e.area(),e.body({isStatic:!0}),e.z(2),"wall"])}const i=t.tiles[0].length*y,n=t.tiles.length*y,a=16;[[i+32,a,-16,-a],[i+32,a,-16,n],[a,n+32,-a,-16],[a,n+32,i,-16]].forEach(([d,u,w,A])=>{e.add([e.rect(d,u),e.pos(w,A),e.area(),e.body({isStatic:!0}),e.opacity(0),e.z(100),"boundary"])})}function Ya(e,t,i,n){const a=e.add([e.sprite("player"),e.pos(t,i),e.anchor("center"),e.area(),e.body(),e.color(79,195,247),e.opacity(1),e.z(10),"player",{speed:90,dir:e.vec2(0,0)}]);return a.onUpdate(()=>{if(x.isPaused()||x.isDialogueActive())return;const d=e.vec2(0,0);(e.isKeyDown("left")||e.isKeyDown("a"))&&(d.x-=1),(e.isKeyDown("right")||e.isKeyDown("d"))&&(d.x+=1),(e.isKeyDown("up")||e.isKeyDown("w"))&&(d.y-=1),(e.isKeyDown("down")||e.isKeyDown("s"))&&(d.y+=1),d.len()>0&&(a.dir=d.unit(),a.move(a.dir.scale(a.speed))),x.isPlayerShielding()?a.color=e.rgb(255,215,0):a.color=e.rgb(79,195,247)}),e.onKeyPress("space",()=>{x.isPaused()||x.isDialogueActive()||n.activateAbility(a)}),a}const Oi=60,qa=20,Qa=40;function Xa(e){const t=xa,i=new Gs(e,{zoom:2.5,lerpSpeed:.12,lookAheadDistance:15});i.setBounds(0,0,t.width,t.height);const n=new Os(e);x.prepareForLevel(5),Wa(e,t);const a=qs(t),d={x:t.width/2,y:y*4},u=Ja(e,a.x,a.y,n);i.snapTo(e.vec2(a.x,a.y));const w=e.add([e.sprite("boss"),e.pos(d.x,d.y),e.anchor("center"),e.area(),e.color(200,50,100),e.z(9),"boss",{currentPhase:1}]),A=[],m=[],G=[],v=[];let L=Oi,E=!1;const j=Ks(e),I=240,H=16,B=e.add([e.rect(I+4,H+4),e.pos(e.width()/2,25),e.anchor("center"),e.color(30,30,30),e.outline(2,e.rgb(80,80,80)),e.z(300),e.fixed()]),X=e.add([e.rect(I,H),e.pos(e.width()/2-I/2,25-H/2),e.color(255,215,0),e.z(301),e.fixed()]),S=e.add([e.text("Time until Salary: 60s",{size:11}),e.pos(e.width()/2,25),e.anchor("center"),e.color(255,255,255),e.z(302),e.fixed()]),de=e.add([e.text("Phase 1: Talk No Jutsu",{size:9}),e.pos(e.width()/2,45),e.anchor("center"),e.color(255,100,100),e.z(302),e.fixed()]),W=e.add([e.pos(e.width()/2,e.height()-50),e.anchor("center"),e.z(400),e.fixed()]),Z=[],ue=50;[{id:"silence",key:"1",sprite:"mask-silence"},{id:"ghost",key:"2",sprite:"mask-ghost"},{id:"frozen",key:"3",sprite:"mask-frozen"},{id:"shield",key:"4",sprite:"mask-shield"}].forEach((ye,be)=>{const he=(be-1.5)*ue;W.add([e.text(`[${ye.key}]`,{size:10}),e.pos(he,-25),e.anchor("center"),e.color(200,200,200),e.z(401)]);const re=W.add([e.sprite(ye.sprite),e.pos(he,0),e.anchor("center"),e.scale(2),e.outline(0,e.rgb(255,215,0)),e.z(401),{maskId:ye.id}]);Z.push(re)});let ie=0;const te=1.2,oe=["Hello Vu!","I know everything","Don't deny it","No escape!"];function O(){const ye=oe[Math.floor(Math.random()*oe.length)],be=u.pos.add(u.dir.scale(30)),he=be.sub(w.pos).unit(),re=be.dist(w.pos),ve=Math.atan2(he.y,he.x),Ne=e.add([e.rect(re,2),e.pos(w.pos.x,w.pos.y),e.anchor("left"),e.rotate(ve*(180/Math.PI)),e.color(255,200,200),e.opacity(.6),e.z(7)]);e.wait(.3,()=>{Ne.destroy();const Be=e.add([e.text(ye,{size:8}),e.pos(w.pos.x,w.pos.y+10),e.anchor("center"),e.color(255,100,100),e.area({shape:new e.Rect(e.vec2(0),20,12)}),e.z(8),"boss-projectile",{dir:he,speed:120}]);m.push(Be)})}let k=0;const se=2.5;function Se(){const be=Math.floor(Math.random()*4);for(let he=0;he<8;he++){let re=0,ve=0,Ne=0,Be=0;switch(be){case 0:re=he/8*t.width,ve=y,Ne=e.rand(-.3,.3),Be=1;break;case 1:re=t.width-y,ve=he/8*t.height,Ne=-1,Be=e.rand(-.3,.3);break;case 2:re=he/8*t.width,ve=t.height-y,Ne=e.rand(-.3,.3),Be=-1;break;case 3:re=y,ve=he/8*t.height,Ne=1,Be=e.rand(-.3,.3);break}const Je=e.vec2(re,ve),pt=e.add([e.rect(12,16),e.pos(Je),e.anchor("center"),e.color(100,100,100),e.opacity(.3),e.z(2)]);e.wait(.5,()=>{pt.destroy();const lt=e.add([e.rect(10,14),e.pos(re,ve),e.anchor("center"),e.color(255,255,255),e.area(),e.z(8),"boss-projectile",{dir:e.vec2(Ne,Be).unit(),speed:100}]);G.push(lt)})}}let Ee=0;const Mt=2,at=e.add([e.rect(e.width(),e.height()),e.pos(0,0),e.color(150,0,0),e.opacity(0),e.z(0),e.fixed()]);function ut(){const ye=Math.floor(Math.random()*4);let be=0,he=0,re=0,ve=0;switch(ye){case 0:be=e.rand(y*2,t.width-y*2),he=-y,re=be+e.rand(-100,100),ve=t.height+y;break;case 1:be=t.width+y,he=e.rand(y*2,t.height-y*2),re=-y,ve=he+e.rand(-100,100);break;case 2:be=e.rand(y*2,t.width-y*2),he=t.height+y,re=be+e.rand(-100,100),ve=-y;break;case 3:be=-y,he=e.rand(y*2,t.height-y*2),re=t.width+y,ve=he+e.rand(-100,100);break}const Ne=e.vec2(re,ve).sub(e.vec2(be,he)).unit(),Be=e.add([e.circle(10),e.pos(be,he),e.anchor("center"),e.color(255,255,255),e.area(),e.z(8),"boss-projectile","white-cow",{dir:Ne,speed:180}]);v.push(Be)}e.onUpdate(()=>{if(x.isPaused()||x.isDialogueActive()||E)return;const ye=e.dt();n.update(ye),i.follow(u,e.mousePos()),L-=ye,S.text=`Time until Salary: ${Math.ceil(L)}s`,X.width=I*(L/Oi),L<10?(X.color=e.rgb(255,50,50),S.color=e.rgb(255,100,100)):L<30?X.color=e.rgb(255,150,50):(X.color=e.rgb(255,215,0),S.color=e.rgb(255,255,255));const be=Oi-L;let he=1;be>=Qa?(he=3,de.text="Phase 3: The Blazer",de.color=e.rgb(255,0,0),at.opacity=.25+Math.sin(e.time()*3)*.05,w.color=e.rgb(50,50,50)):be>=qa?(he=2,de.text="Phase 2: Document Storm",de.color=e.rgb(255,255,255),at.opacity=0,w.color=e.rgb(200,50,100)):(he=1,de.text="Phase 1: Talk No Jutsu",de.color=e.rgb(255,100,100),at.opacity=0,w.color=e.rgb(200,50,100)),w.currentPhase=he,he===1&&!x.isTimeFrozen()&&(ie+=ye,ie>=te&&(ie=0,O())),he===2&&!x.isTimeFrozen()&&(k+=ye,k>=se&&(k=0,Se())),he===3&&!x.isTimeFrozen()&&(Ee+=ye,Ee>=Mt&&(Ee=0,ut())),[...m,...G,...v,...A].forEach(re=>{re.exists()&&(re.move(re.dir.scale(re.speed)),(re.pos.x<-50||re.pos.x>t.width+50||re.pos.y<-50||re.pos.y>t.height+50)&&re.destroy())}),Z.forEach(re=>{const ve=x.getPlayerState();ve.currentMask&&ve.currentMask.id===re.maskId?(re.outline.width=3,re.outline.color=e.rgb(255,215,0)):re.outline.width=0}),L<=0&&!E&&(E=!0,[...m,...G,...v,...A].forEach(re=>re.destroy()),w.use(e.opacity(.6)),i.shake(15,.5),B.destroy(),X.destroy(),S.destroy(),de.destroy(),W.destroy(),at.destroy(),e.wait(1,()=>{e.go("outro")})),Hs(e,j,n,w.pos,i)}),u.onCollide("boss-projectile",ye=>{if(x.isPlayerShielding()){ye.destroy(),i.shake(5,.1);return}x.isPlayerEthereal()||x.isInvincible()||(ye.destroy(),x.damagePlayer(1),i.shake(10,.3),u.color=e.rgb(255,100,100),e.wait(.15,()=>{u.exists()&&(u.color=e.rgb(79,195,247))}),x.isPlayerDead()&&e.go("gameover"),x.setInvincible(!0),e.wait(.6,()=>{x.setInvincible(!1)}))}),u.onCollide("boss",()=>{if(x.isPlayerEthereal()||x.isInvincible())return;x.damagePlayer(1),i.shake(10,.3);const ye=u.pos.sub(w.pos).unit();u.pos=u.pos.add(ye.scale(50)),x.setInvincible(!0),e.wait(1,()=>{x.setInvincible(!1)}),x.isPlayerDead()&&e.go("gameover")}),St(e,Vt[5].intro,()=>{x.setDialogueActive(!1)})}function Wa(e,t){for(let d=0;d<t.tiles.length;d++)for(let u=0;u<t.tiles[d].length;u++){const w=t.tiles[d][u],A=u*y+y/2,m=d*y+y/2;e.add([e.sprite(t.floorSprite),e.pos(A,m),e.anchor("center"),e.z(0)]),w==="#"&&e.add([e.sprite(t.wallSprite),e.pos(A,m),e.anchor("center"),e.area(),e.body({isStatic:!0}),e.z(2),"wall"])}const i=t.tiles[0].length*y,n=t.tiles.length*y,a=16;[[i+32,a,-16,-a],[i+32,a,-16,n],[a,n+32,-a,-16],[a,n+32,i,-16]].forEach(([d,u,w,A])=>{e.add([e.rect(d,u),e.pos(w,A),e.area(),e.body({isStatic:!0}),e.opacity(0),e.z(100),"boundary"])})}function Ja(e,t,i,n){const a=e.add([e.sprite("player"),e.pos(t,i),e.anchor("center"),e.area(),e.body(),e.color(79,195,247),e.opacity(1),e.z(10),"player",{speed:95,dir:e.vec2(0,0)}]);return a.onUpdate(()=>{if(x.isPaused()||x.isDialogueActive())return;const d=e.vec2(0,0);(e.isKeyDown("left")||e.isKeyDown("a"))&&(d.x-=1),(e.isKeyDown("right")||e.isKeyDown("d"))&&(d.x+=1),(e.isKeyDown("up")||e.isKeyDown("w"))&&(d.y-=1),(e.isKeyDown("down")||e.isKeyDown("s"))&&(d.y+=1),d.len()>0&&(a.dir=d.unit(),a.move(a.dir.scale(a.speed))),x.isPlayerShielding()?a.color=e.rgb(255,215,0):x.isPlayerEthereal()?(a.color=e.rgb(200,150,255),a.opacity=.4):x.isPlayerInvisible()?a.opacity=.3:(a.color=e.rgb(79,195,247),a.opacity=1)}),e.onKeyPress("space",()=>{x.isPaused()||x.isDialogueActive()||n.activateAbility(a)}),e.onKeyPress("1",()=>n.setMask(0)),e.onKeyPress("2",()=>n.setMask(1)),e.onKeyPress("3",()=>n.setMask(2)),e.onKeyPress("4",()=>n.setMask(3)),e.onKeyPress("tab",()=>n.cycleMask()),a}const we=ra({width:window.innerWidth,height:window.innerHeight,background:[20,20,30],font:"monospace",crisp:!0,letterbox:!1,stretch:!0,global:!1,debug:!1,scale:1});window.addEventListener("resize",()=>{});oa(we);we.scene("menu",()=>aa(we));we.scene("intro",()=>ha(we));we.scene("level1",()=>va(we));we.scene("level2",()=>Ra(we));we.scene("level3",()=>Ba(we));we.scene("level4",()=>Ka(we));we.scene("gate_opening",()=>ua(we));we.scene("level5",()=>Xa(we));we.scene("gameover",()=>la(we));we.scene("victory",()=>ca(we));we.scene("outro",()=>da(we));we.onKeyPress("f1",()=>we.go("level1"));we.onKeyPress("f2",()=>we.go("level2"));we.onKeyPress("f3",()=>we.go("level3"));we.onKeyPress("f4",()=>we.go("level4"));we.onKeyPress("f5",()=>we.go("level5"));we.go("menu");console.log(" Chicken Jerky Retrieval - The Masked Mission ");console.log("Controls:");console.log("  WASD/Arrow Keys - Move");console.log("  SPACE - Use Mask Ability");console.log("  1-4/TAB - Switch Masks (Boss Level Only)");console.log("  ENTER - Advance Dialogue");
