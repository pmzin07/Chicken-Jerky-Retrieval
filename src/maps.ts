// Level Maps - ASCII-based level definitions
import { TILE_SIZE } from "./loader.ts";

// Map Legend:
// # = Wall
// . = Floor
// P = Player spawn
// E = Elevator/Exit
// G = Guard
// C = Camera
// B = Babythree (ghost)
// T = Trưởng Phòng Đòi Nợ (Level 2 NPC)
// F = Frozen Fan
// A = Anti-fan
// M = Trùm Cuối (The Boss)
// O = Pillar
// X = Minion spawn point

export interface LevelMap {
  tiles: string[];
  tileSize: number;
  floorSprite: string;
  wallSprite: string;
  name: string;
  width: number;
  height: number;
}

// LEVEL 1: The Gatekeepers (Stealth)
export const LEVEL_1_MAP: LevelMap = {
  name: "Floor 1: The Gatekeepers",
  tileSize: TILE_SIZE,
  floorSprite: "floor",
  wallSprite: "wall",
  tiles: [
    "##################################################",
    "#................................................#",
    "#.......C................................C.......#",
    "#................................................#",
    "#....######..........G...........######..........#",
    "#....#....#......................#....#..........#",
    "#....#....#......................#....#....E.....#",
    "#....######......................######..........#",
    "#................................................#",
    "#..........G..........................G..........#",
    "#................................................#",
    "#....######..........######..........######......#",
    "#....#....#..........#....#..........#....#......#",
    "#....#....#..........#....#..........#....#......#",
    "#....######..........######..........######......#",
    "#................................................#",
    "#.......C.................C.................C....#",
    "#................................................#",
    "#................................................#",
    "#....######.......................######.........#",
    "#....#....#.......................#....#.........#",
    "#....#....#..........G............#....#.........#",
    "#....######.......................######.........#",
    "#................................................#",
    "#.P..............................................#",
    "##################################################",
  ],
  get width() { return this.tiles[0].length * this.tileSize; },
  get height() { return this.tiles.length * this.tileSize; }
};

// LEVEL 2: The Debt Office (Survival - larger room for better gameplay)
export const LEVEL_2_MAP: LevelMap = {
  name: "Floor 2: The Debt Office",
  tileSize: TILE_SIZE,
  floorSprite: "floor",
  wallSprite: "wall",
  tiles: [
    "##########################################",
    "#........................................#",
    "#........................................#",
    "#..T.....................................#",
    "#........................................#",
    "#........................................#",
    "#........................................#",
    "#........................................#",
    "#........................................#",
    "#........................................#",
    "#....................P...................#",
    "#........................................#",
    "#........................................#",
    "#........................................#",
    "#........................................#",
    "#........................................#",
    "#........................................#",
    "#........................................#",
    "#........................................#",
    "#........................................#",
    "##########################################",
  ],
  get width() { return this.tiles[0].length * this.tileSize; },
  get height() { return this.tiles.length * this.tileSize; }
};

// LEVEL 3: The Paralyzed Zone (Icy obstacle course)
export const LEVEL_3_MAP: LevelMap = {
  name: "Floor 3: The Paralyzed Zone",
  tileSize: TILE_SIZE,
  floorSprite: "floor-ice",
  wallSprite: "wall",
  tiles: [
    "##################################################",
    "#................................................#",
    "#.....F..............F..............F...........#",
    "#................................................#",
    "#........###........###........###..........E...#",
    "#........###........###........###..............#",
    "#................................................#",
    "#...F..............F..............F.............#",
    "#................................................#",
    "#................................................#",
    "#........###........###........###..............#",
    "#........###........###........###..............#",
    "#................................................#",
    "#...F..............F..............F..............#",
    "#................................................#",
    "#........###........###........###..............#",
    "#........###........###........###..............#",
    "#................................................#",
    "#...F..............F..............F..............#",
    "#.P..............................................#",
    "##################################################",
  ],
  get width() { return this.tiles[0].length * this.tileSize; },
  get height() { return this.tiles.length * this.tileSize; }
};

// LEVEL 4: The Red Cave (Dark bullet hell)
export const LEVEL_4_MAP: LevelMap = {
  name: "Floor 4: The Red Cave",
  tileSize: TILE_SIZE,
  floorSprite: "floor-cave",
  wallSprite: "wall",
  tiles: [
    "##################################################",
    "#................................................#",
    "#.....A......................A...................#",
    "#................................................#",
    "#.........#####################..................#",
    "#.........#...................#..................#",
    "#.........#...................#..................#",
    "#.........#...................#..................#",
    "#.........#...................#..........E.......#",
    "#.........#...................#..................#",
    "#.........#...................#..................#",
    "#.........#####################..................#",
    "#................................................#",
    "#.....A......................A...................#",
    "#................................................#",
    "#.........#####################..................#",
    "#.........#...................#..................#",
    "#.........#...................#..................#",
    "#.........#####################..................#",
    "#.P..............................................#",
    "##################################################",
  ],
  get width() { return this.tiles[0].length * this.tileSize; },
  get height() { return this.tiles.length * this.tileSize; }
};

// LEVEL 5: CEO's Office (Boss fight) - Spacious Penthouse Arena
export const LEVEL_5_MAP: LevelMap = {
  name: "Floor 5: CEO's Office",
  tileSize: TILE_SIZE,
  floorSprite: "floor-boss",
  wallSprite: "wall",
  tiles: [
    "##########################################################",
    "#........................................................#",
    "#..O....................................................O..#",
    "#........................................................#",
    "#....................M...................................#",
    "#........................................................#",
    "#........................................................#",
    "#..O....................................................O..#",
    "#........................................................#",
    "#........................................................#",
    "#........................................................#",
    "#........................................................#",
    "#..O....................................................O..#",
    "#........................................................#",
    "#........................................................#",
    "#........................................................#",
    "#........................................................#",
    "#..O....................................................O..#",
    "#........................................................#",
    "#........................................................#",
    "#..........................P.............................#",
    "#........................................................#",
    "#..O....................................................O..#",
    "#........................................................#",
    "##########################################################",
  ],
  get width() { return this.tiles[0].length * this.tileSize; },
  get height() { return this.tiles.length * this.tileSize; }
};

// Get all level maps
export const LEVEL_MAPS = [
  LEVEL_1_MAP,
  LEVEL_2_MAP,
  LEVEL_3_MAP,
  LEVEL_4_MAP,
  LEVEL_5_MAP
];

// Parse map to find positions
export function findInMap(map: LevelMap, char: string): { x: number; y: number }[] {
  const positions: { x: number; y: number }[] = [];
  
  for (let y = 0; y < map.tiles.length; y++) {
    for (let x = 0; x < map.tiles[y].length; x++) {
      if (map.tiles[y][x] === char) {
        positions.push({
          x: x * map.tileSize + map.tileSize / 2,
          y: y * map.tileSize + map.tileSize / 2
        });
      }
    }
  }
  
  return positions;
}

// Get player spawn position
export function getPlayerSpawn(map: LevelMap): { x: number; y: number } {
  const spawns = findInMap(map, 'P');
  return spawns[0] || { x: 100, y: 100 };
}

// Get elevator/exit position
export function getElevatorPosition(map: LevelMap): { x: number; y: number } {
  const exits = findInMap(map, 'E');
  return exits[0] || { x: map.width - 50, y: 50 };
}
